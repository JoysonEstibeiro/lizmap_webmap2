/*! For license information please see attributeTable.js.LICENSE.txt */
(()=>{"use strict";const{entries:e,setPrototypeOf:t,isFrozen:a,getPrototypeOf:r,getOwnPropertyDescriptor:i}=Object;let{freeze:n,seal:l,create:o}=Object,{apply:s,construct:u}="undefined"!=typeof Reflect&&Reflect;n||(n=function(e){return e}),l||(l=function(e){return e}),s||(s=function(e,t,a){return e.apply(t,a)}),u||(u=function(e,t){return new e(...t)});const c=_(Array.prototype.forEach),d=_(Array.prototype.lastIndexOf),p=_(Array.prototype.pop),f=_(Array.prototype.push),b=_(Array.prototype.splice),m=_(String.prototype.toLowerCase),y=_(String.prototype.toString),h=_(String.prototype.match),g=_(String.prototype.replace),v=_(String.prototype.indexOf),T=_(String.prototype.trim),z=_(Object.prototype.hasOwnProperty),L=_(RegExp.prototype.test),M=(E=TypeError,function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return u(E,t)});var E;function _(e){return function(t){for(var a=arguments.length,r=new Array(a>1?a-1:0),i=1;i<a;i++)r[i-1]=arguments[i];return s(e,t,r)}}function F(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;t&&t(e,null);let n=r.length;for(;n--;){let t=r[n];if("string"==typeof t){const e=i(t);e!==t&&(a(r)||(r[n]=e),t=e)}e[t]=!0}return e}function C(e){for(let t=0;t<e.length;t++)z(e,t)||(e[t]=null);return e}function N(t){const a=o(null);for(const[r,i]of e(t))z(t,r)&&(Array.isArray(i)?a[r]=C(i):i&&"object"==typeof i&&i.constructor===Object?a[r]=N(i):a[r]=i);return a}function A(e,t){for(;null!==e;){const a=i(e,t);if(a){if(a.get)return _(a.get);if("function"==typeof a.value)return _(a.value)}e=r(e)}return function(){return null}}const w=n(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),S=n(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),k=n(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),D=n(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),I=n(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),x=n(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),R=n(["#text"]),O=n(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),P=n(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),B=n(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),U=n(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),j=l(/\{\{[\w\W]*|[\w\W]*\}\}/gm),G=l(/<%[\w\W]*|[\w\W]*%>/gm),q=l(/\$\{[\w\W]*/gm),H=l(/^data-[\-\w.\u00B7-\uFFFF]+$/),W=l(/^aria-[\-\w]+$/),V=l(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Y=l(/^(?:\w+script|data):/i),X=l(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),K=l(/^html$/i),Z=l(/^[a-z][.\w]*(-[.\w]+)+$/i);var J=Object.freeze({__proto__:null,ARIA_ATTR:W,ATTR_WHITESPACE:X,CUSTOM_ELEMENT:Z,DATA_ATTR:H,DOCTYPE_NAME:K,ERB_EXPR:G,IS_ALLOWED_URI:V,IS_SCRIPT_OR_DATA:Y,MUSTACHE_EXPR:j,TMPLIT_EXPR:q});const Q=function(){return"undefined"==typeof window?null:window};var ee=function t(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q();const r=e=>t(e);if(r.version="3.2.4",r.removed=[],!a||!a.document||9!==a.document.nodeType||!a.Element)return r.isSupported=!1,r;let{document:i}=a;const l=i,s=l.currentScript,{DocumentFragment:u,HTMLTemplateElement:E,Node:_,Element:$,NodeFilter:C,NamedNodeMap:j=a.NamedNodeMap||a.MozNamedAttrMap,HTMLFormElement:G,DOMParser:q,trustedTypes:H}=a,W=$.prototype,Y=A(W,"cloneNode"),X=A(W,"remove"),Z=A(W,"nextSibling"),ee=A(W,"childNodes"),te=A(W,"parentNode");if("function"==typeof E){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let ae,re="";const{implementation:ie,createNodeIterator:ne,createDocumentFragment:le,getElementsByTagName:oe}=i,{importNode:se}=l;let ue={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};r.isSupported="function"==typeof e&&"function"==typeof te&&ie&&void 0!==ie.createHTMLDocument;const{MUSTACHE_EXPR:ce,ERB_EXPR:de,TMPLIT_EXPR:pe,DATA_ATTR:fe,ARIA_ATTR:be,IS_SCRIPT_OR_DATA:me,ATTR_WHITESPACE:ye,CUSTOM_ELEMENT:he}=J;let{IS_ALLOWED_URI:ge}=J,ve=null;const Te=F({},[...w,...S,...k,...I,...R]);let ze=null;const Le=F({},[...O,...P,...B,...U]);let Me=Object.seal(o(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ee=null,_e=null,Fe=!0,$e=!0,Ce=!1,Ne=!0,Ae=!1,we=!0,Se=!1,ke=!1,De=!1,Ie=!1,xe=!1,Re=!1,Oe=!0,Pe=!1,Be=!0,Ue=!1,je={},Ge=null;const qe=F({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let He=null;const We=F({},["audio","video","img","source","image","track"]);let Ve=null;const Ye=F({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Xe="http://www.w3.org/1998/Math/MathML",Ke="http://www.w3.org/2000/svg",Ze="http://www.w3.org/1999/xhtml";let Je=Ze,Qe=!1,et=null;const tt=F({},[Xe,Ke,Ze],y);let at=F({},["mi","mo","mn","ms","mtext"]),rt=F({},["annotation-xml"]);const it=F({},["title","style","font","a","script"]);let nt=null;const lt=["application/xhtml+xml","text/html"];let ot=null,st=null;const ut=i.createElement("form"),ct=function(e){return e instanceof RegExp||e instanceof Function},dt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!st||st!==e){if(e&&"object"==typeof e||(e={}),e=N(e),nt=-1===lt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ot="application/xhtml+xml"===nt?y:m,ve=z(e,"ALLOWED_TAGS")?F({},e.ALLOWED_TAGS,ot):Te,ze=z(e,"ALLOWED_ATTR")?F({},e.ALLOWED_ATTR,ot):Le,et=z(e,"ALLOWED_NAMESPACES")?F({},e.ALLOWED_NAMESPACES,y):tt,Ve=z(e,"ADD_URI_SAFE_ATTR")?F(N(Ye),e.ADD_URI_SAFE_ATTR,ot):Ye,He=z(e,"ADD_DATA_URI_TAGS")?F(N(We),e.ADD_DATA_URI_TAGS,ot):We,Ge=z(e,"FORBID_CONTENTS")?F({},e.FORBID_CONTENTS,ot):qe,Ee=z(e,"FORBID_TAGS")?F({},e.FORBID_TAGS,ot):{},_e=z(e,"FORBID_ATTR")?F({},e.FORBID_ATTR,ot):{},je=!!z(e,"USE_PROFILES")&&e.USE_PROFILES,Fe=!1!==e.ALLOW_ARIA_ATTR,$e=!1!==e.ALLOW_DATA_ATTR,Ce=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Ne=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Ae=e.SAFE_FOR_TEMPLATES||!1,we=!1!==e.SAFE_FOR_XML,Se=e.WHOLE_DOCUMENT||!1,Ie=e.RETURN_DOM||!1,xe=e.RETURN_DOM_FRAGMENT||!1,Re=e.RETURN_TRUSTED_TYPE||!1,De=e.FORCE_BODY||!1,Oe=!1!==e.SANITIZE_DOM,Pe=e.SANITIZE_NAMED_PROPS||!1,Be=!1!==e.KEEP_CONTENT,Ue=e.IN_PLACE||!1,ge=e.ALLOWED_URI_REGEXP||V,Je=e.NAMESPACE||Ze,at=e.MATHML_TEXT_INTEGRATION_POINTS||at,rt=e.HTML_INTEGRATION_POINTS||rt,Me=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Me.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Me.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Me.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ae&&($e=!1),xe&&(Ie=!0),je&&(ve=F({},R),ze=[],!0===je.html&&(F(ve,w),F(ze,O)),!0===je.svg&&(F(ve,S),F(ze,P),F(ze,U)),!0===je.svgFilters&&(F(ve,k),F(ze,P),F(ze,U)),!0===je.mathMl&&(F(ve,I),F(ze,B),F(ze,U))),e.ADD_TAGS&&(ve===Te&&(ve=N(ve)),F(ve,e.ADD_TAGS,ot)),e.ADD_ATTR&&(ze===Le&&(ze=N(ze)),F(ze,e.ADD_ATTR,ot)),e.ADD_URI_SAFE_ATTR&&F(Ve,e.ADD_URI_SAFE_ATTR,ot),e.FORBID_CONTENTS&&(Ge===qe&&(Ge=N(Ge)),F(Ge,e.FORBID_CONTENTS,ot)),Be&&(ve["#text"]=!0),Se&&F(ve,["html","head","body"]),ve.table&&(F(ve,["tbody"]),delete Ee.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw M('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw M('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ae=e.TRUSTED_TYPES_POLICY,re=ae.createHTML("")}else void 0===ae&&(ae=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let a=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(a=t.getAttribute(r));const i="dompurify"+(a?"#"+a:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(H,s)),null!==ae&&"string"==typeof re&&(re=ae.createHTML(""));n&&n(e),st=e}},pt=F({},[...S,...k,...D]),ft=F({},[...I,...x]),bt=function(e){f(r.removed,{element:e});try{te(e).removeChild(e)}catch(t){X(e)}},mt=function(e,t){try{f(r.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){f(r.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(Ie||xe)try{bt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},yt=function(e){let t=null,a=null;if(De)e="<remove></remove>"+e;else{const t=h(e,/^[\r\n\t ]+/);a=t&&t[0]}"application/xhtml+xml"===nt&&Je===Ze&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const r=ae?ae.createHTML(e):e;if(Je===Ze)try{t=(new q).parseFromString(r,nt)}catch(e){}if(!t||!t.documentElement){t=ie.createDocument(Je,"template",null);try{t.documentElement.innerHTML=Qe?re:r}catch(e){}}const n=t.body||t.documentElement;return e&&a&&n.insertBefore(i.createTextNode(a),n.childNodes[0]||null),Je===Ze?oe.call(t,Se?"html":"body")[0]:Se?t.documentElement:n},ht=function(e){return ne.call(e.ownerDocument||e,e,C.SHOW_ELEMENT|C.SHOW_COMMENT|C.SHOW_TEXT|C.SHOW_PROCESSING_INSTRUCTION|C.SHOW_CDATA_SECTION,null)},gt=function(e){return e instanceof G&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof j)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},vt=function(e){return"function"==typeof _&&e instanceof _};function Tt(e,t,a){c(e,(e=>{e.call(r,t,a,st)}))}const zt=function(e){let t=null;if(Tt(ue.beforeSanitizeElements,e,null),gt(e))return bt(e),!0;const a=ot(e.nodeName);if(Tt(ue.uponSanitizeElement,e,{tagName:a,allowedTags:ve}),e.hasChildNodes()&&!vt(e.firstElementChild)&&L(/<[/\w]/g,e.innerHTML)&&L(/<[/\w]/g,e.textContent))return bt(e),!0;if(7===e.nodeType)return bt(e),!0;if(we&&8===e.nodeType&&L(/<[/\w]/g,e.data))return bt(e),!0;if(!ve[a]||Ee[a]){if(!Ee[a]&&Mt(a)){if(Me.tagNameCheck instanceof RegExp&&L(Me.tagNameCheck,a))return!1;if(Me.tagNameCheck instanceof Function&&Me.tagNameCheck(a))return!1}if(Be&&!Ge[a]){const t=te(e)||e.parentNode,a=ee(e)||e.childNodes;if(a&&t)for(let r=a.length-1;r>=0;--r){const i=Y(a[r],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,Z(e))}}return bt(e),!0}return e instanceof $&&!function(e){let t=te(e);t&&t.tagName||(t={namespaceURI:Je,tagName:"template"});const a=m(e.tagName),r=m(t.tagName);return!!et[e.namespaceURI]&&(e.namespaceURI===Ke?t.namespaceURI===Ze?"svg"===a:t.namespaceURI===Xe?"svg"===a&&("annotation-xml"===r||at[r]):Boolean(pt[a]):e.namespaceURI===Xe?t.namespaceURI===Ze?"math"===a:t.namespaceURI===Ke?"math"===a&&rt[r]:Boolean(ft[a]):e.namespaceURI===Ze?!(t.namespaceURI===Ke&&!rt[r])&&!(t.namespaceURI===Xe&&!at[r])&&!ft[a]&&(it[a]||!pt[a]):!("application/xhtml+xml"!==nt||!et[e.namespaceURI]))}(e)?(bt(e),!0):"noscript"!==a&&"noembed"!==a&&"noframes"!==a||!L(/<\/no(script|embed|frames)/i,e.innerHTML)?(Ae&&3===e.nodeType&&(t=e.textContent,c([ce,de,pe],(e=>{t=g(t,e," ")})),e.textContent!==t&&(f(r.removed,{element:e.cloneNode()}),e.textContent=t)),Tt(ue.afterSanitizeElements,e,null),!1):(bt(e),!0)},Lt=function(e,t,a){if(Oe&&("id"===t||"name"===t)&&(a in i||a in ut))return!1;if($e&&!_e[t]&&L(fe,t));else if(Fe&&L(be,t));else if(!ze[t]||_e[t]){if(!(Mt(e)&&(Me.tagNameCheck instanceof RegExp&&L(Me.tagNameCheck,e)||Me.tagNameCheck instanceof Function&&Me.tagNameCheck(e))&&(Me.attributeNameCheck instanceof RegExp&&L(Me.attributeNameCheck,t)||Me.attributeNameCheck instanceof Function&&Me.attributeNameCheck(t))||"is"===t&&Me.allowCustomizedBuiltInElements&&(Me.tagNameCheck instanceof RegExp&&L(Me.tagNameCheck,a)||Me.tagNameCheck instanceof Function&&Me.tagNameCheck(a))))return!1}else if(Ve[t]);else if(L(ge,g(a,ye,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==v(a,"data:")||!He[e])if(Ce&&!L(me,g(a,ye,"")));else if(a)return!1;return!0},Mt=function(e){return"annotation-xml"!==e&&h(e,he)},Et=function(e){Tt(ue.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||gt(e))return;const a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ze,forceKeepAttr:void 0};let i=t.length;for(;i--;){const n=t[i],{name:l,namespaceURI:o,value:s}=n,u=ot(l);let d="value"===l?s:T(s);if(a.attrName=u,a.attrValue=d,a.keepAttr=!0,a.forceKeepAttr=void 0,Tt(ue.uponSanitizeAttribute,e,a),d=a.attrValue,!Pe||"id"!==u&&"name"!==u||(mt(l,e),d="user-content-"+d),we&&L(/((--!?|])>)|<\/(style|title)/i,d)){mt(l,e);continue}if(a.forceKeepAttr)continue;if(mt(l,e),!a.keepAttr)continue;if(!Ne&&L(/\/>/i,d)){mt(l,e);continue}Ae&&c([ce,de,pe],(e=>{d=g(d,e," ")}));const f=ot(e.nodeName);if(Lt(f,u,d)){if(ae&&"object"==typeof H&&"function"==typeof H.getAttributeType)if(o);else switch(H.getAttributeType(f,u)){case"TrustedHTML":d=ae.createHTML(d);break;case"TrustedScriptURL":d=ae.createScriptURL(d)}try{o?e.setAttributeNS(o,l,d):e.setAttribute(l,d),gt(e)?bt(e):p(r.removed)}catch(e){}}}Tt(ue.afterSanitizeAttributes,e,null)},_t=function e(t){let a=null;const r=ht(t);for(Tt(ue.beforeSanitizeShadowDOM,t,null);a=r.nextNode();)Tt(ue.uponSanitizeShadowNode,a,null),zt(a),Et(a),a.content instanceof u&&e(a.content);Tt(ue.afterSanitizeShadowDOM,t,null)};return r.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null,i=null,n=null,o=null;if(Qe=!e,Qe&&(e="\x3c!--\x3e"),"string"!=typeof e&&!vt(e)){if("function"!=typeof e.toString)throw M("toString is not a function");if("string"!=typeof(e=e.toString()))throw M("dirty is not a string, aborting")}if(!r.isSupported)return e;if(ke||dt(t),r.removed=[],"string"==typeof e&&(Ue=!1),Ue){if(e.nodeName){const t=ot(e.nodeName);if(!ve[t]||Ee[t])throw M("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof _)a=yt("\x3c!----\x3e"),i=a.ownerDocument.importNode(e,!0),1===i.nodeType&&"BODY"===i.nodeName||"HTML"===i.nodeName?a=i:a.appendChild(i);else{if(!Ie&&!Ae&&!Se&&-1===e.indexOf("<"))return ae&&Re?ae.createHTML(e):e;if(a=yt(e),!a)return Ie?null:Re?re:""}a&&De&&bt(a.firstChild);const s=ht(Ue?e:a);for(;n=s.nextNode();)zt(n),Et(n),n.content instanceof u&&_t(n.content);if(Ue)return e;if(Ie){if(xe)for(o=le.call(a.ownerDocument);a.firstChild;)o.appendChild(a.firstChild);else o=a;return(ze.shadowroot||ze.shadowrootmode)&&(o=se.call(l,o,!0)),o}let d=Se?a.outerHTML:a.innerHTML;return Se&&ve["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&L(K,a.ownerDocument.doctype.name)&&(d="<!DOCTYPE "+a.ownerDocument.doctype.name+">\n"+d),Ae&&c([ce,de,pe],(e=>{d=g(d,e," ")})),ae&&Re?ae.createHTML(d):d},r.setConfig=function(){dt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),ke=!0},r.clearConfig=function(){st=null,ke=!1},r.isValidAttribute=function(e,t,a){st||dt({});const r=ot(e),i=ot(t);return Lt(r,i,a)},r.addHook=function(e,t){"function"==typeof t&&f(ue[e],t)},r.removeHook=function(e,t){if(void 0!==t){const a=d(ue[e],t);return-1===a?void 0:b(ue[e],a,1)[0]}return p(ue[e])},r.removeHooks=function(e){ue[e]=[]},r.removeAllHooks=function(){ue={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},r}();!function(){const e=/^[0-9]+$/,t=(a,r)=>Array.isArray(a)?a.map((e=>t(e,r))).join(" , "):"string"==typeof a?!r&&e.test(a)?a:`'${a.replaceAll("'","''")}'`:a;lizMap.events.on({uicreated:function(){var e=lizMap.config,a=(lizMap.layers,!1),r={},i={},n=globalThis.lizUrls.media+"?"+new URLSearchParams(globalThis.lizUrls.params),l=!1;"undefined"!=typeof lizLayerFilter&&(l=!0,lizMap.lizmapLayerFilterActive=!0);var o=!1;if("limitDataToBbox"in e.options&&"True"==e.options.limitDataToBbox&&(o=!0),!("attributeLayers"in e))return-1;var s=lizMap.getVectorLayerFeatureTypes();if(0==s.length)return-1;$("body").css("cursor","wait");var u=[];for(var c in e.attributeLayers)(p=e.attributeLayers[c]).name=c,u.push(p);u.sort((function(e,t){return e.order-t.order}));for(var d=0;d<u.length;d++){var p=u[d];r[lizMap.cleanName(p.name)]=p.name}for(const t of s){var f=t.getElementsByTagName("Name")[0].textContent,b=lizMap.getNameByTypeName(f);if(b&&null!=b&&lizMap.mainLizmap.state.layersAndGroupsCollection.layerNames.includes(b)){var m=lizMap.cleanName(b),y=r[m];if(i[m]=f,y in e.attributeLayers){a=!0;var h=e.attributeLayers[y];e.layers[y].features={},e.layers[y].featureCrs=null,e.layers[y].featuresFullSet=!1,e.layers[y].selectedFeatures=[],e.layers[y].highlightedFeature=null,e.layers[y].filteredFeatures=[],e.layers[y].request_params={filter:null,exp_filter:null,selection:null};const i=lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(b);i.isFiltered&&(e.layers[y].request_params.filter=i.expressionFilter,lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:r[m],filter:e.layers[y].request_params.filter,updateDrawing:!1})),void 0===e.layers[y].geometryType&&(e.layers[y].geometryType="unknown"),e.layers[y].crs=t.getElementsByTagName("SRS")[0].textContent,""!==e.layers[y].crs&&lizMap.loadProjDefinition(e.layers[y].crs,(function(t){new OpenLayers.Projection(e.layers[y].crs)}));var g=t.getElementsByTagName("LatLongBoundingBox")[0];h.bbox=[parseFloat(g.getAttribute("minx")),parseFloat(g.getAttribute("miny")),parseFloat(g.getAttribute("maxx")),parseFloat(g.getAttribute("maxy"))]}}}if(!a)return $("#mapmenu li.attributeLayers").hide(),-1;var v=!1,T='<table id="attribute-layer-list-table" class="table table-condensed table-hover table-striped" style="width:auto;">';for(var z in r)m=z,"pivot"in e.attributeLayers[r[m]]&&"True"==e.attributeLayers[r[m]].pivot||"hideLayer"in e.attributeLayers[r[m]]&&"True"==e.attributeLayers[r[m]].hideLayer||(T+="<tr>",T+="   <td>"+e.layers[r[m]].title+"</td><td><button value="+m+' class="btn btn-open-attribute-layer">'+lizDict["attributeLayers.toolbar.btn.detail"]+"</button></td>",T+="</tr>",v=!0);function L(e){const t=lizMap.mainLizmap.map.getView().getResolution();if(!(e.getMaxResolution()>t&&t>e.getMinResolution())){const e=lizDict["attributeLayers.msg.layer.not.visible"];return lizMap.addMessage(e,"info",!0).attr("id","lizmap-attribute-message"),!0}return!1}function M(t,a,r,i,n){let l=lizMap.config.layers[t];const o=l?.shortname||l?.typename||l?.name,s={TYPENAME:o,GEOMETRYNAME:"extent"};if(a&&(s.EXP_FILTER=a),"True"==e.options?.limitDataToBbox){const e=lizMap.mainLizmap.map.getView().calculateExtent(),t=lizMap.mainLizmap.transformExtent(e,lizMap.mainLizmap.map.getView().getProjection().getCode(),"EPSG:4326");s.BBOX=t,s.SRSNAME="EPSG:4326"}let u=[lizMap.mainLizmap.wfs.getFeature(s)],c={getFeature:u.length-1};if(!l?.alias||!l?.types){const e=lizMap.mainLizmap.wfs.describeFeatureType({TYPENAME:o});u.push(e),c.describeFeatureType=u.length-1}const d={};c.keyValues=u.length+0;let p=u.length+0;for(const e in lizMap.keyValueConfig?.[t]){const a=lizMap.keyValueConfig[t][e];if("ValueMap"==a.type)d[e]=a.data;else{let t=lizMap.getLayerConfigById(a.source_layer_id);if(!t||2!=t.length)continue;const r=t[1].typename;if(null==r)continue;d[e]=p,p++,u.push(lizMap.mainLizmap.wfs.getFeature({TYPENAME:r,PROPERTYNAME:a.code_field+","+a.label_field,EXP_FILTER:a.exp_filter?a.exp_filter:""}))}}if(i)return A(t,r,[],l.aliases,l.types,d,n);document.body.style.cursor="progress",Promise.all(u).then((e=>{for(let a=c.keyValues;a<e.length;a++){const r=Object.keys(d).find((e=>d[e]===a)),i=lizMap.keyValueConfig[t][r].code_field,n=lizMap.keyValueConfig[t][r].label_field,l={};e[a].features.forEach((e=>l[e.properties[i]]=e.properties[n])),d[r]=l}if(l.featureCrs="EPSG:4326",c?.describeFeatureType){const t=e[c.describeFeatureType];l.aliases=t.aliases,l.types=t.types,l.columns=t.columns}A(t,r,e[0].features,l.aliases,l.types,d,n),document.body.style.cursor="default"})).catch((()=>{document.body.style.cursor="default"}))}function E(t){var a={},r=lizMap.getLayerConfigById(t,e.attributeLayers,"layerId");if(!r)return!1;a.name=r[0];var i=e.layers[r[0]].selectedFeatures;if(!(i.length>0))return!1;var n=[],l=e.layers[r[0]].features;if(!l||Object.keys(l).length<=0)return!1;var o=r[1].primaryKey,s=/^[0-9]+$/;for(var u in i){var c=l[i[u]];if(void 0!==c){var d=c.properties[o];s.test(d)||(d=" '"+d+"' "),n.push(d)}}return a.selected=n,a}function _(t){var a=null,r=[],i=[],n="",l=[],o="",s=[],u=e.layers[t];if(!u)return a;var c=u.id;if("relations"in e&&c in e.relations){var d=e.relations[c],p=0,f="active";for(var b in d){var m=d[b],y=lizMap.getLayerConfigById(m.referencingLayer,e.layers,"id"),h=!1,g=null,v=null;if(y&&y[0]in e.attributeLayers){(v=j(c,y[1]))&&v.config&&v.config[0]in e.attributeLayers&&(g=y,h=!0),(p+=1)>1&&(f="");var T=h?v.config[1]:y[1],z=h?v.config[0]:y[0],L=e.attributeLayers[z];if("hideAsChild"in L&&"True"==L.hideAsChild)continue;var M="attribute-child-tab-"+lizMap.cleanName(t)+"-"+lizMap.cleanName(z),E='<div class="tab-pane attribute-layer-child-content '+f+'" id="'+M+'" >',_="attribute-layer-table-"+lizMap.cleanName(t)+"-"+lizMap.cleanName(z),F="attribute-table-table table table-hover table-condensed table-striped cell-border child-of-"+lizMap.cleanName(t);E+='    <input type="hidden" class="attribute-table-hidden-parent-layer" value="'+lizMap.cleanName(t)+'">',E+='    <input type="hidden" class="attribute-table-hidden-layer" value="'+lizMap.cleanName(z)+'">',E+='    <table id="'+_+'" class="'+F+'" width="100%"></table>',E+="</div>",r.push(E);var $='<li id="nav-tab-'+M+'" class="'+f+'"><a href="#'+M+'" data-toggle="tab">'+T.title+"</a></li>";i.push($);var C=!1;if("editionLayers"in e&&(z in e.editionLayers&&"True"==e.editionLayers[z].capabilities.createFeature&&(C=!0),C&&h&&(C=g[0]in e.editionLayers&&e.editionLayers[g[0]]&&"True"==e.editionLayers[g[0]].capabilities.createFeature)),C){let e=`\n                                    <button class="btn btn-mini btn-createFeature-attributeTable new-child" data-pivot="${h?g[1].id:""}" value="${lizMap.cleanName(z)}" title="${lizDict["attributeLayers.toolbar.btn.data.createFeature.title"]}">\n                                    ➕ ${T.title}\n                                    </button>\n                                `;l.push(e),s.push('<li><a href="#'+lizMap.cleanName(h?g[0]:z)+'" class="btn-linkFeatures-attributeTable">'+(h?g[1].title:T.title)+"</a></li>")}}}}if(i.length){if(l.length>0){for(var N in n+='&nbsp;<span class="edition-children-add-buttons">',l)n+=l[N];n+="</span>"}if(s.length>0){for(var N in o+='&nbsp;<div class="btn-group" role="group" >',o+='    <button type="button" class="btn btn-mini dropdown-toggle" data-toggle="dropdown" aria-expanded="false">',o+=lizDict["attributeLayers.toolbar.btn.data.linkFeatures.title"],o+='      <span class="caret"></span>',o+="    </button>",o+='    <ul class="dropdown-menu" role="menu">',s)o+=s[N];o+="    </ul>",o+="</div>"}a={"tab-content":r,"tab-li":i,childCreateButton:n,layerLinkButton:o}}return a}T+="</table>",v?($("#attribute-layer-list").html(T),$("button.btn-open-attribute-layer").click((function(){var t=$(this).val();if(o){let e=lizMap.mainLizmap.map.getLayerByName(lizMap.getLayerNameByCleanName(t));if(e&&L(e))return!1}const a=r[t];return $("#nav-tab-attribute-layer-"+t).length||function(t){e.attributeLayers[t];var a=lizMap.cleanName(t),i='<li id="nav-tab-attribute-layer-'+a+'">';i+='<a href="#attribute-layer-'+a+'" data-toggle="tab">'+e.layers[t].title,i+='&nbsp;<i class="btn-close-attribute-tab icon-remove icon-white" style="cursor:pointer"></i>',i+="</a>",i+="</li>",$("#attributeLayers-tabs").append(i);var n='<div id="attribute-layer-'+a+'" class="tab-pane attribute-content bottom-content" >';n+='    <div class="attribute-layer-main" id="attribute-layer-main-'+a+'" >',e.layers[t].selectedFeatures||(e.layers[t].selectedFeatures=[]),e.layers[t].filteredFeatures||(e.layers[t].filteredFeatures=[]);var s="";0==e.layers[t].selectedFeatures.length&&(s=" hidden");var u;u=e.layers[t].filteredFeatures.length>0?" active btn-primary":s,n+='<div class="attribute-layer-action-bar">',n+='<div class="btn-group">',n+='  <input id="attribute-layer-search-'+a+'" type="search" class="form-control" placeholder="'+lizDict["attributeLayers.toolbar.input.search.title"]+'">',n+='  <i class="clear-layer-search icon-remove" style="position:absolute;right:4px;top:4px;cursor:pointer;"></i>',n+="</div>",n+='<button class="btn-select-searched btn btn-mini" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.btn.select.searched.title"]+'"><i class="icon-star"></i></button>',n+='    <button class="btn-unselect-attributeTable btn btn-mini'+s+'" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.btn.data.unselect.title"]+'"><i class="icon-star-empty"></i></button>',n+='    <button class="btn-moveselectedtotop-attributeTable btn btn-mini'+s+'" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.btn.data.moveselectedtotop.title"]+'"><i class="icon-arrow-up"></i></button>',l||lizMap.lizmapLayerFilterActive&&lizMap.lizmapLayerFilterActive!=t||(n+='    <button class="btn-filter-attributeTable btn btn-mini'+u+'" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.btn.data.filter.title"]+'"><i class="icon-filter"></i></button>'),n+='<lizmap-selection-invert tooltip-placement="bottom" feature-type="'+a+'"></lizmap-selection-invert>';var c=!1;e.layers[t]&&"True"==e.layers[t].popup&&"unknown"!=e.layers[t].geometryType&&(c=!0),c&&(n+='<button type="checkbox" class="btn-detail-attributeTable btn btn-mini" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.cb.data.detail.title"]+'">',n+='<i class="icon-info-sign"></i>',n+="</button>");var d=!1;"editionLayers"in e&&a in r&&r[a]in e.editionLayers&&"True"==e.editionLayers[r[a]].capabilities.createFeature&&(d=!0),d&&(n+='    <button class="btn-createFeature-attributeTable btn btn-mini" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.btn.data.createFeature.title"]+'"><i class="icon-plus-sign"></i></button>'),o&&"none"!=e.layers[t].geometryType&&"unknown"!=e.layers[t].geometryType&&(n+='<button class="btn-refresh-table btn btn-mini" value="'+a+'" title="'+lizDict["attributeLayers.toolbar.btn.refresh.table.tooltip"]+'">'+lizDict["attributeLayers.toolbar.btn.refresh.table.title"]+"</button>");var p=_(t),f="";if(p&&(n+='    <button class="btn-toggle-children btn btn-mini" value="'+a+'" >'+lizDict["attributeLayers.toolbar.btn.toggle.children.title"]+"</button>",p.childCreateButton&&(n+=p.childCreateButton),p.layerLinkButton&&(n+=p.layerLinkButton)),"exportLayers"in e.options&&"True"==e.options.exportLayers){n+='&nbsp;<div class="export-formats btn-group pull-right" role="group" >',n+='    <button type="button" class="btn btn-mini dropdown-toggle exportLayer" data-toggle="dropdown" aria-expanded="false">',n+=lizDict["attributeLayers.toolbar.btn.data.export.title"],n+='      <span class="caret"></span>',n+="    </button>",n+='    <ul class="dropdown-menu" role="menu">',n+='        <li><a href="#" class="btn-export-attributeTable">GeoJSON</a></li>',n+='        <li><a href="#" class="btn-export-attributeTable">GML</a></li>';for(var b=lizMap.getVectorLayerResultFormat(),m=0,y=b.length;m<y;m++){var h=b[m].toLowerCase();"gml2"!=h&&"gml3"!=h&&"geojson"!=h&&(n+='        <li><a href="#" class="btn-export-attributeTable">'+h+"</a></li>")}n+="    </ul>",n+="</div>"}if(n+="</div>",p&&(f=" showChildren"),n+='<div class="attribute-layer-content'+f+'">',n+='    <input type="hidden" class="attribute-table-hidden-layer" value="'+a+'">',n+='    <table id="attribute-layer-table-'+a+'" class="attribute-table-table table table-hover table-condensed table-striped order-column cell-border" width="100%"></table>',n+="</div>",p){for(var m in n+='<div class="tabbable attribute-layer-child-content">',n+='    <ul class="nav nav-tabs">',p["tab-li"])n+=p["tab-li"][m];for(var m in n+="    </ul>",n+='    <div class="tab-content">',p["tab-content"])n+=p["tab-content"][m];n+="    </div>",n+="</div>"}n+="</div>",n+='    <div class="attribute-layer-feature-panel" id="attribute-table-panel-'+a+'" ></div>',n+="</div>",$("#attribute-table-container").append(n),$("#attribute-layer-"+a+" button").tooltip({placement:"bottom"}),$(".btn-close-attribute-tab").click((function(){var e=$(this).parent().attr("href");$(this).parent().parent().remove(),$("#attributeLayers-tabs a:last").tab("show"),$(e).remove()})),p&&$("#attribute-layer-"+a+' div.attribute-layer-child-content ul li a[data-toggle="tab"]').on("shown.bs.tab",(function(e){var t=$(e.target).attr("href");$(t).find("table.dataTable").DataTable().tables().columns.adjust()})),o&&$("#attribute-layer-"+a+" button.btn-refresh-table").click((function(){$(this).attr("data-original-title",lizDict["attributeLayers.toolbar.btn.refresh.table.tooltip"]).removeClass("btn-warning");let e=lizMap.mainLizmap.map.getLayerByName(lizMap.getLayerNameByCleanName(a));if(!e)return!1;if(L(e))return!1;const r="#attribute-layer-table-"+a;return $("#attribute-layer-main-"+a+" > div.attribute-layer-content").hide(),M(t,null,r,!1,(()=>{$("#attribute-layer-main-"+a+" > div.attribute-layer-content").show(),U("#attribute-layer-main-"+a)})),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),p&&$("#attribute-layer-"+a+" button.btn-toggle-children").click((function(){var e=$(this).parents("div.attribute-layer-main");return e.find("div.attribute-layer-content").toggleClass("showChildren"),e.find("div.tabbable.attribute-layer-child-content").toggle(),U("#attribute-layer-main-"+a),!1})),c&&$("#attribute-layer-"+a+" button.btn-detail-attributeTable").click((function(){return $("#attribute-layer-main-"+a).toggleClass("reduced",!$(this).hasClass("btn-primary")),$("#attribute-table-panel-"+a).toggleClass("visible",!$(this).hasClass("btn-primary")),$(this).toggleClass("btn-primary"),U("#attribute-layer-main-"+a),!1})),$("#attribute-layer-"+a+" button.btn-unselect-attributeTable").click((function(){var e=r[$(this).val()];return lizMap.events.triggerEvent("layerfeatureunselectall",{featureType:e,updateDrawing:!0}),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),$("#attribute-layer-"+a+" button.btn-moveselectedtotop-attributeTable").click((function(){var e="#attribute-layer-table-"+$(this).val(),t=$(e).DataTable(),a=t.order();a=$.grep(a,(function(e){return 0!=e[0]}));var r=[[0,"asc"]].concat(a);return t.order(r).draw(),$(e).parents("div.attribute-layer-content").scrollTop(0),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),l||$("#attribute-layer-"+a+" button.btn-filter-attributeTable").click((function(){var e=r[$(this).val()];return $(this).hasClass("btn-primary")?(lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:e}),lizMap.lizmapLayerFilterActive=null):(lizMap.events.triggerEvent("layerfeaturefilterselected",{featureType:e}),lizMap.lizmapLayerFilterActive=e),!1})),$("#attribute-layer-"+a+" a.btn-export-attributeTable").click((function(){var e=$(this).text();"GML"==e&&(e="GML3");var t=$(this).parents("div.attribute-layer-main:first").attr("id").replace("attribute-layer-main-",""),a=r[t];return lizMap.exportVectorLayer(a,e,o),$(this).blur(),!1})),$("#attribute-layer-"+a+" button.btn-createFeature-attributeTable").click((function(){const t=$(this).hasClass("new-child")?"child":"parent";if("child"==t&&1!=$("#attribute-layer-"+a+" tr.active").length)return $("#lizmap-edition-message").remove(),lizMap.addMessage(lizDict["attributeLayers.toolbar.btn.data.createChildFeature.no.actived"],"info",!0).attr("id","lizmap-edition-message"),!1;const i=document.querySelector("#attribute-layer-"+a+" tr.active lizmap-feature-toolbar");var n=i?i.fid:null,l=r[a],o=e.layers[l].id,s=r[$(this).val()],u=$(this).attr("data-pivot"),c=e.layers[s].id;return"parent"==t?lizMap.launchEdition(c,null,null):lizMap.getLayerFeature(l,n,(function(e){lizMap.launchEdition(c,null,{layerId:o,feature:e,pivotId:u})})),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),$("#attribute-layer-"+a+" a.btn-createFeature-attributeTable").click((function(){if(1!=$("#attribute-layer-"+a+" tr.active").length)return $("#lizmap-edition-message").remove(),lizMap.addMessage(lizDict["attributeLayers.toolbar.btn.data.createChildFeature.no.actived"],"info",!0).attr("id","lizmap-edition-message"),!1;var t=document.querySelector("#attribute-layer-"+a+" tr.active lizmap-feature-toolbar").fid,i=r[a],n=e.layers[i].id,l=$(this).attr("href").replace("#",""),o=r[l];return lizMap.getLayerFeature(i,t,(function(t){var a=e.layers[o].id;lizMap.launchEdition(a,null,{layerId:n,feature:t}),$(this).blur()})),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),$("#attribute-layer-"+a+" a.btn-linkFeatures-attributeTable").click((function(){var t=$(this).attr("href").replace("#","");$(this).blur();var i=r[t],n=e.layers[i].id,l=e.attributeLayers[i],o=[],s=r[a],u=e.layers[s].id,c=!1;if("pivot"in l&&"True"==l.pivot&&n in e.relations.pivot){for(var d in e.relations.pivot[n]){if(!(f=E(d)))return!1;f.id=d;var p=e.relations.pivot[n][d];f.fkey=p,o.push(f)}if(2!=o.length)return!1;c="pivot"}else{var f=E(u),b=E(n);if(!f||!b)return!1;if(f.id=u,f.fkey=e.attributeLayers[i].primaryKey,b.id=n,!(u in e.relations))return!1;for(var m in e.relations[u]){var y=e.relations[u][m];y.referencingLayer==n&&(b.fkey=y.referencingField)}if(!("fkey"in b))return!1;o.push(f),o.push(b),c="1n"}if(c){var h=globalThis.lizUrls.edition+"?"+new URLSearchParams(globalThis.lizUrls.params);$.post(h.replace("getFeature","linkFeatures"),{features1:o[0].id+":"+o[0].fkey+":"+o[0].selected.join(),features2:o[1].id+":"+o[1].fkey+":"+o[1].selected.join(),pivot:n},(function(e){if($("#lizmap-edition-message").remove(),lizMap.addMessage(e,"info",!0).attr("id","lizmap-edition-message"),"pivot"==c){lizMap.events.triggerEvent("layerfeatureunselectall",{featureType:r[a],updateDrawing:!0});var t=lizMap.config.layers[r[a]]?.id;if(t){var l=lizMap.config.relations.pivot[n],o=Object.keys(l).filter((e=>e!=t))?.[0];o&&(n=o)}lizMap.events.triggerEvent("lizmapeditionfeaturecreated",{layerId:n})}else lizMap.events.triggerEvent("layerfeatureunselectall",{featureType:i,updateDrawing:!0}),lizMap.events.triggerEvent("lizmapeditionfeaturemodified",{layerId:n})}))}return!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),$("#attribute-layer-"+a+" button.btn-select-searched").click((function(){var e=r[$(this).val()];return lizMap.events.triggerEvent("layerfeatureselectsearched",{featureType:e,updateDrawing:!0}),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")}))}(a),M(a,"request_params"in e.layers[a]&&e.layers[a].request_params.exp_filter?e.layers[a].request_params.exp_filter:null,"#attribute-layer-table-"+t,!1),$("#nav-tab-attribute-layer-"+t+" a").tab("show"),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),$('#jforms_view_attribute_layers_option_cascade_label input[name="cascade"]').change((function(){var t=$('#jforms_view_attribute_layers_option_cascade_label input[name="cascade"]').prop("checked");if(lizMap.lizmapLayerFilterActive){var a=lizMap.lizmapLayerFilterActive;if(e.layers[a].filteredFeatures){P(a);var r=!0;t||(r="removeChildrenFilter"),O(a,r)}}}))):$("#mapmenu li.attributeLayers").hide(),lizMap.events.triggerEvent("attributeLayersReady",{layers:r}),o&&lizMap.mainLizmap.map.on("moveend",(()=>{let e=lizDict["attributeLayers.toolbar.btn.refresh.table.tooltip.changed"];e+=" "+lizDict["attributeLayers.toolbar.btn.refresh.table.tooltip"],$("button.btn-refresh-table").attr("data-original-title",e).addClass("btn-warning").tooltip()})),$("#attributeLayers-tabs li").click((function(){U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))})),$("body").css("cursor","auto");var F,C=(F=0,function(e,t){clearTimeout(F),F=setTimeout(e,t)});function N(t,a,r,i){var n=e.layers[t],l=lizMap.cleanName(t),o=!0;let s="";if(["#attribute-layer-table-","#edition-table-"].includes(a.replace(l,"")))o=!1;else{let t="";a.startsWith("#attribute-layer-table-")?t=a.replace("#attribute-layer-table-","").split("-")[0]:a.startsWith("#edition-table-")&&(t=a.replace("#edition-table-","").split("-")[0]),t&&(s=e.layers[t].id)}var u=[];if(t in e.attributeLayers&&"hiddenFields"in e.attributeLayers[t]&&e.attributeLayers[t].hiddenFields&&(u=e.attributeLayers[t].hiddenFields.trim().split(/[\s,]+/)),!(r=void 0!==r?r:null)){var c=e.layers[t].features;r=Object.keys(c).map((function(e){return c[e]}))}return r&&r.length>0&&w(r,o,u,n.selectedFeatures,n.id,s).then((e=>{var t=e.foundFeatures,r=e.dataSet;if($.fn.dataTable.isDataTable(a)){var i=$(a).dataTable();i.fnClearTable(),i.fnAddData(r)}n.features=t})),r&&0!=r.length?$(a).show():($.fn.dataTable.isDataTable(a)&&$(a).dataTable().fnClearTable(),$(a).hide(),$("#attribute-layer-"+l+" span.attribute-layer-msg").html(lizDict["attributeLayers.toolbar.msg.data.nodata"]+" "+lizDict["attributeLayers.toolbar.msg.data.extent"]).addClass("failure")),i&&i(t,a),!1}function A(t,a,i,l,o,s,u){var c=e.layers[t],d=lizMap.cleanName(t);(l=void 0!==l?l:null)||(l=c.alias);for(const e in l)""==l[e]&&(l[e]=e);var p=!0;let f="";if(["#attribute-layer-table-","#edition-table-"].includes(a.replace(d,"")))p=!1;else{let t="";if(a.startsWith("#attribute-layer-table-")?t=a.replace("#attribute-layer-table-","").split("-")[0]:a.startsWith("#edition-table-")&&(t=a.replace("#edition-table-","").split("-")[0]),t){const a=lizMap.getLayerNameByCleanName(t);a&&(f=e.layers[a].id)}}p&&"pivot"in e.attributeLayers[t]&&e.attributeLayers[t].pivot;var b=null;if(f){var m,y=lizMap.getLayerConfigById(f);if(m=!a.startsWith("#attribute-layer-table-")&&a.startsWith("#edition-table-")?$('#edition-form-container form input[name="liz_featureId"]').val():e.layers[r[y[1].cleanname]].highlightedFeature,y&&y[1]&&y[1].cleanname&&m){var h=G(f,c.id);h&&(b=h+":"+m)}}var g=[];t in e.attributeLayers&&"hiddenFields"in e.attributeLayers[t]&&e.attributeLayers[t].hiddenFields&&(g=e.attributeLayers[t].hiddenFields.trim().split(/[\s,]+/));var v=!1,T=!1;if("editionLayers"in e&&t in e.editionLayers){var z=e.editionLayers[t];"True"!=z.capabilities.modifyAttribute&&"True"!=z.capabilities.modifyGeometry||(v=!0),"True"==z.capabilities.deleteFeature&&(T=!0)}if(!(i=void 0!==i?i:null)){var L=e.layers[t].features;i=Object.keys(L).map((function(e){return L[e]}))}var M=i,E=M.length;if(i&&i.length>0){var _=function(t,a,r,i,l,o){const s=[];let u=0;for(var c in s.push({data:"lizSelected",width:"25px",searchable:!1,sortable:!0,visible:!1}),u+=1,s.push({data:"featureToolbar",width:"25px",searchable:!1,sortable:!1}),u+=1,a[0].properties){if(r.includes(c))continue;const a={data:c,title:i[c]};if(o?.hasOwnProperty(c)){const e=o[c];a.render=function(t,a,r,i){if(Array.isArray(t))return t.map((t=>e[t]?e[t]:t)).join(", ");if(t&&"{"==t.toString().substring(0,1)&&"}"==t.toString().slice(-1)){var n=[],l=t.toString();let a=(l=l.substring(1,l.length-1)).split(",");for(var o in a){let t=a[o].replace(/"/g,"");n.push(e[t]?e[t]:t)}return n.length>0?n.join(", "):null}return e[t]?e[t]:t}}else if(["decimal","double"].includes(l?.[c]))a.render=function(e,t,a,r){return parseFloat(e)};else{let r=globalThis.lizUrls.webDavUrl&&globalThis.lizUrls?.resourceUrlReplacement?.webdav&&e.layers[t]?.webDavFields&&Array.isArray(e.layers[t].webDavFields)&&e.layers[t].webDavFields.includes(c);a.render=function(e,t,a,i){if(!e||"string"!=typeof e)return e;if(r&&e.startsWith(globalThis.lizUrls.webDavUrl)&&(e=e.replace(globalThis.lizUrls.webDavUrl,globalThis.lizUrls.resourceUrlReplacement.webdav)),"media/"==e.substring(0,6)||"/media/"==e.substring(0,7)||"../media/"==e.substring(0,9)){var l=e,o=i.settings.aoColumns[i.col];return"/media/"==e.substring(0,7)&&(l=e.slice(1)),'<a href="'+n+"&path="+l+'" target="_blank">'+o.title+"</a>"}return r&&e.substring(0,4)==globalThis.lizUrls.resourceUrlReplacement.webdav?(l=e,o=i.settings.aoColumns[i.col],'<a href="'+n+"&path="+l+'" target="_blank">'+o.title+"</a>"):"http"==e.substring(0,4)||"www"==e.substring(0,3)?(l=e,"www"==e.substring(0,3)&&(l="http://"+e),'<a href="'+l+'" target="_blank">'+e+"</a>"):e}}switch(l?.[c]){case"integer":case"int":case"unsignedInt":case"long":case"unsignedLong":case"decimal":case"double":a.className="text-right";break;case"date":a.className="text-center"}s.push(a)}var d={columns:s,firstDisplayedColIndex:2};if("attributetableconfig"in e.attributeLayers[t]&&e.attributeLayers[t].attributetableconfig&&!$.isEmptyObject(e.attributeLayers[t].attributetableconfig.columns)){var p=e.attributeLayers[t].attributetableconfig.columns.column;if(0==p.length)return d;var f=s.slice(0,2),b=s.slice(2),m=0;for(var y in p){var h=p[y];if("field"==h.attributes.type)for(var g=h.attributes.name,v=h.attributes.hidden,T=0;T<b.length;T++)if("data"in b[T]&&b[T].data===g){if("1"==v)b.splice(T,1);else{var z=T;b.splice(m,0,b.splice(z,1)[0]),m+=1}break}}var L=f.concat(b);d.columns=L}else if("columns"in e.layers[t]&&e.layers[t].columns&&Object.keys(e.layers[t].columns).length>0){f=s.slice(0,2),b=s.slice(2),m=0;for(const a in e.layers[t].columns){const r=e.layers[t].columns[a];for(T=0;T<b.length;T++)"data"in b[T]&&b[T].data===r&&(z=T,b.splice(m,0,b.splice(z,1)[0]),m+=1)}L=f.concat(b),d.columns=L}return d}(t,M,g,l,o,s),F=_.columns,N=_.firstDisplayedColIndex;w(M,p,g,c.selectedFeatures,c.id,f,b).then((r=>{var i=r.foundFeatures,n=r.dataSet,o=!1;if(0==(c.features?Object.keys(c.features).length:0)?(o=!0,p||(c.featuresFullSet=!0)):p?c.featuresFullSet||(o=!0):(c.featuresFullSet=!0,o=!0),o&&(c.features=i),c.alias=l,$.fn.dataTable.isDataTable(a))(f=$(a).dataTable()).fnClearTable(),f.fnAddData(n);else{var s=!0;E>5e5&&(s=!1);var u="<<t>ipl>";s?$("#attribute-layer-search-"+d).on("keyup",(function(e){var t=this.value;C((function(){f.fnFilter(t)}),500)})):u="<<t>ipl>",$(a).dataTable({data:n,columns:F,initComplete:function(e,t){const a=new $.fn.dataTable.Api(e).table().node().id.split("attribute-layer-table-")[1];lizMap.events.triggerEvent("attributeLayerContentReady",{featureType:a})},order:[[N,"asc"]],language:{url:globalThis.lizUrls.dataTableLanguage},deferRender:!0,createdRow:function(e,t,a){-1!=$.inArray(t.DT_RowId.toString(),c.selectedFeatures)&&($(e).addClass("selected"),t.lizSelected="a")},drawCallback:function(e){const t=document.getElementsByClassName("data-attr-thumbnail");for(let e of t)e.setAttribute("src",lizUrls.media+"?repository="+lizUrls.params.repository+"&project="+lizUrls.params.project+"&path="+e.dataset.src)},dom:u,pageLength:50,scrollY:"95%",scrollX:"100%"});var f=$(a).dataTable();s||$("#attribute-layer-search-"+d).hide(),$("#attribute-layer-search-"+d).next(".clear-layer-search").click((function(){$("#attribute-layer-search-"+d).val("").focus().keyup()})),$(a).on("page.dt",(function(){$(a+" tr").unbind("click"),$(a+" tr td button").unbind("click")})),$(a).on("draw.dt",(function(){return $(a+" tr").unbind("click"),$(a+" tr td button").unbind("click"),function(t,a){$(a+" tr").click((function(){$(a+" tr").removeClass("active"),$(this).addClass("active");var r=this.querySelector("lizmap-feature-toolbar").fid;lizMap.events.triggerEvent("layerfeaturehighlighted",{sourceTable:a,featureType:t,fid:r});var i=e.layers[t];if(i&&"True"==i.popup){var n=i.features[r],l=a.replace("#attribute-layer-table-","").split("-");l=l[0],$("#attribute-table-panel-"+l).html(""),lizMap.getFeaturePopupContent(t,n,(function(e){$("#attribute-table-panel-"+l).html(e),$("#attribute-table-panel-"+l+" table").addClass("table table-condensed table-striped table-bordered"),lizMap.events.triggerEvent("lizmappopupdisplayed_inattributetable");$("#attribute-table-panel-"+l+" h4").append('<a class="close-attribute-feature-panel pull-right" href="#"><i class="icon-remove"></i></a>'),$("#attribute-table-panel-"+l+" h4 a.close-attribute-feature-panel").click((function(){$("#attribute-layer-main-"+l).removeClass("reduced"),$("#attribute-table-panel-"+l).removeClass("visible").html(""),$("#attribute-layer-"+l+" button.btn-detail-attributeTable").removeClass("btn-primary")}))}))}}))}(t,a),U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id")),!1}))}(v||T)&&lizMap.mainLizmap.edition.fetchEditableFeatures([c.id])}))}return i&&0!=i.length?($(a).show(),U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))):($.fn.dataTable.isDataTable(a)&&$(a).dataTable().fnClearTable(),$(a).hide(),$("#attribute-layer-"+d+" span.attribute-layer-msg").html(lizDict["attributeLayers.toolbar.msg.data.nodata"]+" "+lizDict["attributeLayers.toolbar.msg.data.extent"]).addClass("failure")),u&&u(t,a),!1}function w(e,t,a,r,i,n,l=null){const o=e=>new Promise((t=>setTimeout(t,e))),s=(e,t,a,r,i,n,l=null)=>new Promise((o=>{const s=[],u={};e.forEach((function(e){const o={},c=e.id.split(".")[1];for(var d in u[c]=e,o.DT_RowId=c,o.lizSelected="z",r&&-1!=r.indexOf(c)&&(o.lizSelected="a"),o.featureToolbar=`<lizmap-feature-toolbar value="${i+"."+c}" `+(t?`parent-layer-id="${n}"`:"")+" "+(l?`pivot-layer="${l}"`:"")+"></lizmap-feature-toolbar>",e.properties)if(!(a.indexOf(d)>-1)){var p=e.properties[d];"string"==typeof p&&(p=ee.sanitize(p,{ADD_ATTR:["target"]})),o[d]=p}s.push(o)})),o({dataSet:s,foundFeatures:u})}));return new Promise((async u=>{let c=0,d=c+500,p=-1;var f=[],b={};do{const u=e.slice(c,d);if(p=u.length,0!=p){const e=await s(u,t,a,r,i,n,l);Object.assign(b,e.foundFeatures),f=f.concat(e.dataSet),await o(10),c=d,d=c+500}}while(0!==p);u({dataSet:f,foundFeatures:b})}))}function S(t,a,r,i=!1){M(t,a,r,i,(()=>{var a=!1,i=!1;if("editionLayers"in e&&t in e.editionLayers){var n=e.editionLayers[t];"True"==n.capabilities.createFeature&&(a=!0),"True"!=n.capabilities.modifyAttribute&&"True"!=n.capabilities.modifyGeometry||(i=!0)}$(r).one("draw.dt",(function(){if(i){const e=$(r).parents("div.tab-pane.attribute-layer-child-content").find("input.attribute-table-hidden-parent-feature-id").val();$(r).DataTable().cells().nodes().to$().children("lizmap-feature-toolbar").attr("parent-feature-id",e)}if(a){const t=$($(r).DataTable().column(1).header());0==t.find("button.attribute-layer-feature-create").length&&t.append(`<button class="btn btn-mini attribute-layer-feature-create" value="-1" title="${lizDict["attributeLayers.toolbar.btn.data.createFeature.title"]}">\n                                            <i class="icon-plus"></i>\n                                        </button>`).on("click","button.attribute-layer-feature-create",(function(){var t=$(this).parents("div.tab-pane.attribute-layer-child-content"),a=t.find("input.attribute-table-hidden-parent-feature-id").val(),r=t.find("input.attribute-table-hidden-parent-layer").val(),i=t.find("input.attribute-table-hidden-layer").val();return lizMap.getLayerFeature(r,a,(function(t){var a=e.layers[lizMap.getLayerNameByCleanName(r)].id,n=e.layers[lizMap.getLayerNameByCleanName(i)].id,l=G(n,a);lizMap.launchEdition(n,null,{layerId:a,feature:t,pivotId:l})})),!1}))}if(0==$(r).parents(".edition-children-content").children("ul.nav-tabs").children("li.active").length){var t=$(r).parents(".tab-pane.attribute-layer-child-content").attr("id");$(r).parents(".edition-children-content").find('ul.nav-tabs > li > a[href="#'+t+'"]').click()}return!1}))}))}function k(t,a){a=void 0===a||a,e.layers[t].selectedFeatures=[],lizMap.events.triggerEvent("layerSelectionChanged",{featureType:t,featureIds:e.layers[t].selectedFeatures,updateDrawing:a})}function D(a,r,i,n){if(0!=a.length){n=void 0===n||n;var l=a.shift(),o=r[l];o?function(a,r,i,n,l,o){if(r){l.push(a);lizMap.getFeatureData(a,r,null,"extent",!1,null,null,(function(s,u,c,d,p){var f=e.layers[a];f.features={};var b={};const m=f?.shortname||f.name;var y=c,h=f.id,g=e.attributeLayers[a].primaryKey,v=[],T={},z=lizMap.getLayerConfigById(h,e.attributeLayers,"layerId"),L=null;if(z&&(L=z[1]),"relations"in e&&h in e.relations&&o){var M=e.relations[h];for(var E in M){var _=I(M[E],l);_&&(T[_[0]]=_[1])}}var F=x(h,L,l),C=[];y.forEach((function(e){var a=e.id.split(".")[1];b[a]=e;var i="types"in f&&g in f.types&&"string"==f.types[g],n=t(e.properties[g],i);if(v.push(n),C.push(a),o&&r)for(var l in T){var s=T[l];T[l].parentValues.push("'"+e.properties[s.parentField]+"'")}if(F&&r){var u=F.otherParentRelation.referencingField;F.otherParentValues.push("'"+e.properties[u]+"'")}})),f.features=b,f.alias=d;var A=null;if(0==v.length&&v.push("-99999"),r&&(A=m+':"'+g+'" IN ( '+v.join(" , ")+" ) ",!r.startsWith("$id"))){var w=r;r.startsWith(m)||(w=m+":"+r),A=w}f.request_params.filter=A,f.request_params.exp_filter=r,r?fetch(globalThis.lizUrls.service,{method:"POST",body:new URLSearchParams({service:"WMS",request:"GETFILTERTOKEN",typename:m,filter:A})}).then((e=>e.json())).then((e=>{f.request_params.filtertoken=e.token,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(f.name).filterToken={expressionFilter:f.request_params.exp_filter,token:e.token}})):(f.request_params.filtertoken=null,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(f.name).expressionFilter=null);var S="#attribute-layer-table-"+lizMap.cleanName(a);if($(S).length&&N(a,S,y),lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:a,filter:A,updateDrawing:!0}),o)for(var k in T){var R=k,O=T[k],P=null,B=null;r&&O.parentValues.length>0&&"removeChildrenFilter"!=o?B='"'+O.fieldToFilter+'" IN ( '+O.parentValues.join(" , ")+" )":r&&"removeChildrenFilter"!=o&&(B='"'+O.fieldToFilter+'" IN ( -99999 )');const t=e.layers[R];P=(t?.shortname||t.name)+":"+B,t.request_params.filter=P,t.request_params.exp_filter=B,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(R).expressionFilter=B,n[k]=B,i.push(k)}F&&(P=null,B=null,r&&(F.otherParentValues.length>0?(B='"'+F.otherParentRelation.referencedField+'"',P=m+":"+(B+=" IN ( "+F.otherParentValues.join(" , ")+" )"),F.otherParentRelation.referencedField,F.otherParentValues):(P=m+":"+(B='"'+F.otherParentRelation.referencedField+"\" IN ( '-999999' )"),F.otherParentRelation.referencedField)),e.layers[F.otherParentTypeName].request_params.filter=P,e.layers[F.otherParentTypeName].request_params.exp_filter=B,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(F.otherParentTypeName).expressionFilter=B,n[F.otherParentTypeName]=B,i.push(F.otherParentTypeName)),i.length>0&&D(i,n,l,o)}))}else R(a,i,n,l,o)}(l,o,a,r,i,n):R(l,a,r,i,n),$("#layerActionUnfilter").toggle(null!==lizMap.lizmapLayerFilterActive)}}function I(t,a){var r=lizMap.getLayerConfigById(t.referencingLayer,e.attributeLayers,"layerId");if(!r)return null;var i=r[0],n=r[1];if(-1!=$.inArray(i,a))return null;var l=!1;return"pivot"in n&&"True"==n.pivot&&n.layerId in e.relations.pivot&&(l=!0),[i,{filter:null,fieldToFilter:t.referencingField,parentField:t.referencedField,parentValues:[],pivot:l,otherParentTypeName:null,otherParentRelation:null,otherParentValues:[]}]}function x(t,a,r){var i=!1,n=null;if("pivot"in a&&"True"==a.pivot&&a.layerId in e.relations.pivot&&(i=!0),!i)return n;var l=null,o=null,s=null;for(var u in e.relations)if("pivot"!=u&&u!=t&&(!(p=lizMap.getLayerConfigById(u,e.attributeLayers,"layerId"))||-1==$.inArray(p[0],r))){var c=e.relations[u];for(var d in c){var p;c[d].referencingLayer==a.layerId&&(l=u,o=c[d],s=(p=lizMap.getLayerConfigById(u,e.attributeLayers,"layerId"))[0])}}return l&&o&&((n={}).otherParentTypeName=s,n.otherParentRelation=o,n.otherParentValues=[]),n}function R(t,a,r,i,n){i.push(t);var l=e.layers[t];l.features={};var o=l.id,s={},u=lizMap.getLayerConfigById(o,e.attributeLayers,"layerId"),c=null;if(u&&(c=u[1]),"relations"in e&&o in e.relations&&n){var d=e.relations[o];for(var p in d){var f=I(d[p],i);f&&(s[f[0]]=f[1])}}var b=x(o,c,i);l.request_params.filter=null,l.request_params.exp_filter=null,l.request_params.filtertoken=null,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(l.name).expressionFilter=null;var m="#attribute-layer-table-"+lizMap.cleanName(t);if($(m).length&&function(t,a,r){const i=lizMap.config.layers[t],n={TYPENAME:i?.shortname||i?.typename||i?.name,GEOMETRYNAME:"extent"};if("True"==e.options?.limitDataToBbox){const e=lizMap.mainLizmap.map.getView().calculateExtent(),t=lizMap.mainLizmap.transformExtent(e,lizMap.mainLizmap.map.getView().getProjection().getCode(),"EPSG:4326");n.BBOX=t,n.SRSNAME="EPSG:4326"}const l=lizMap.mainLizmap.wfs.getFeature(n);Promise.all([l]).then((e=>{N(t,r,e[0].features),document.body.style.cursor="default"})).catch((()=>{document.body.style.cursor="default"}))}(t,0,m),lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:t,filter:null,updateDrawing:!0}),n)for(var y in s)r[y]=null,a.push(y);b&&(e.layers[b.otherParentTypeName].request_params.filter=null,e.layers[b.otherParentTypeName].request_params.exp_filter=null,e.layers[b.otherParentTypeName].request_params.filtertoken=null,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(b.otherParentTypeName).expressionFilter=null,r[b.otherParentTypeName]=null,a.push(b.otherParentTypeName)),a.length>0&&D(a,r,i,n)}function O(a,r){r=void 0===r||r;var i=e.layers[a];if(!i)return;var n=null;i?.filteredFeatures?.length&&(n="$id IN ( "+t(i.filteredFeatures)+" ) ");const l=i?.shortname||a;i?.selectedFeatures?.length?(i.request_params.selection=l+":"+i.selectedFeatures.join(),fetch(globalThis.lizUrls.service,{method:"POST",body:new URLSearchParams({service:"WMS",request:"GETSELECTIONTOKEN",typename:l,ids:i.selectedFeatures.join()})}).then((e=>e.json())).then((e=>{i.request_params.selectiontoken=e.token,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(i.name).selectionToken={selectedFeatures:i.selectedFeatures,token:e.token}}))):(i.request_params.selection=null,i.request_params.selectiontoken=null,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(i.name).selectedFeatures=null);var o=[a],s={};s[a]=n,D(o,s,[],r)}function P(t){var a=e.layers[t].selectedFeatures,r=e.layers[t].filteredFeatures,i=lizMap.cleanName(t);a&&a.length>0?($('button.btn-unselect-attributeTable[value="'+i+'"]').removeClass("hidden"),$('button.btn-moveselectedtotop-attributeTable[value="'+i+'"]').removeClass("hidden")):($('button.btn-unselect-attributeTable[value="'+i+'"]').addClass("hidden"),$('button.btn-moveselectedtotop-attributeTable[value="'+i+'"]').addClass("hidden")),$('button.btn-filter-attributeTable[value="'+i+'"]').addClass("hidden").removeClass("btn-primary"),(!lizMap.lizmapLayerFilterActive&&a&&a.length>0||lizMap.lizmapLayerFilterActive==t)&&($('button.btn-filter-attributeTable[value="'+i+'"]').removeClass("hidden"),r&&r.length>0&&$('button.btn-filter-attributeTable[value="'+i+'"]').addClass("btn-primary"))}function B(t){$(".attribute-table-table[id]").each((function(){var a=$(this).attr("id");if(!a)return!0;var i=$(this).parents("div.dataTables_wrapper:first").prev("input.attribute-table-hidden-layer").val();if(i&&$.fn.dataTable.isDataTable($(this))&&lizMap.cleanName(t)==i){for(var n="#"+a,l=n,o=i,s=t,u=$(n).attr("class").split(" "),c=0;c<u.length;c++)if(u[c].match("child-of-")){l="#attribute-layer-table-"+(o=u[c].substring(9)),s=r[o];break}if(l!=n)if(n.match("edition-table-")){var d=$('#edition-form-container form input[name="liz_featureId"]').val(),p=$('#edition-form-container form input[name="liz_layerId"]').val(),f=lizMap.getLayerConfigById(p);if(t in e.attributeLayers&&s==f[0]){var b=e.attributeLayers[t],m=G(p,b.layerId),y=function(t,a){if("relations"in e&&t in e.relations){var r=e.relations[t];for(var i in r){var n=r[i];if(n.referencingLayer==a)return n}}return null}(p,b.layerId);(null!=y||m)&&lizMap.getLayerFeature(s,d,(function(a){var r=a.properties;if(m){const a=e.relations.pivot[m],i=lizMap.getLayerConfigById(m,e.layers,"id");if(i&&i[1]){const i=a[p],l=a[b.layerId],o=e.relations[b.layerId].filter((e=>e.referencingLayer==m))[0]?.referencedField,s=e.relations[b.layerId].filter((e=>e.referencingLayer==m))[0]?.referencedField;i&&l&&o&&s&&q(m,{referencedPivotField:i,referencingPivotField:l,referencedFieldForFilter:o},r[s]).then((e=>{S(t,e,n,!e)}))}}else{var i='"'+y.referencingField+"\" = '"+r[y.referencedField]+"'";S(t,i,n)}}))}}else{var h=e.layers[s].highlightedFeature;h&&$(l+" tr#"+h).click()}else M(t,null,n,!1)}}))}function U(e){var t=$(e).find("table.dataTable");if(0!=t.length){var a=$(e+" div.attribute-layer-content").height()?$(e+" div.attribute-layer-content").height():0;a-=$(e+" thead").height()?$(e+" thead").height():0,a-=$(e+" div.dataTables_paginate").height()?$(e+" div.dataTables_paginate").height():0,a-=$(e+" div.dataTables_filter").height()?$(e+" div.dataTables_filter").height():0,a-=20,t.parent("div.dataTables_scrollBody").height(a),t.DataTable().tables().columns.adjust()}}function j(t,a){const r=lizMap.getLayerConfigById(a.id,lizMap.config.attributeLayers,"layerId");if(r&&"True"==r[1]?.pivot&&e.relations?.pivot&&a.id in e.relations.pivot&&t in e.relations.pivot[a.id]){const r=Object.keys(e.relations.pivot[a.id]).filter((e=>e!=t));var i=null;if(1==r.length&&(i=lizMap.getLayerConfigById(r[0],e.layers,"id"))){var n=e.relations.pivot[a.id];if(n){const l=n[t],o=n[r[0]],s=e.relations[i[1].id].filter((e=>e.referencingLayer==a.id))[0]?.referencedField;if(l&&o&&s)return{config:i,relation:{referencedPivotField:l,referencingPivotField:o,referencedFieldForFilter:s}}}}}return null}function G(t,a){if(e.relations.pivot){var r=Object.keys(e.relations.pivot).filter((r=>null!=e.relations.pivot[r][a]&&null!=e.relations.pivot[r][t]))[0];if(r){const i=lizMap.getLayerConfigById(r,lizMap.config.attributeLayers,"layerId");if(i&&"True"==i[1]?.pivot&&[t,a].every((t=>e.relations[t]&&1==e.relations[t].filter((e=>e.referencingLayer==r)).length)))return r}}return null}async function q(t,a,r){const i=lizMap.getLayerConfigById(t,e.layers,"id");let n="",l={};if(i&&i[1]){const t=a.referencedPivotField,o=a.referencingPivotField,s=a.referencedFieldForFilter,u={TYPENAME:i[1].typename,GEOMETRYNAME:"extent"};u.EXP_FILTER='"'+t+"\" = '"+r+"'","True"==e.options?.limitDataToBbox&&(u.BBOX=lizMap.mainLizmap.map.getView().calculateExtent(),u.SRSNAME=lizMap.mainLizmap.map.getView().getProjection().getCode());const c=lizMap.mainLizmap.wfs.getFeature(u);let d=await c;if(d&&d.features){const e=d.features;let t=[];e.forEach((e=>{var a=e.id.split(".")[1];l[a]=e,e.properties&&e.properties[o]&&t.push(e.properties[o])})),t.length&&(n=t.map((function(e){return'"'+s+"\" = '"+e+"'"})).join(" OR "))}}return i[1].features=l,n}lizMap.refreshDatatableSize=function(e){return U(e)},lizMap.events.on({layerfeaturehighlighted:function(t){e.layers[t.featureType].highlightedFeature=t.fid,function(t,a,r){var i=e.layers[a].features[r];if(!i)return!1;var n=i.properties,l=e.layers[a];if(!l)return!1;var o=l.id;if("relations"in e&&o in e.relations){var s=e.relations[o];for(const a of s){var u=lizMap.getLayerConfigById(a.referencingLayer,e.layers,"id");if(u){var c,d=!1;if((c=j(o,u[1]))&&(u=c.config,d=!0),"False"==e.attributeLayers?.[u[0]]?.hideAsChild){const[e,r]=u,i=t.replace(" table:first","")+"-"+lizMap.cleanName(e);let l="";d?q(a.referencingLayer,c.relation,n[a.referencedField]).then((t=>{S(e,t,i,!t)})):(a.referencingLayer==r.id&&(l='"'+a.referencingField+"\" = '"+n[a.referencedField]+"'"),M(e,l,i,!1))}}}}}(t.sourceTable,t.featureType,t.fid)},layerfeatureselected:function(t){!function(t,a,r){if(r=void 0!==r?r:null,e.layers[t].selectedFeatures||(e.layers[t].selectedFeatures=[]),-1==$.inArray(a,e.layers[t].selectedFeatures))e.layers[t].selectedFeatures.push(a);else{var i=$.inArray(a,e.layers[t].selectedFeatures);e.layers[t].selectedFeatures.splice(i,1)}lizMap.events.triggerEvent("layerSelectionChanged",{featureType:t,featureIds:e.layers[t].selectedFeatures,updateDrawing:r})}(t.featureType,t.fid,t.updateDrawing)},layerfeatureunselectall:function(e){k(e.featureType,e.updateDrawing)},layerfeatureselectsearched:function(t){!function(t,a){a=void 0===a||a,e.layers[t].selectedFeatures||(e.layers[t].selectedFeatures=[]);var r=!1;$(".attribute-table-table[id]").each((function(){$(this).attr("id");var a=$(this).parents("div.dataTables_wrapper:first").prev("input.attribute-table-hidden-layer").val();if(a&&$.fn.dataTable.isDataTable($(this))&&lizMap.cleanName(t)==a){for(var i=[],n=$(this).DataTable().rows({filter:"applied"}).ids(),l=0;l<n.length;l++)i.push(n[l]);e.layers[t].selectedFeatures=i,r=!0}})),r&&lizMap.events.triggerEvent("layerSelectionChanged",{featureType:t,featureIds:e.layers[t].selectedFeatures,updateDrawing:a})}(t.featureType,t.updateDrawing)},layerfeaturefilterselected:function(t){!function(t){if(!e.attributeLayers[t])return!1;e.layers[t].selectedFeatures||(e.layers[t].selectedFeatures=[]),e.layers[t].filteredFeatures=e.layers[t].selectedFeatures.slice(),k(t,!1),lizMap.lizmapLayerFilterActive=t,lizMap.events.triggerEvent("layerFilteredFeaturesChanged",{featureType:t,featureIds:e.layers[t].filteredFeatures,updateDrawing:!0})}(t.featureType)},layerfeatureremovefilter:function(t){var a;a=t.featureType,e.layers[a].filteredFeatures=[],lizMap.lizmapLayerFilterActive=null,e.layers[a].request_params.filter=null,e.layers[a].request_params.exp_filter=null,e.layers[a].request_params.filtertoken=null,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(a).expressionFilter=null,lizMap.events.triggerEvent("layerFilteredFeaturesChanged",{featureType:a,featureIds:e.layers[a].filteredFeatures,updateDrawing:!0})},layerSelectionChanged:function(t){var a;P(t.featureType),a=t.featureType,t.featureIds,$(".attribute-table-table[id]").each((function(){$(this).attr("id");var t=$(this).parents("div.dataTables_wrapper:first").prev("input.attribute-table-hidden-layer").val();if(t&&$.fn.dataTable.isDataTable($(this))&&lizMap.cleanName(a)==t){if(!r){e.layers[a].selectedFeatures||(e.layers[a].selectedFeatures=[]);var r=e.layers[a].selectedFeatures}var i=$(this).DataTable(),n=$(this).dataTable();i.rows($(this).find("tr.selected")).every((function(){n.fnUpdate("z",this,0,!1,!1)})).nodes().to$().removeClass("selected"),r.length>0&&((i=$(this).DataTable()).data().each((function(e){-1!=$.inArray(e.DT_RowId.toString(),r)&&(e.lizSelected="a")})),i.rows((function(e,t,a){return"a"==t.lizSelected})).nodes().to$().addClass("selected"))}})),t.updateDrawing&&function(t){var a=e.layers[t];if(!a)return;const r=a?.shortname||t;a?.selectedFeatures?.length?("request_params"in a||(a.request_params={}),a.request_params.selection=r+":"+a.selectedFeatures.join(),fetch(globalThis.lizUrls.service,{method:"POST",body:new URLSearchParams({service:"WMS",request:"GETSELECTIONTOKEN",typename:r,ids:a.selectedFeatures.join()})}).then((e=>e.json())).then((e=>{a.request_params.selectiontoken=e.token,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(a.name).selectionToken={selectedFeatures:a.selectedFeatures,token:e.token}}))):("request_params"in a||(a.request_params={}),a.request_params.selection=null,a.request_params.selectiontoken=null,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(a.name).selectedFeatures=null)}(t.featureType)},layerFilteredFeaturesChanged:function(e){P(e.featureType);var t=$('#jforms_view_attribute_layers_option_cascade_label input[name="cascade"]').prop("checked");"cascade"in e&&(t=e.cascade),O(e.featureType,t)},lizmapeditionfeaturecreated:function(t){var a=lizMap.getLayerConfigById(t.layerId,e.attributeLayers,"layerId");if(a){var r=a[0];if(!(r in e.attributeLayers))return!1;B(r)}},lizmapeditionfeaturemodified:function(t){var a=lizMap.getLayerConfigById(t.layerId);if(a){var r=a[0];if(!(r in e.attributeLayers))return!1;B(r)}},lizmapeditionfeaturedeleted:function(t){var a=lizMap.getLayerConfigById(t.layerId);if(a){var r=a[0];if(!(r in e.attributeLayers))return!1;B(r);const t=$('#jforms_view_attribute_layers_option_cascade_label input[name="cascade"]').prop("checked");let i=!1;("filteredFeatures"in e.layers[r]&&e.layers[r].filteredFeatures.length>0||"request_params"in e.layers[r]&&e.layers[r].request_params.filter||"request_params"in e.layers[r]&&e.layers[r].request_params.exp_filter)&&(i=!0),i&&lizMap.lizmapLayerFilterActive&&t&&O(lizMap.lizmapLayerFilterActive,t)}},lizmaplocatefeaturechanged:function(t){if(!(t.featureType in e.attributeLayers)||l)return!1;var a=e.locateByLayer[t.featureType],r=!1;if("filterOnLocate"in a&&"True"==a.filterOnLocate&&(r=!0),!r)return!1;lizMap.events.triggerEvent("layerfeatureselected",{featureType:t.featureType,fid:t.featureId,updateDrawing:!1}),lizMap.events.triggerEvent("layerfeaturefilterselected",{featureType:t.featureType})},lizmaplocatefeaturecanceled:function(e){lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:e.featureType})},lizmapeditionformdisplayed:function(t){$("#edition-children-container").hide().html("");var a=t.featureId;if(a&&""!=a){var i=t.layerId,n=lizMap.getLayerConfigById(i);if(n&&"relations"in lizMap.config&&i in lizMap.config.relations){var l=lizMap.config.relations[i],o=n[0];if(l.length>0){var s=_(o),u="";if(s){for(var c in s.childCreateButton&&(u+='<div class="attribute-layer-action-bar">',u+=s.childCreateButton,u+="</div>"),u+='<div class="tabbable edition-children-content">',u+='    <ul class="nav nav-tabs">',s["tab-li"])u+=s["tab-li"][c];for(var c in u+="    </ul>",u+='    <div class="tab-content">',s["tab-content"])u+=s["tab-content"][c];u+="    </div>",u+="</div>"}$("#edition-children-container").show().append(u),$("#edition-children-container div.tabbable div.tab-pane input.attribute-table-hidden-parent-layer").after('<input class="attribute-table-hidden-parent-feature-id" value="'+a+'" type="hidden">'),$("#edition-children-container div.tabbable ul.nav-tabs li").each((function(){$(this).attr("id",$(this).attr("id").replace(/nav-tab-attribute-child-tab-/g,"nav-tab-edition-child-tab-"))})),$("#edition-children-container div.tabbable ul.nav-tabs li a").each((function(){$(this).attr("href",$(this).attr("href").replace(/attribute-child-tab-/g,"edition-child-tab-"))})),$("#edition-children-container div.tabbable div.tab-content div.tab-pane").each((function(){$(this).attr("id",$(this).attr("id").replace(/attribute-child-tab-/g,"edition-child-tab-"))})),$("#edition-children-container div.tabbable div.tab-content table").each((function(){$(this).attr("id",$(this).attr("id").replace(/attribute-layer-/g,"edition-"))})),$("#edition-children-container button.btn-createFeature-attributeTable").click((function(){let t=lizDict["edition.confirm.launch.child.creation"];if(!confirm(t))return!1;var n=i,l=r[$(this).val()],s=$(this).attr("data-pivot");return lizMap.getLayerFeature(o,a,(function(t){var a=e.layers[l].id;lizMap.launchEdition(a,null,{layerId:n,feature:t,pivotId:s})})),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),$("#edition-children-container a.btn-createFeature-attributeTable").click((function(){var t=i,n=$(this).attr("href").replace("#",""),l=r[n];return lizMap.getLayerFeature(o,a,(function(a){var r=e.layers[l].id;lizMap.launchEdition(r,null,{layerId:t,feature:a}),$(this).blur()})),!1})).hover((function(){$(this).addClass("btn-primary")}),(function(){$(this).removeClass("btn-primary")})),lizMap.getLayerFeature(o,a,(function(t){for(var a=t.properties,r=0,n=l.length;r<n;r++){var s=l[r],u=s.referencingLayer,c=lizMap.getLayerConfigById(u);if(c){var d,p=!1;(d=j(i,c[1]))&&(c=d.config,p=!0);let t=c[0],r=(c[1],""),n=lizMap.cleanName(o)+"-"+lizMap.cleanName(t),l="#edition-table-"+n;t in e.attributeLayers&&(p?q(s.referencingLayer,d.relation,a[s.referencedField]).then((e=>{S(t,e,l,!e)})):(r='"'+s.referencingField+"\" = '"+a[s.referencedField]+"'",S(t,r,l)));var f="edition-child-tab-"+n,b='#edition-form-container div.lizmap-form-relation[data-relation-id="';b+=s.relationId+'"]';var m=$(b);$("#"+f).appendTo(m),$("#nav-tab-edition-child-tab-"+n).hide(),""==m.find("legend:first").text().trim()&&m.find("legend:first").text(s.relationName)}}0==$("div#edition-children-container div.tabbable.edition-children-content div.tab-content").find("div.attribute-layer-child-content").length&&$("#edition-children-container div.tabbable.edition-children-content").hide()}))}}}},bottomdocksizechanged:function(e){U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))},dockopened:function(e){$("#mapmenu li.attributeLayers").hasClass("active")&&U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))},dockclosed:function(e){$("#mapmenu li.attributeLayers").hasClass("active")&&U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))},rightdockopened:function(e){$("#mapmenu li.attributeLayers").hasClass("active")&&U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))},rightdockclosed:function(e){$("#mapmenu li.attributeLayers").hasClass("active")&&U("#"+$("#bottom-dock div.bottom-content.active div.attribute-layer-main").attr("id"))}}),lizMap.getAttributeFeatureData=function(t,a,r,i,n){if(a=void 0!==a?a:null,r=void 0!==r?r:null,i=void 0!==i?i:"extent",n=void 0!==n?n:null,!(t in e.layers)){var l=lizMap.getNameByCleanName(t);if(!l||!(l in e.layers))return console.log('getAttributeFeatureData: "'+t+'" and "'+l+'" not found in config'),!1;t=l}e.layers[t],t in e.attributeLayers&&e.attributeLayers[t];var o=!1;return"limitDataToBbox"in e.options&&"True"==e.options.limitDataToBbox&&(o=!0),lizMap.getFeatureData(t,a,r,i,o,null,null,n),!0}}})}()})();
//# sourceMappingURL=attributeTable.js.map