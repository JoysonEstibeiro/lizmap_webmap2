/*! For license information please see switcher-layers-actions.js.LICENSE.txt */
(()=>{"use strict";var e;e=null,lizMap.events.on({uicreated:function(){if("themes"in lizMap.config){var t=lizMap.config.themes,a='<div id="theme-selector" class="btn-group" role="group">';for(var i in a+='<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown" type="button" title="'+lizDict["switcherLayersActions.themeSelector.title"]+'" href="#"><i class="icon-none qgis_sprite mActionShowAllLayers"></i><span class="caret"></span></button>',a+='<ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu">',t)a+='<li class="theme"><a href="#">'+i+"</a></li>";a+="</ul>",a+="</div>",$("#switcher-layers-actions").prepend(a),$("#theme-selector").on("click",".theme",(function(){$("#theme-selector .theme").removeClass("selected"),$(this).addClass("selected");const e=$(this).text();if(e in lizMap.config.themes){const t=lizMap.config.themes[e],a=t?.checkedGroupNode?.map((e=>e.split("/").slice(-1)[0]))||[],i=t?.expandedGroupNode?.map((e=>e.split("/").slice(-1)[0]))||[],l=t?.expandedLegendNode||[];for(const e of lizMap.mainLizmap.state.layerTree.findTreeLayersAndGroups())if("group"===e.mapItemState.itemState.type)e.checked=a.includes(e.name),e.expanded=i.includes(e.name);else{const a=t?.layers?.[e.layerConfig.id];if(!a){e.checked=!1;continue}const i=a?.style;i&&(e.wmsSelectedStyleName=i),e.checked=!0,e.expanded="1"===a?.expanded,setTimeout((()=>{const t=e.symbologyChildren;if(t.length)for(const e of t)e.expanded=l.includes(e.ruleKey)}),1e3)}if(t?.checkedGroupNode?.includes("baselayers/project-background-color"))lizMap.mainLizmap.state.baseLayers.selectedBaseLayerName="project-background-color";else for(const e of lizMap.mainLizmap.state.baseLayers.getBaseLayers())if(e.layerConfig&&t?.layers?.[e.layerConfig.id]){lizMap.mainLizmap.state.baseLayers.selectedBaseLayerName=e.name;break}lizMap.events.triggerEvent("mapthemechanged",{name:e,config:t})}return $("#theme-selector.open").click(),!1})),lizMap.events.triggerEvent("mapthemesadded",{themes:t}),lizMap.mainLizmap.initialConfig.options.activateFirstMapTheme&&$("#theme-selector li.theme:nth-child(1)").click();const e=new URL(document.location).searchParams;if(e.has("mapTheme")){const t=e.get("mapTheme");$("#theme-selector li.theme").filter(((e,a)=>a.textContent==t)).click()}}e=lizMap.getVectorLayerFeatureTypes(),$("#switcher-layers-actions .btn, #get-baselayer-metadata").tooltip({placement:"bottom"}),document.getElementById("layers-unfold-all").addEventListener("click",(()=>{document.querySelectorAll("lizmap-treeview .expandable").forEach((e=>e.classList.add("expanded")))})),document.getElementById("layers-fold-all").addEventListener("click",(()=>{document.querySelectorAll("lizmap-treeview .expandable").forEach((e=>e.classList.remove("expanded")))})),$("#get-baselayer-metadata").click((function(){$("#hide-sub-dock").click();const e=lizMap.mainLizmap.map.getActiveBaseLayer().get("name");return!!e&&(lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e,type:"baselayer",selected:!0}),!1)})),$("#content").on("click","button.layerActionZoom",(function(){var e=$(this).val();if(!e)return!1;var t=lizMap.config.layers[e];"baselayer"==t.type&&lizMap.map.zoomToMaxExtent();var a=lizMap.map.getProjection();if("EPSG:900913"==a&&(a="EPSG:3857"),!("extent"in t))return console.log("The layer extent information has not been found in config"),console.log(t),!1;if(!("crs"in t))return console.log("The layer crs information has not been found in config"),console.log(t),!1;var i=OpenLayers.Bounds.fromArray(t.extent);return i=i.transform(t.crs,a),lizMap.map.zoomToExtent(i),!1})),$("#content").on("change","select.styleLayer",(function(){var e=$(this).val(),t=$(this).parent().find("input.styleLayer"),a=t.val(),i=t.hasClass("baselayer");if(!a)return!1;let l;l=i?lizMap.map.baseLayer:lizMap.mainLizmap.state.rootMapGroup.getMapLayerByName(a),l.wmsSelectedStyleName=e})),$("#content").on("click","a.btn-opacity-layer",(function(){var e=$(this).text(),t=parseInt(e)/100,a=$(this).parent().find("input.opacityLayer").val();if(!a)return!1;const i=lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerOrGroupByName(a);return i&&(i.opacity=t,$("a.btn-opacity-layer").removeClass("active"),$("a.btn-opacity-layer."+100*t).addClass("active")),$("#switcher").click(),!1})),$("#sub-dock").on("click","button.exportLayer",(function(){var e=$(this).val(),t=$(this).parent().find("select.exportLayer").val();return lizMap.exportVectorLayer(e,t),!1})),$("#layerActionUnfilter").click((function(){var e=lizMap.lizmapLayerFilterActive;return!!e&&(lizMap.events.triggerEvent("layerfeatureremovefilter",{featureType:e}),lizMap.lizmapLayerFilterActive=null,$(this).hide(),!1)})),lizMap.events.on({dockclosed:function(e){"switcher"==e.id&&$("#hide-sub-dock").click()},lizmapbaselayerchanged:function(e){if($("#sub-dock").is(":visible")){var t=$("#hide-sub-dock").val();0!=$("#switcher-baselayer-select").find('option[value="'+t+'"]').length&&t!=$("#switcher-baselayer-select").val()&&lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e.layer.name,type:"baselayer",selected:!0})}}})},lizmapswitcheritemselected:function(t){var a=t.name,i=t.type,l=t.selected,n={};if("baselayer"==i){var s=lizMap.getLayerNameByCleanName(lizMap.cleanName(a));s&&(a=s)}else n=lizMap.config.layers[a];var o=a;l||(o=""),$("#switcher-layers-actions button").val(o);var r=!l||!("bbox"in n);$("button.layerActionZoom").attr("disable",r).toggleClass("disabled",r),function(t,a){var i;a?(i=function(t){var a="",i={title:t,type:"layer",abstract:null,link:null,styles:null,isBaselayer:!1,actions:null};if(t in lizMap.config.layers){var l=lizMap.config.layers[t];i.title=l.title,i.type=l.type,l.abstract&&(i.abstract=l.abstract),l.link&&(i.link=l.link),l.styles&&l.styles.length>1&&(i.styles=l.styles);let e=lizMap.mainLizmap.action.getActions("layer",l.id);e.length&&(i.actions=e)}if(lizMap.mainLizmap.map.getActiveBaseLayer()?.get("name")==t&&(i.type="layer",i.isBaselayer=!0),i){l=lizMap.config.layers[t],a+='<div class="sub-metadata">',a+="<h3>",a+='    <span class="title">',a+='        <span class="icon"></span>',a+='        <span class="text">'+lizDict["layer.metadata.title"]+"</span>",a+="    </span>",a+="</h3>",a+='<div class="menu-content">',a+='    <dl class="dl-vertical" style="font-size:0.8em;">',a+="        <dt>"+lizDict["layer.metadata.layer.name"]+"</dt>",a+="        <dd>"+i.title+"</dd>",a+="        <dt>"+lizDict["layer.metadata.layer.type"]+"</dt>",a+="        <dd>"+lizDict["layer.metadata.layer.type."+i.type]+"</dd>",a+="        <dt>"+lizDict["layer.metadata.zoomToExtent.title"]+"</dt>",a+='<dd><button class="btn btn-mini layerActionZoom" title="'+lizDict["layer.metadata.zoomToExtent.title"]+'" value="'+t+'"><i class="icon-zoom-in"></i></button></dd>';var n="";if(i.isBaselayer&&(n="baselayer"),i.styles){const e=lizMap.mainLizmap.state.rootMapGroup.getMapLayerByName(t);for(var s in y="",i.styles)(s=i.styles[s])==e.wmsSelectedStyleName?y+='<option value="'+s+'" selected>'+s+"</option>":y+='<option value="'+s+'">'+s+"</option>";""!=y&&(a+="        <dt>"+lizDict["layer.metadata.style.title"]+"</dt>",a+="<dd>",a+='<input type="hidden" class="styleLayer '+n+'" value="'+t+'">',a+='<select class="styleLayer '+n+'">',a+=y,a+="</select>",a+="</dd>")}let m=!1;if(i.isBaselayer||(m=lizMap.mainLizmap.state.rootMapGroup.getMapLayerOrGroupByName(t).singleWMSLayer),!m){a+="        <dt>"+lizDict["layer.metadata.opacity.title"]+"</dt>",a+="<dd>",a+='<input type="hidden" class="opacityLayer '+n+'" value="'+t+'">';const e=lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerOrGroupByName(t).opacity;var o=lizMap.config.options.layersOpacities;void 0===o&&(o=[.2,.4,.6,.8,1]);for(var r=0,c=o.length;r<c;r++){var d="";e==o[r]&&(d="active"),a+='<a href="#" class="btn btn-mini btn-opacity-layer '+d+" "+100*o[r]+'">'+100*o[r]+"</a>"}a+="</dd>"}if("exportLayers"in lizMap.config.options&&"True"==lizMap.config.options.exportLayers&&null!=e&&0!=e.length){var p=lizMap.getVectorLayerResultFormat(),y="";for(const e of p)y+='<option value="'+e+'">'+e+"</option>";""!=y&&null!=l.typename&&(a+="        <dt>"+lizDict["layer.metadata.export.title"]+"</dt>",a+="<dd>",a+='<select class="exportLayer '+n+'">',a+=y,a+="</select>",a+='<button class="btn btn-mini exportLayer '+n+'" title="'+lizDict["layer.metadata.export.title"]+'" value="'+t+'"><i class="icon-download"></i></button>',a+="</dd>")}i.abstract&&(a+="        <dt>"+lizDict["layer.metadata.layer.abstract"]+"</dt>",a+="        <dd>"+i.abstract+"</dd>"),i.actions&&(a+="        <dt>"+lizDict["action.title"]+"</dt>",a+=`\n                <div class="layer-action-selector-container">\n                    <lizmap-action-selector id="lizmap-layer-action-${l.id}" title="${lizDict["action.form.select.help"]}"\n                        no-selection-warning="${lizDict["action.form.select.warning"]}"\n                        action-scope="layer" action-layer-id="${l.id}"\n                    ></lizmap-action-selector>\n                <div>\n                `),a+="    </dl>",i.link&&(a+='    <button class="btn link layer-info" name="link" title="'+lizDict["layer.metadata.layer.info.see"]+'" value="'+i.link+'">'+lizDict["layer.metadata.layer.info.see"]+"</button>"),a+="</div>",a+="</div>",a+='<button id="hide-sub-dock" class="btn btn-mini pull-right" name="close" title="'+lizDict["generic.btn.close.title"]+'" value="'+t+'">'+lizDict["generic.btn.close.title"]+"</button>"}return a}(t),$("#sub-dock").html(i),$("#sub-dock a.btn-opacity-layer").each((function(){var e=$(this).text(),t=parseInt(e)/100-.3;$(this).css("background-color","rgba(0,0,0,"+t+")"),$(this).css("background-image","none"),$(this).css("text-shadow","none"),parseInt(e)>60&&$(this).css("color","lightgrey")})),$("div.sub-metadata button.link").click((function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=e.val();/^(\/)?media\//.test(t)&&(t=globalThis.lizUrls.media+"?"+new URLSearchParams(globalThis.lizUrls.params)+"&path=/"+t),window.open(t)})),$("#hide-sub-dock").click((function(){var e=$(this).val(),t=lizMap.config.layers[e],a="baselayer";"type"in t&&(a=t.type),lizMap.events.triggerEvent("lizmapswitcheritemselected",{name:e,type:a,selected:!1}),document.querySelector("lizmap-treeview").itemNameSelected=void 0})),"none"!=$("#sub-dock").css("display")||$("#sub-dock").show()):$("#sub-dock").hide().html("")}(a,l)}})})();
//# sourceMappingURL=switcher-layers-actions.js.map