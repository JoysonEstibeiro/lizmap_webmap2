/*! For license information please see map.js.LICENSE.txt */
(()=>{"use strict";class e extends Error{constructor(e,t,a){super(e),this.name="NetworkError",this.resource=t,this.options=a}}class t extends e{constructor(e,t,a,n){super(e),this.name="HttpError",this.statusCode=t,this.resource=a,this.options=n}}class a extends e{constructor(e,t,a,n){super(e),this.name="ResponseError",this.response=t,this.resource=a,this.options=n}}Error,Error;const{entries:n,setPrototypeOf:i,isFrozen:r,getPrototypeOf:o,getOwnPropertyDescriptor:l}=Object;let{freeze:s,seal:p,create:c}=Object,{apply:u,construct:m}="undefined"!=typeof Reflect&&Reflect;s||(s=function(e){return e}),p||(p=function(e){return e}),u||(u=function(e,t,a){return e.apply(t,a)}),m||(m=function(e,t){return new e(...t)});const d=w(Array.prototype.forEach),f=w(Array.prototype.lastIndexOf),g=w(Array.prototype.pop),h=w(Array.prototype.push),y=w(Array.prototype.splice),v=w(String.prototype.toLowerCase),b=w(String.prototype.toString),E=w(String.prototype.match),T=w(String.prototype.replace),L=w(String.prototype.indexOf),z=w(String.prototype.trim),S=w(Object.prototype.hasOwnProperty),N=w(RegExp.prototype.test),_=(C=TypeError,function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return m(C,t)});var C;function w(e){return function(t){for(var a=arguments.length,n=new Array(a>1?a-1:0),i=1;i<a;i++)n[i-1]=arguments[i];return u(e,t,n)}}function O(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;i&&i(e,null);let n=t.length;for(;n--;){let i=t[n];if("string"==typeof i){const e=a(i);e!==i&&(r(t)||(t[n]=e),i=e)}e[i]=!0}return e}function M(e){for(let t=0;t<e.length;t++)S(e,t)||(e[t]=null);return e}function P(e){const t=c(null);for(const[a,i]of n(e))S(e,a)&&(Array.isArray(i)?t[a]=M(i):i&&"object"==typeof i&&i.constructor===Object?t[a]=P(i):t[a]=i);return t}function A(e,t){for(;null!==e;){const a=l(e,t);if(a){if(a.get)return w(a.get);if("function"==typeof a.value)return w(a.value)}e=o(e)}return function(){return null}}const R=s(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),x=s(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),k=s(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),F=s(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),I=s(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),j=s(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),D=s(["#text"]),U=s(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),B=s(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),G=s(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H=s(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),q=p(/\{\{[\w\W]*|[\w\W]*\}\}/gm),W=p(/<%[\w\W]*|[\w\W]*%>/gm),Y=p(/\$\{[\w\W]*/gm),V=p(/^data-[\-\w.\u00B7-\uFFFF]+$/),X=p(/^aria-[\-\w]+$/),J=p(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Q=p(/^(?:\w+script|data):/i),K=p(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Z=p(/^html$/i),ee=p(/^[a-z][.\w]*(-[.\w]+)+$/i);var te=Object.freeze({__proto__:null,ARIA_ATTR:X,ATTR_WHITESPACE:K,CUSTOM_ELEMENT:ee,DATA_ATTR:V,DOCTYPE_NAME:Z,ERB_EXPR:W,IS_ALLOWED_URI:J,IS_SCRIPT_OR_DATA:Q,MUSTACHE_EXPR:q,TMPLIT_EXPR:Y});const ae=function(){return"undefined"==typeof window?null:window};var ne=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae();const a=t=>e(t);if(a.version="3.2.4",a.removed=[],!t||!t.document||9!==t.document.nodeType||!t.Element)return a.isSupported=!1,a;let{document:i}=t;const r=i,o=r.currentScript,{DocumentFragment:l,HTMLTemplateElement:p,Node:u,Element:m,NodeFilter:C,NamedNodeMap:w=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:M,DOMParser:$,trustedTypes:q}=t,W=m.prototype,Y=A(W,"cloneNode"),V=A(W,"remove"),X=A(W,"nextSibling"),Q=A(W,"childNodes"),K=A(W,"parentNode");if("function"==typeof p){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let ee,ne="";const{implementation:ie,createNodeIterator:re,createDocumentFragment:oe,getElementsByTagName:le}=i,{importNode:se}=r;let pe={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};a.isSupported="function"==typeof n&&"function"==typeof K&&ie&&void 0!==ie.createHTMLDocument;const{MUSTACHE_EXPR:ce,ERB_EXPR:ue,TMPLIT_EXPR:me,DATA_ATTR:de,ARIA_ATTR:fe,IS_SCRIPT_OR_DATA:ge,ATTR_WHITESPACE:he,CUSTOM_ELEMENT:ye}=te;let{IS_ALLOWED_URI:ve}=te,be=null;const Ee=O({},[...R,...x,...k,...I,...D]);let Te=null;const Le=O({},[...U,...B,...G,...H]);let ze=Object.seal(c(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Se=null,Ne=null,_e=!0,Ce=!0,we=!1,Oe=!0,Me=!1,Pe=!0,Ae=!1,Re=!1,$e=!1,xe=!1,ke=!1,Fe=!1,Ie=!0,je=!1,De=!0,Ue=!1,Be={},Ge=null;const He=O({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let qe=null;const We=O({},["audio","video","img","source","image","track"]);let Ye=null;const Ve=O({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Xe="http://www.w3.org/1998/Math/MathML",Je="http://www.w3.org/2000/svg",Qe="http://www.w3.org/1999/xhtml";let Ke=Qe,Ze=!1,et=null;const tt=O({},[Xe,Je,Qe],b);let at=O({},["mi","mo","mn","ms","mtext"]),nt=O({},["annotation-xml"]);const it=O({},["title","style","font","a","script"]);let rt=null;const ot=["application/xhtml+xml","text/html"];let lt=null,st=null;const pt=i.createElement("form"),ct=function(e){return e instanceof RegExp||e instanceof Function},ut=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!st||st!==e){if(e&&"object"==typeof e||(e={}),e=P(e),rt=-1===ot.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,lt="application/xhtml+xml"===rt?b:v,be=S(e,"ALLOWED_TAGS")?O({},e.ALLOWED_TAGS,lt):Ee,Te=S(e,"ALLOWED_ATTR")?O({},e.ALLOWED_ATTR,lt):Le,et=S(e,"ALLOWED_NAMESPACES")?O({},e.ALLOWED_NAMESPACES,b):tt,Ye=S(e,"ADD_URI_SAFE_ATTR")?O(P(Ve),e.ADD_URI_SAFE_ATTR,lt):Ve,qe=S(e,"ADD_DATA_URI_TAGS")?O(P(We),e.ADD_DATA_URI_TAGS,lt):We,Ge=S(e,"FORBID_CONTENTS")?O({},e.FORBID_CONTENTS,lt):He,Se=S(e,"FORBID_TAGS")?O({},e.FORBID_TAGS,lt):{},Ne=S(e,"FORBID_ATTR")?O({},e.FORBID_ATTR,lt):{},Be=!!S(e,"USE_PROFILES")&&e.USE_PROFILES,_e=!1!==e.ALLOW_ARIA_ATTR,Ce=!1!==e.ALLOW_DATA_ATTR,we=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Oe=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Me=e.SAFE_FOR_TEMPLATES||!1,Pe=!1!==e.SAFE_FOR_XML,Ae=e.WHOLE_DOCUMENT||!1,xe=e.RETURN_DOM||!1,ke=e.RETURN_DOM_FRAGMENT||!1,Fe=e.RETURN_TRUSTED_TYPE||!1,$e=e.FORCE_BODY||!1,Ie=!1!==e.SANITIZE_DOM,je=e.SANITIZE_NAMED_PROPS||!1,De=!1!==e.KEEP_CONTENT,Ue=e.IN_PLACE||!1,ve=e.ALLOWED_URI_REGEXP||J,Ke=e.NAMESPACE||Qe,at=e.MATHML_TEXT_INTEGRATION_POINTS||at,nt=e.HTML_INTEGRATION_POINTS||nt,ze=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ze.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ze.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(ze.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Me&&(Ce=!1),ke&&(xe=!0),Be&&(be=O({},D),Te=[],!0===Be.html&&(O(be,R),O(Te,U)),!0===Be.svg&&(O(be,x),O(Te,B),O(Te,H)),!0===Be.svgFilters&&(O(be,k),O(Te,B),O(Te,H)),!0===Be.mathMl&&(O(be,I),O(Te,G),O(Te,H))),e.ADD_TAGS&&(be===Ee&&(be=P(be)),O(be,e.ADD_TAGS,lt)),e.ADD_ATTR&&(Te===Le&&(Te=P(Te)),O(Te,e.ADD_ATTR,lt)),e.ADD_URI_SAFE_ATTR&&O(Ye,e.ADD_URI_SAFE_ATTR,lt),e.FORBID_CONTENTS&&(Ge===He&&(Ge=P(Ge)),O(Ge,e.FORBID_CONTENTS,lt)),De&&(be["#text"]=!0),Ae&&O(be,["html","head","body"]),be.table&&(O(be,["tbody"]),delete Se.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw _('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw _('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ee=e.TRUSTED_TYPES_POLICY,ne=ee.createHTML("")}else void 0===ee&&(ee=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let a=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(a=t.getAttribute(n));const i="dompurify"+(a?"#"+a:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(q,o)),null!==ee&&"string"==typeof ne&&(ne=ee.createHTML(""));s&&s(e),st=e}},mt=O({},[...x,...k,...F]),dt=O({},[...I,...j]),ft=function(e){h(a.removed,{element:e});try{K(e).removeChild(e)}catch(t){V(e)}},gt=function(e,t){try{h(a.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){h(a.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(xe||ke)try{ft(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},ht=function(e){let t=null,a=null;if($e)e="<remove></remove>"+e;else{const t=E(e,/^[\r\n\t ]+/);a=t&&t[0]}"application/xhtml+xml"===rt&&Ke===Qe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const n=ee?ee.createHTML(e):e;if(Ke===Qe)try{t=(new $).parseFromString(n,rt)}catch(e){}if(!t||!t.documentElement){t=ie.createDocument(Ke,"template",null);try{t.documentElement.innerHTML=Ze?ne:n}catch(e){}}const r=t.body||t.documentElement;return e&&a&&r.insertBefore(i.createTextNode(a),r.childNodes[0]||null),Ke===Qe?le.call(t,Ae?"html":"body")[0]:Ae?t.documentElement:r},yt=function(e){return re.call(e.ownerDocument||e,e,C.SHOW_ELEMENT|C.SHOW_COMMENT|C.SHOW_TEXT|C.SHOW_PROCESSING_INSTRUCTION|C.SHOW_CDATA_SECTION,null)},vt=function(e){return e instanceof M&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof w)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},bt=function(e){return"function"==typeof u&&e instanceof u};function Et(e,t,n){d(e,(e=>{e.call(a,t,n,st)}))}const Tt=function(e){let t=null;if(Et(pe.beforeSanitizeElements,e,null),vt(e))return ft(e),!0;const n=lt(e.nodeName);if(Et(pe.uponSanitizeElement,e,{tagName:n,allowedTags:be}),e.hasChildNodes()&&!bt(e.firstElementChild)&&N(/<[/\w]/g,e.innerHTML)&&N(/<[/\w]/g,e.textContent))return ft(e),!0;if(7===e.nodeType)return ft(e),!0;if(Pe&&8===e.nodeType&&N(/<[/\w]/g,e.data))return ft(e),!0;if(!be[n]||Se[n]){if(!Se[n]&&zt(n)){if(ze.tagNameCheck instanceof RegExp&&N(ze.tagNameCheck,n))return!1;if(ze.tagNameCheck instanceof Function&&ze.tagNameCheck(n))return!1}if(De&&!Ge[n]){const t=K(e)||e.parentNode,a=Q(e)||e.childNodes;if(a&&t)for(let n=a.length-1;n>=0;--n){const i=Y(a[n],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,X(e))}}return ft(e),!0}return e instanceof m&&!function(e){let t=K(e);t&&t.tagName||(t={namespaceURI:Ke,tagName:"template"});const a=v(e.tagName),n=v(t.tagName);return!!et[e.namespaceURI]&&(e.namespaceURI===Je?t.namespaceURI===Qe?"svg"===a:t.namespaceURI===Xe?"svg"===a&&("annotation-xml"===n||at[n]):Boolean(mt[a]):e.namespaceURI===Xe?t.namespaceURI===Qe?"math"===a:t.namespaceURI===Je?"math"===a&&nt[n]:Boolean(dt[a]):e.namespaceURI===Qe?!(t.namespaceURI===Je&&!nt[n])&&!(t.namespaceURI===Xe&&!at[n])&&!dt[a]&&(it[a]||!mt[a]):!("application/xhtml+xml"!==rt||!et[e.namespaceURI]))}(e)?(ft(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!N(/<\/no(script|embed|frames)/i,e.innerHTML)?(Me&&3===e.nodeType&&(t=e.textContent,d([ce,ue,me],(e=>{t=T(t,e," ")})),e.textContent!==t&&(h(a.removed,{element:e.cloneNode()}),e.textContent=t)),Et(pe.afterSanitizeElements,e,null),!1):(ft(e),!0)},Lt=function(e,t,a){if(Ie&&("id"===t||"name"===t)&&(a in i||a in pt))return!1;if(Ce&&!Ne[t]&&N(de,t));else if(_e&&N(fe,t));else if(!Te[t]||Ne[t]){if(!(zt(e)&&(ze.tagNameCheck instanceof RegExp&&N(ze.tagNameCheck,e)||ze.tagNameCheck instanceof Function&&ze.tagNameCheck(e))&&(ze.attributeNameCheck instanceof RegExp&&N(ze.attributeNameCheck,t)||ze.attributeNameCheck instanceof Function&&ze.attributeNameCheck(t))||"is"===t&&ze.allowCustomizedBuiltInElements&&(ze.tagNameCheck instanceof RegExp&&N(ze.tagNameCheck,a)||ze.tagNameCheck instanceof Function&&ze.tagNameCheck(a))))return!1}else if(Ye[t]);else if(N(ve,T(a,he,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==L(a,"data:")||!qe[e])if(we&&!N(ge,T(a,he,"")));else if(a)return!1;return!0},zt=function(e){return"annotation-xml"!==e&&E(e,ye)},St=function(e){Et(pe.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||vt(e))return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Te,forceKeepAttr:void 0};let i=t.length;for(;i--;){const r=t[i],{name:o,namespaceURI:l,value:s}=r,p=lt(o);let c="value"===o?s:z(s);if(n.attrName=p,n.attrValue=c,n.keepAttr=!0,n.forceKeepAttr=void 0,Et(pe.uponSanitizeAttribute,e,n),c=n.attrValue,!je||"id"!==p&&"name"!==p||(gt(o,e),c="user-content-"+c),Pe&&N(/((--!?|])>)|<\/(style|title)/i,c)){gt(o,e);continue}if(n.forceKeepAttr)continue;if(gt(o,e),!n.keepAttr)continue;if(!Oe&&N(/\/>/i,c)){gt(o,e);continue}Me&&d([ce,ue,me],(e=>{c=T(c,e," ")}));const u=lt(e.nodeName);if(Lt(u,p,c)){if(ee&&"object"==typeof q&&"function"==typeof q.getAttributeType)if(l);else switch(q.getAttributeType(u,p)){case"TrustedHTML":c=ee.createHTML(c);break;case"TrustedScriptURL":c=ee.createScriptURL(c)}try{l?e.setAttributeNS(l,o,c):e.setAttribute(o,c),vt(e)?ft(e):g(a.removed)}catch(e){}}}Et(pe.afterSanitizeAttributes,e,null)},Nt=function e(t){let a=null;const n=yt(t);for(Et(pe.beforeSanitizeShadowDOM,t,null);a=n.nextNode();)Et(pe.uponSanitizeShadowNode,a,null),Tt(a),St(a),a.content instanceof l&&e(a.content);Et(pe.afterSanitizeShadowDOM,t,null)};return a.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,i=null,o=null,s=null;if(Ze=!e,Ze&&(e="\x3c!--\x3e"),"string"!=typeof e&&!bt(e)){if("function"!=typeof e.toString)throw _("toString is not a function");if("string"!=typeof(e=e.toString()))throw _("dirty is not a string, aborting")}if(!a.isSupported)return e;if(Re||ut(t),a.removed=[],"string"==typeof e&&(Ue=!1),Ue){if(e.nodeName){const t=lt(e.nodeName);if(!be[t]||Se[t])throw _("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof u)n=ht("\x3c!----\x3e"),i=n.ownerDocument.importNode(e,!0),1===i.nodeType&&"BODY"===i.nodeName||"HTML"===i.nodeName?n=i:n.appendChild(i);else{if(!xe&&!Me&&!Ae&&-1===e.indexOf("<"))return ee&&Fe?ee.createHTML(e):e;if(n=ht(e),!n)return xe?null:Fe?ne:""}n&&$e&&ft(n.firstChild);const p=yt(Ue?e:n);for(;o=p.nextNode();)Tt(o),St(o),o.content instanceof l&&Nt(o.content);if(Ue)return e;if(xe){if(ke)for(s=oe.call(n.ownerDocument);n.firstChild;)s.appendChild(n.firstChild);else s=n;return(Te.shadowroot||Te.shadowrootmode)&&(s=se.call(r,s,!0)),s}let c=Ae?n.outerHTML:n.innerHTML;return Ae&&be["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&N(Z,n.ownerDocument.doctype.name)&&(c="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+c),Me&&d([ce,ue,me],(e=>{c=T(c,e," ")})),ee&&Fe?ee.createHTML(c):c},a.setConfig=function(){ut(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Re=!0},a.clearConfig=function(){st=null,Re=!1},a.isValidAttribute=function(e,t,a){st||ut({});const n=lt(e),i=lt(t);return Lt(n,i,a)},a.addHook=function(e,t){"function"==typeof t&&h(pe[e],t)},a.removeHook=function(e,t){if(void 0!==t){const a=f(pe[e],t);return-1===a?void 0:y(pe[e],a,1)[0]}return g(pe[e])},a.removeHooks=function(e){pe[e]=[]},a.removeAllHooks=function(){pe={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},a}();class ie{static downloadFileFromString(e,t,a){var n=new Blob([e],{type:t}),i=document.createElement("a");i.download=a,i.href=URL.createObjectURL(n),i.dataset.downloadurl=[t,i.download,i.href].join(":"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((()=>{URL.revokeObjectURL(i.href)}),1500)}static downloadFile(e,a,n,i){var r=new XMLHttpRequest;r.open("POST",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200===this.status){var o="",l=r.getResponseHeader("Content-Disposition");if(l&&-1!==l.indexOf("filename")){var s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(l);null!=s&&s[1]&&(o=s[1].replace(/['"]/g,""))}let e=r.getResponseHeader("Content-Type");navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"application/pdf"==e&&(e="application/octet-stream");const t=new File([this.response],o,{type:e}),a=URL.createObjectURL(t);if(o){const e=document.createElement("a");e.href=a,e.download=o,e.dispatchEvent(new MouseEvent("click"))}else window.open(a);setTimeout((()=>URL.revokeObjectURL(a)),100)}else"function"==typeof i&&i(new t("HTTP error: "+this.status,this.status,e,{method:"POST",body:$.param(a,!0)}));"function"==typeof n&&n()},"function"==typeof i&&r.addEventListener("error",i),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send($.param(a,!0))}static fetch(a,n){return fetch(a,n).then((e=>e.ok?e:Promise.reject(new t("HTTP error: "+e.status,e.status,a,n)))).catch((t=>t instanceof e?Promise.reject(t):Promise.reject(new e(t.message,a,n))))}static fetchJSON(e,t){return ie.fetch(e,t).then((n=>{const i=n.headers.get("Content-Type")||"";return i.includes("application/json")||i.includes("application/vnd.geo+json")?n.json().catch((i=>Promise.reject(new a("Invalid JSON: "+i.message,n,e,t)))):Promise.reject(new a("Invalid content type: "+i,n,e,t))})).catch((e=>Promise.reject(e)))}static fetchHTML(e,t){return ie.fetch(e,t).then((n=>{const i=n.headers.get("Content-Type")||"";return i.includes("text/html")?n.text().catch((i=>Promise.reject(new a("HTML error: "+i.message,n,e,t)))):Promise.reject(new a("Invalid content type: "+i,n,e,t))})).catch((e=>Promise.reject(e)))}static getResolutionFromScale(e,t){return e/(1e3/25.4*96*t)}static getScaleFromResolution(e,t){return e*(1e3/25.4)*96*t}static sanitizeGFIContent(e){return ne.addHook("afterSanitizeAttributes",(e=>{"IFRAME"!==e.nodeName||e.attributes.src.textContent.startsWith(document.location.origin)||e.setAttribute("sandbox","allow-scripts allow-forms")})),ne.sanitize(e,{ADD_TAGS:["iframe"],ADD_ATTR:["target"],CUSTOM_ELEMENT_HANDLING:{tagNameCheck:/^lizmap-/,attributeNameCheck:/crs|bbox|edition-restricted|layerid|layertitle|uniquefield|expressionfilter|withgeometry|sortingfield|sortingorder|draggable/}})}}class re{constructor(){this._defaultGetFeatureParameters={repository:globalThis.lizUrls.params.repository,project:globalThis.lizUrls.params.project,SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.0.0",OUTPUTFORMAT:"GeoJSON"},this._defaultDescribeFeatureTypeParameters={repository:globalThis.lizUrls.params.repository,project:globalThis.lizUrls.params.project,SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:"1.0.0",OUTPUTFORMAT:"JSON"}}async getFeature(e){return ie.fetchJSON(globalThis.lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetFeatureParameters,...e})})}async describeFeatureType(e){return ie.fetchJSON(globalThis.lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultDescribeFeatureTypeParameters,...e})})}}class oe{constructor(){this._defaultGetFeatureInfoParameters={repository:globalThis.lizUrls.params.repository,project:globalThis.lizUrls.params.project,SERVICE:"WMS",REQUEST:"GetFeatureInfo",VERSION:"1.3.0",CRS:"EPSG:4326",INFO_FORMAT:"text/html"},this._defaultGetLegendGraphicParameters={repository:globalThis.lizUrls.params.repository,project:globalThis.lizUrls.params.project,SERVICE:"WMS",REQUEST:"GetLegendGraphic",VERSION:"1.3.0",FORMAT:"application/json"}}async getFeatureInfo(e){return ie.fetchHTML(globalThis.lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetFeatureInfoParameters,...e})})}async getLegendGraphic(e){return ie.fetchJSON(globalThis.lizUrls.wms,{method:"POST",body:new URLSearchParams({...this._defaultGetLegendGraphicParameters,...e})})}}window.lizMap=function(){var e=null,t=null,a=null,n=null,i=null,r=null,o=[],l=[],s={},p={osm:"osm-mapnik","osm-toner":"osm-stamen-toner",opentopomap:"open-topo-map","osm-cycle":"osm-cyclemap",gsat:"google-satellite",ghyb:"google-hybrid",gphy:"google-terrain",gmap:"google-street",bmap:"bing-road",baerial:"bing-aerial",bhybrid:"bing-hybrid",ignmap:"ign-scan",ignplan:"ign-plan",ignphoto:"ign-photo",igncadastral:"ign-cadastral"},c={},u={},m={},d={},f={},g=null;function h(e){if(e in c)return e;if(null==e)return console.log("An undefined name has been clean"),"";var t=function(e){var t={à:"a",á:"a",â:"a",ã:"a",ä:"a",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",ÿ:"y",À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y","-":" ","'":" ","(":" ",")":" "},a=function(e){for(var a="",n=0;n<e.length;n++)a+=t[e.charAt(n)]||e.charAt(n);return a}(e),n=new RegExp("\\W","g");return a.replace(n,"_")}(e);if(t in c&&c[t]!=e){for(var a=1,n=t+a;n in c&&c[n]!=e;)n=t+(a+=1);t=n}return c[t]=e,t}function y(e){var t=null;return e in f&&(t=f[e]),null==t&&e in c&&(t=c[e],f[e]=t),t}function v(){if(!document.querySelector("body").classList.contains("print_popup")){var e;(e=w())!=$("#content").hasClass("mobile")&&(e?($("#content, #headermenu").addClass("mobile"),$("#button-switcher").parent().hasClass("active")&&$("#button-switcher").click(),$("#menu").is(":visible")&&$("#menu").hide(),$("#map-content").append($("#toolbar")),$("#toggleLegend").attr("data-original-title",$("#toggleLegendOn").attr("value")).parent().attr("class","legend"),$("div.locate-layer select").show(),$("span.custom-combobox").hide()):($("#content, #headermenu").removeClass("mobile"),$("#button-switcher").parent().hasClass("active")||$("#button-switcher").click(),$("#menu").is(":visible")?$("#map-content").show():$("#content span.ui-icon-open-menu").click(),$("#toolbar").insertBefore($("#switcher-menu")),$("#toggleLegend").attr("data-original-title",$("#toggleMapOnlyOn").attr("value")).parent().attr("class","map"),$("div.locate-layer select").hide(),$("span.custom-combobox").show()));var t=$(window).innerHeight();t-=$("#header").height(),$("#map").height(t),$("body").css("padding-top",$("#header").outerHeight());var a=$("body").parent()[0].offsetWidth;a-=parseInt($("#map-content").css("margin-left")),a-=parseInt($("#map-content").css("margin-right")),$("#menu").is(":hidden")||$("#map-content").hasClass("fullscreen")?$("#map-content").css("margin-left","auto"):(a-=$("#menu").width(),$("#map-content").css("margin-left",$("#menu").width())),$("#map").width(a),$("#right-dock-tabs").is(":visible")&&$("#right-dock-content").css("max-height",$("#right-dock").height()-$("#right-dock-tabs").height())}}function b(t){var a=e.locateByLayer[t],n={};for(var i in a.features)n[i]=a.features[i];if("filterFieldName"in a){var r=$("#locate-layer-"+h(t)+"-"+a.filterFieldName).val();if("-1"!=r)for(var i in n)(g=n[i]).properties[a.filterFieldName]!=r&&delete n[i];else n={}}if("vectorjoins"in a&&0!=a.vectorjoins.length)for(var o=a.vectorjoins,l=0,s=o.length;l<s;l++){var p=o[l],c=p.joinLayer;if(c in e.locateByLayer){var u=e.locateByLayer[c],m=$("#locate-layer-"+h(c)).val();if("-1"==m)continue;var d=u.features[m];for(var i in n)(g=n[i]).properties[p.targetFieldName]!=d.properties[p.joinFieldName]&&delete n[i]}}var f='<option value="-1" label="'+e.layers[t].title+'"></option>';for(var i in n){var g;f+='<option value="'+(g=n[i]).id+'">'+ne.sanitize(g.properties[a.fieldName])+"</option>"}$("#locate-layer-"+h(t)).html(f)}function E(t){lizMap.mainLizmap.map.clearHighlightFeatures();var a=e.locateByLayer[t],n=h(t),i=new OpenLayers.Projection(a.crs),o=$("#locate-layer-"+n).val();if("-1"==o)lizMap.events.triggerEvent("lizmaplocatefeaturecanceled",{featureType:t});else{var l=a.features[o],s=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0});if(null!=(l=s.read(l)[0]).geometry){if(l.geometry.transform(i,r.getProjection()),"True"==a.displayGeom){var p=M(t,null,null,null);p.options.PROPERTYNAME=["geometry",a.fieldName].join(","),p.options.FEATUREID=o,$.post(p.url,p.options,(function(e){e.features||(e=JSON.parse(e)),lizMap.mainLizmap.map.setHighlightFeatures(e.features[0],"geojson")})).fail((function(){lizMap.mainLizmap.map.setHighlightFeatures(l,"geojson")}))}r.zoomToExtent(l.geometry.getBounds())}var c=o.split(".")[1];lizMap.events.triggerEvent("lizmaplocatefeaturechanged",{featureType:t,featureId:c})}}function T(t){var a=e.locateByLayer[t],n=["geometry",a.fieldName];if("filterFieldName"in a&&n.push(a.filterFieldName),"filterjoins"in a)for(var i=a.filterjoins,r=0,o=i.length;r<o;r++){var l=i[r];n.push(l.targetFieldName)}if("vectorjoins"in a){var s=a.vectorjoins;for(r=0,o=s.length;r<o;r++){var p=s[r];n.push(p.targetFieldName)}}var c=M(t,null,null,"extent");c.options.PROPERTYNAME=n.join(",");var u=h(t);$.post(c.url,c.options,(function(n){var i=e.layers[t];a.features={},n.features||(n=JSON.parse(n));var r=n.features;if("EPSG:4326"!=a.crs&&0!=r.length&&C(a.crs,(function(){a.crs="EPSG:4326"})),"filterFieldName"in a){r.sort((function(e,t){var n=e.properties[a.filterFieldName],i=t.properties[a.filterFieldName];return isNaN(n)?isNaN(i)?n.localeCompare(i):1:isNaN(i)?-1:parseFloat(n)-parseFloat(i)}));var o="";"filterFieldAlias"in a&&""!=a.filterFieldAlias?o+=a.filterFieldAlias+" ":o+=a.filterFieldName,o+=" ("+i.title+")";for(var l='<option value="-1"></option>',s="-1",p=0,c=r.length;p<c;p++)s!=(f=r[p]).properties[a.filterFieldName]&&(l+='<option value="'+(s=f.properties[a.filterFieldName])+'">'+s+"</option>");$("#locate-layer-"+u).parent().before('<div class="locate-layer"><select id="locate-layer-'+u+"-"+a.filterFieldName+'">'+l+"</select></div><br/>"),$("#locate-layer-"+u+"-"+a.filterFieldName).change((function(){var e=$(this).children(":selected").val();b(t),"-1"==e&&$("#locate-layer-"+u+"-"+a.filterFieldName+" ~ span > input").val(""),$("#locate-layer-"+u+" ~ span > input").val(""),$("#locate-layer-"+u).val("-1"),E(t)})),$("#locate-layer-"+u+"-"+a.filterFieldName).combobox({position:{my:"right top",at:"right bottom"},selected:function(e,t){if(t.item){var a=$(this),n=$(t.item);window.setTimeout((function(){a.val(n.val()).change()}),1)}}}),$("#locate-layer-"+u+"-"+a.filterFieldName+" ~ span > input").attr("placeholder",o).val(""),$("#locate-layer-"+u+"-"+a.filterFieldName+" ~ span > input").autocomplete("close")}r.sort((function(e,t){var n=e.properties[a.fieldName],i=t.properties[a.fieldName];return isNaN(n)?isNaN(i)?n.localeCompare(i):1:isNaN(i)?-1:parseFloat(n)-parseFloat(i)}));var m="";"filterFieldName"in a?("fieldAlias"in a&&""!=a.fieldAlias?m+=a.fieldAlias+" ":m+=a.fieldName+" ",m+="("+i.title+")"):m=i.title;var d='<option value="-1"></option>';for(p=0,c=r.length;p<c;p++){var f=r[p];a.features[f.id.toString()]=f,"filterFieldName"in a||(d+='<option value="'+f.id+'">'+ne.sanitize(f.properties[a.fieldName])+"</option>")}$("#locate-layer-"+u).html(d).change((function(){if("-1"==$(this).children(":selected").val()){if($("#locate-layer-"+u+" ~ span > input").val(""),"filterjoins"in a&&0!=a.filterjoins.length)for(var n=0,i=(o=a.filterjoins).length;n<i;n++)if((l=o[n].joinLayer)in e.locateByLayer){var r=$("#locate-layer-"+h(l)).val();return b(l),void $("#locate-layer-"+h(l)).val(r)}if("vectorjoins"in a&&1==a.vectorjoins.length&&(l=a.vectorjoins[0].joinLayer)in e.locateByLayer)return void E(l);E(t)}else if(E(t),"filterjoins"in a&&0!=a.filterjoins.length){var o;for(n=0,i=(o=a.filterjoins).length;n<i;n++){var l;(l=o[n].joinLayer)in e.locateByLayer&&(b(l),$("#locate-layer-"+h(l)).val("-1"),$("#locate-layer-"+h(l)+" ~ span > input").val(""))}}$(this).blur()})),$("#locate-layer-"+u).combobox({minLength:"minLength"in a?a.minLength:0,position:{my:"right top",at:"right bottom"},selected:function(e,t){if(t.item){var a=$(this),n=$(t.item);window.setTimeout((function(){a.val(n.val()).change()}),1)}}}),$("#locate-layer-"+u+" ~ span > input").attr("placeholder",m).val(""),$("#locate-layer-"+u+" option[value=-1]").attr("label",m),$("#locate-layer-"+u+" ~ span > input").autocomplete("close"),"minLength"in a&&a.minLength>0&&$("#locate-layer-"+u).parent().addClass("no-toggle"),w()&&($("div.locate-layer select").show(),$("span.custom-combobox").hide())}),"json")}function L(t,a,n){lizMap.mainLizmap.map.clearHighlightFeatures();var i=r.getLonLatFromPixel(a),o=null,l=null;if("popupLocation"in e.options&&"map"!=e.options.popupLocation){l="popupcontent";var s=new RegExp("lizmapPopupTable","g"),p='<div class="lizmapPopupContent">'+(t=t.replace(s,"table table-condensed table-striped table-bordered lizmapPopupTable"))+"</div>",c=!(!t||null==t||""==t);document.querySelector("#popupcontent div.menu-content").innerHTML=p,$("#mapmenu .nav-list > li.popupcontent").is(":visible")||$("#mapmenu .nav-list > li.popupcontent").show(),c||(p='<div class="lizmapPopupContent noContent"><h4>'+lizDict["popup.msg.no.result"]+"</h4></div>",document.querySelector("#popupcontent div.menu-content").innerHTML=p,window.setTimeout((function(){$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&$("#popupcontent .lizmapPopupContent").hasClass("noContent")&&"right-dock"!=e.options.popupLocation&&$("#button-popupcontent").click()}),2e3)),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")||!(!w()||w()&&c)||null!=g&&i.lon==g.lon&&i.lat==g.lat?$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&w()&&c&&$("#button-popupcontent").click():$("#button-popupcontent").click()}else{if(lizMap.mainLizmap.popup.mapPopup.setVisible(!1),!t||null==t||""==t)return!1;document.getElementById("liz_layer_popup_contentDiv").innerHTML=t,n?lizMap.mainLizmap.popup.mapPopup.setPosition(n):lizMap.mainLizmap.popup.mapPopup.setPosition([i.lon,i.lat]),$("#"+l+' a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")}))}g=i,N(0,l),z(0,l),S(0,l),lizMap.events.triggerEvent("lizmappopupdisplayed",{popup:o,containerId:l})}function z(e,t){let a="div.lizmapPopupContent div.lizmapPopupDiv > input.lizmap-popup-layer-feature-geometry";t&&(a="#"+t+" "+a);const n=[];if(document.querySelectorAll(a).forEach((e=>n.push(e.value))),n.length){const e=`GEOMETRYCOLLECTION(${n.join()})`;lizMap.mainLizmap.map.setHighlightFeatures(e,"wkt")}}function S(e,t){if(!("datavizLayers"in lizMap.config))return!1;var a="div.lizmapPopupContent div.lizmapPopupDiv";t&&(a="#"+t+" "+a),$(a).each((function(){var e=$(this);if($(this).find("div.lizdataviz").length>0)return!0;if($(this).find("input.lizmap-popup-layer-feature-id:first").val()){var t=$(this).find("input.lizmap-popup-layer-feature-id:first").val().split("."),a=t[0]+"_"+t[1],n=t[0],i=t[1],r=lizMap.getLayerConfigById(n);if(!r)return!0;var o=r[0];if(!("relations"in lizMap.config)||!(n in lizMap.config.relations))return!0;if(!("datavizLayers"in lizMap.config))return!0;lizMap.getLayerFeature(o,i,(function(i){var r=lizMap.config.datavizLayers.layers,o=lizMap.config.relations[n],l=1;for(var s in r)for(var p in o){var c=o[p],u=c.referencingLayer,m='"'+c.referencingField+"\" IN ('"+i.properties[c.referencedField]+"')";if(r[s].layer_id==u){var d=r[s];if("popup_display_child_plot"in d&&"True"==d.popup_display_child_plot){var f=r[s].plot_id;a=t[0]+"_"+t[1]+"_"+String(l),a+="_"+(new Date).valueOf()+btoa(Math.random()).substring(0,12);var g=lizDataviz.buildPlotContainerHtml(d.title_popup,d.abstract,a,!1),h='<div class="lizmapPopupChildren lizdataviz">';h+="<h4>"+d.title_popup+"</h4>",h+=g,h+="</div>";var y=$(e).find("div.lizmapPopupChildren:last");y.length>0?$(y).after(h):$(e).append(h),lizDataviz.getPlot(f,m,a),l++}}}}))}}))}function N(t,a){var n="div.lizmapPopupContent input.lizmap-popup-layer-feature-id";a&&(n="#"+a+" "+n),$(n).each((function(){var t=$(this),a=t.val(),n=a.split(".").pop(),i=a.replace("."+n,""),r=_(i);if(!r)return!0;var o=r[1],l=r[0];if(!("popupDisplayChildren"in o)||"True"!=o.popupDisplayChildren)return!0;if(!("relations"in e)||!(i in e.relations))return!0;var s=e.relations[i],p=10;"popupMaxFeatures"in o&&!isNaN(parseInt(o.popupMaxFeatures))&&(p=parseInt(o.popupMaxFeatures)),x(l,n,(function(a){var r=t.parent();const o=[],l=[],c=[],u=[];for(const n of s){const r=n.referencingLayer;let o=null,s={rLayerId:r,relationId:n.relationId};const p=lizMap.getLayerConfigById(r,lizMap.config.attributeLayers,"layerId");if(p&&"True"==p[1]?.pivot&&e.relations.pivot&&e.relations.pivot[r]){const l=lizMap.getLayerConfigById(r,e.layers,"id");if(l){var m=Object.keys(e.relations.pivot[r]).filter((e=>e!==i));if(1==m.length){const p=_(m[0]);if(p){let c=p[1]?.shortname||p[1]?.cleanname;if(void 0===c&&(c=h(p[1].name),p[1].cleanname=c),"True"==p[1].popup&&0==t.parent().find("div.lizmapPopupChildren."+c).length){const t={TYPENAME:l[1].typename,GEOMETRYNAME:"extent"};t.EXP_FILTER='"'+e.relations.pivot[r][i]+"\" = '"+a.properties[n.referencedField]+"'","True"==e.options?.limitDataToBbox&&(t.BBOX=lizMap.mainLizmap.map.getView().calculateExtent(),t.SRSNAME=lizMap.mainLizmap.map.getView().getProjection().getCode()),o=lizMap.mainLizmap.wfs.getFeature(t);let c={pivotTableId:r,mLayerConfig:p};s={...s,...c}}}}}}else{const e=_(r);if(e){o={oneToN:!0,layer:e[1],relationId:n.relationId};let t={referencingField:n.referencingField,referencedField:n.referencedField};s={...s,...t}}}l.push(o),c.push(s)}Promise.allSettled(l).then((l=>{for(let n=0;n<l.length;n++){const i=l[n],r=c[n];if(i.value){const n=i.value;var s=null,m=null;if(n.oneToN&&r.referencingField&&r.referencedField)s=n.layer,m='"'+r.referencingField+"\" = '"+a.properties[r.referencedField]+"'";else if(n.features){const t=n.features,a=e.relations[r.mLayerConfig[1].id].filter((e=>e.referencingLayer==r.rLayerId))[0]?.referencedField;let i=[];const o={};if(t.forEach((t=>{var a=t.id.split(".")[1];o[a]=t,t.properties&&t.properties[e.relations.pivot[r.rLayerId][r.mLayerConfig[1].id]]&&i.push(t.properties[e.relations.pivot[r.rLayerId][r.mLayerConfig[1].id]])})),i.length){let e=i.map((function(e){return'"'+a+"\" = '"+e+"'"}));m=e.join(" OR ")}lizMap.getLayerConfigById(r.pivotTableId,e.layers,"id")[1].features=o,s=r.mLayerConfig[1]}if(m&&s){const e=s;let a=e?.shortname||e.cleanname;if(void 0===a&&(a=h(e.name),e.cleanname=a),"True"==e.popup&&0==t.parent().find("div.lizmapPopupChildren."+a).length){let t=e?.shortname||e.name;const a={LAYERS:t,QUERY_LAYERS:t,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",CRS:"crs"in e&&""!=e.crs?e.crs:"EPSG:4326",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",FEATURE_COUNT:p,INFO_FORMAT:"text/html"};"popupMaxFeatures"in e&&!isNaN(parseInt(e.popupMaxFeatures))&&(a.FEATURE_COUNT=parseInt(e.popupMaxFeatures)),0==a.FEATURE_COUNT&&(a.FEATURE_COUNT=p),e.request_params&&e.request_params.filter&&""!==e.request_params.filter?a.FILTER=e.request_params.filter+" AND "+m:a.FILTER=t+":"+m,u.push(e),o.push(fetch(globalThis.lizUrls.service,{method:"POST",body:new URLSearchParams(a)}).then((function(e){return e.text()})).then((function(e){return{popupChildData:e,utilities:r}})))}}}}Promise.allSettled(o).then((e=>{const a=[];for(let t=0;t<e.length;t++){let d=e[t].value,f=d.popupChildData;const g=d.utilities;if(f&&null!=f&&""!=f){var o=new RegExp("lizmapPopupTable","g");f=f.replace(o,"table table-condensed table-striped lizmapPopupTable");const e=u[t];var l=e.cleanname;if(void 0===l&&(l=h(e.name),e.cleanname=l),g.pivotTableId){var s=new RegExp("<lizmap-feature-toolbar ","g");f=f.replace(s,"<lizmap-feature-toolbar parent-layer-id='"+i+"' pivot-layer='"+g.pivotTableId+":"+n+"'")}const d='<button class="compact-tables btn btn-small" data-original-title="'+lizDict["popup.table.compact"]+'"><i class="icon-resize-small"></i></button><button class="explode-tables btn btn-small hide" data-original-title="'+lizDict["popup.table.explode"]+'"><i class="icon-resize-full"></i></button>';var p=$('<div class="lizmapPopupChildren '+l+'" data-layername="'+l+'" data-title="'+e.title+'">'+d+f+"</div>");if(-1!==["qgis","form"].indexOf(e.popupSource)&&0!=p.find(".lizmap_merged").length){p.find(".lizmapPopupDiv").each((function(e,t){var a=$(t);"TR"==a.find(".lizmapPopupHeader").prop("tagName")?(a.find(".lizmapPopupHeader").prepend("<th></th>"),a.find(".lizmapPopupHeader").next().prepend("<td></td>")):a.find(".lizmapPopupHeader").next().prepend("<span></span>"),a.find(".lizmapPopupHeader").next().children().first().append(a.find("input"))})),p.find("h4").each((function(e,t){0!=e&&$(t).remove()})),p.find(".lizmapPopupHeader").each((function(e,t){0!=e&&$(t).remove()})),p.find(".lizmapPopupDiv").contents().unwrap(),p.find(".lizmap_merged").contents().unwrap(),p.find(".lizmapPopupDiv").remove(),p.find(".lizmap_merged").remove(),p.find(".lizmapPopupHidden").hide();var c=$("<table class='lizmap_merged'></table>");p.append(c),p.find("tr").appendTo(c),p.children("tbody").remove()}var m=r.find("div.lizmapPopupChildren."+l);0!=m.length&&m.remove(),r.append(p),a.push({childPopupElement:p,relationId:g.relationId}),lizMap.events.triggerEvent("lizmappopupchildrendisplayed",{html:p.html()})}}r.find(".lizmapPopupChildren .popupAllFeaturesCompact table").DataTable({order:[[1,"asc"]],language:{url:globalThis.lizUrls.dataTableLanguage}}),r.find(".lizmapPopupChildren .compact-tables, .lizmapPopupChildren .explode-tables").tooltip(),r.find(".lizmapPopupChildren .compact-tables").off("click").on("click",(function(){$(this).addClass("hide").siblings(".explode-tables").removeClass("hide").siblings(".popupAllFeaturesCompact, .lizmapPopupSingleFeature").toggle()})),r.find(".lizmapPopupChildren .explode-tables").off("click").on("click",(function(){$(this).addClass("hide").siblings(".compact-tables").removeClass("hide").siblings(".popupAllFeaturesCompact, .lizmapPopupSingleFeature").toggle()})),r.children(".container.popup_lizmap_dd").find(".popup_lizmap_dd_relation").each(((e,t)=>{let n=t.dataset.relationId,i=a.filter((e=>e.relationId==n));1==i.length&&$(t).append(i[0].childPopupElement)})),lizMap.events.triggerEvent("lizmappopupallchildrendisplayed",{parentPopupElement:t.parents(".lizmapPopupSingleFeature"),childPopupElements:a.map((e=>e.childPopupElement))})}))}))}))}))}function _(t,a,n){for(var i in n=void 0!==n?n:"id",a=void 0!==a?a:e.layers)if(a[i][n]==t)return[i,a[i]];return null}function C(e,t){var a=e.replace(/^\s+|\s+$/g,"");a in Proj4js.defs?t(a):$.get(globalThis.lizUrls.service,{SERVICE:"WMS",REQUEST:"GetProj4",authid:a},(function(e){Proj4js.defs[a]=e,new OpenLayers.Projection(a),t(a)}))}function w(){var e=$("body").parent()[0].offsetWidth;return e-450<450||e<450}function O(e,t,a,n){var i="info",r=!1;["info","error","success"].includes(t)&&(i=t),a&&(r=!0);var o='<div class="alert alert-block alert-'+i+' fade in" data-alert="alert">';r&&(o+='<a class="close" data-dismiss="alert" href="#">×</a>'),o+="<p>"+e+"</p>",o+="</div>";var l=$(o);return $("#message").append(l),n&&window.setTimeout((()=>{l.remove()}),n),l}function M(t,a,n,i,r,o,l){var s={};if(a=void 0!==a?a:null,n=void 0!==n?n:null,i=void 0!==i?i:null,r=void 0!==r&&r,o=void 0!==o?o:null,l=void 0!==l?l:null,!(t in e.layers)){var p=lizMap.getNameByCleanName(t);if(p&&p in e.layers||(p=lizMap.getNameByShortName(t)),p&&p in e.layers||(p=lizMap.getNameByTypeName(t)),!p||!(p in e.layers))return console.log('getVectorLayerWfsUrl: "'+t+'" and "'+p+'" not found in config'),!1;t=p}var c=e.layers[t],u=t.split(" ").join("_");"shortname"in c&&""!=c.shortname?u=c.shortname:"typename"in c&&""!=c.typename&&(u=c.typename);var m={SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"GetFeature",TYPENAME:u,OUTPUTFORMAT:"GeoJSON"};o&&(m.STARTINDEX=o),l&&(m.MAXFEATURES=l);var d=[];if(a?""!=(a=a.replace(t+":",""))&&d.push(a):"request_params"in e.layers[t]&&"filter"in e.layers[t].request_params&&(a=e.layers[t].request_params.filter)&&(a=a.replace(t+":",""),d.push(a)),n?m.FEATUREID=n.replace(new RegExp(t,"g"),u):d.length&&(m.EXP_FILTER=d.join(" AND ")),r){const a=lizMap.mainLizmap.map.getView().calculateExtent(),n=lizMap.mainLizmap.transformExtent(a,lizMap.mainLizmap.map.getView().getProjection().getCode(),e.layers[t].crs);m.BBOX=n.join()}return i&&-1!=$.inArray(i.toLowerCase(),["none","extent","centroid"])&&(m.GEOMETRYNAME=i),s.url=globalThis.lizUrls.service,s.options=m,s}var P={};function A(e,t){var a=P[e];delete P[e],a.callbacks.forEach((function(e){e&&e(a.layerName,a.filter,t,a.alias,a.types)}))}function R(t,a,n,i,r,o,l,s){if(a=void 0!==a?a:null,n=void 0!==n?n:null,i=void 0!==i?i:null,r=void 0!==r&&r,o=void 0!==o?o:null,l=void 0!==l?l:null,!(t in e.layers)){var p=lizMap.getNameByCleanName(t);if(p&&p in e.layers||(p=lizMap.getNameByShortName(t)),p&&p in e.layers||(p=lizMap.getNameByTypeName(t)),!p||!(p in e.layers))return console.log('getFeatureData: "'+t+'" and "'+p+'" not found in config'),!1;t=p}var c=e.layers[t];$("body").css("cursor","wait");var u=lizMap.getVectorLayerWfsUrl(t,a,n,i,r,o,l),m=u.url+"|"+JSON.stringify(u.options);if(!(m in P))return P[m]={callbacks:[s],layerName:t,filter:a,alias:c.alias,types:c.types},(new re).getFeature(u.options).then((e=>{c.featureCrs="EPSG:4326",c?.alias&&c?.types?(A(m,e.features),$("body").css("cursor","auto")):$.post(globalThis.lizUrls.service,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"DescribeFeatureType",TYPENAME:"typename"in c?c.typename:t,OUTPUTFORMAT:"JSON"},(function(t){c.alias=t.aliases,c.types=t.types,c.columns=t.columns,A(m,e.features),$("body").css("cursor","auto")}),"json")})),!0;s&&P[m].callbacks.push(s)}function x(t,a,n,i,r){if(n&&t in e.layers){var o=e.layers[t],l=t+"."+a;!r&&o.features&&a in o.features?n(o.features[a]):R(t,null,l,"extent",!1,null,null,(function(e,r,l,s){if(1==l.length){var p=l[0];o.features||(o.features={}),o.features[a]=p,n(p)}else i&&i(t,a)}))}}function k(){return null==i?[]:i.getElementsByTagName("FeatureType")}function F(e,t,a,n,i){if($("#mapmenu .nav-list > li."+e+" > a").length)console.log(e+" menu item already exists");else{var r="";r+='<li class="'+e+" nav-"+a+'">',r+='   <a id="button-'+e+'" rel="tooltip" data-original-title="'+t+'" data-placement="right" href="#'+e+'" data-container="#content">',r+='       <span class="icon"><i class="'+i+' icon-white"></i></span><span class="menu-title">'+e+"</span>",r+="   </a>",r+="</li>",$("#mapmenu div ul li.nav-"+a+":last").after(r),0==$("#mapmenu div ul li.nav-"+a+"."+e).length&&$("#mapmenu div ul li:last").after(r),$("#mapmenu .nav-list > li."+e+" > a .icon").css("background-image","none"),$("#mapmenu .nav-list > li."+e+" > a .icon >i ").css("margin-left","4px"),$("#mapmenu .nav-list > li."+e+" > a").tooltip();var o="";o+='<div class="tab-pane" id="'+e+'">',"minidock"==a&&(o+='<div class="mini-dock-close" title="'+lizDict["toolbar.content.stop"]+'" style="padding:7px;float:right;cursor:pointer;"><i class="icon-remove icon-white"></i></div>',o+='    <div class="'+e+'">',o+="        <h3>",o+='            <span class="title">',o+='              <i class="'+i+' icon-white"></i>',o+='              <span class="text">&nbsp;'+t+"&nbsp;</span>",o+="            </span>",o+="        </h3>"),o+='        <div class="menu-content">',o+=n,o+="        </div>",o+="    </div>",o+="</div>","minidock"==a?($("#mini-dock-content").append(o),$("#"+e+" div.mini-dock-close").click((function(){$("#mapmenu .nav-list > li."+e).hasClass("active")&&$("#button-"+e).click()}))):"right-dock"==a?$("#right-dock-content").append(o):"dock"==a?$("#dock-content").append(o):"bottomdock"==a&&$("#bottom-dock-content").append(o);var l="";l+='<li id="nav-tab-'+e+'"><a href="#'+e+'" data-toggle="tab">'+t+"</a></li>","minidock"==a?$("#mini-dock-tabs").append(l):"right-dock"==a?$("#right-dock-tabs").append(l):"dock"==a?$("#dock-tabs").append(l):"bottomdock"==a&&$("#bottom-dock-tabs").append(l)}}var I={map:null,layers:null,baselayers:null,events:null,config:null,dictionary:null,tree:null,lizmapLayerFilterActive:null,getLizmapDesktopPluginMetadata:function(){return t={lizmap_plugin_version_str:"3.1.8",lizmap_plugin_version:30108,lizmap_web_client_target_version:30200,qgis_desktop_version:3e4},"metadata"in e?("lizmap_plugin_version"in e.metadata&&(t.lizmap_plugin_version=e.metadata.lizmap_plugin_version),"lizmap_web_client_target_version"in e.metadata&&(t.lizmap_web_client_target_version=e.metadata.lizmap_web_client_target_version),"qgis_desktop_version"in e.metadata&&(t.qgis_desktop_version=e.metadata.qgis_desktop_version),t):t;var t},checkMobile:function(){return w()},cleanName:function(e){return h(e)},getNameByCleanName:function(e){return function(e){var t=null;return e in c&&(t=c[e]),t}(e)},getNameByShortName:function(e){return function(e){var t=null;return e in m&&(t=m[e]),t}(e)},getNameByTypeName:function(e){return function(e){var t=null;return e in d&&(t=d[e]),t}(e)},getLayerNameByCleanName:function(e){return y(e)},addMessage:function(e,t,a,n){return O(e,t,a,n)},loadProjDefinition:function(e,t){return C(e,t)},updateContentSize:function(){return v()},clearDrawLayer:function(e){return t=e,void(0!=(a=r.getLayersByName(t)).length&&a[0].destroyFeatures());var t,a},getLayerFeature:function(e,t,a,n,i){x(e,t,a,n,i)},getFeatureData:function(e,t,a,n,i,r,o,l){R(e,t,a,n,i,r,o,l)},translateWfsFieldValues:function(e,t,a,n){return translateWfsFieldValues(e,t,a,n)},zoomToFeature:function(t,a,n){!function(t,a,n){n=void 0!==n?n:"zoom",x(t,a,(function(a){var i=new OpenLayers.Projection(e.layers[t].crs);e.layers[t].featureCrs&&(i=new OpenLayers.Projection(e.layers[t].featureCrs)),function(e,t,a){a=void 0!==a?a:"zoom";var n=new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0}).read(e)[0];if(n&&"geometry"in n&&(n.geometry.transform(t,lizMap.map.getProjection()),"zoom"==a&&r.zoomToExtent(n.geometry.getBounds()),"center"==a)){var i=n.geometry.getBounds().getCenterLonLat();r.setCenter(i)}}(a,i,n)}))}(t,a,n)},getExternalBaselayersReplacement:function(){return p},launchEdition:function(){return!1},deleteEditionFeature:function(){return!1},deactivateToolControls:function(e){return function(e){for(var t in s){var a=s[t];if(a){if(e&&"object"in e&&a==e.object)continue;a.type==OpenLayers.Control.TYPE_TOOL&&a.deactivate()}}return!0}(e)},displayGetFeatureInfo:function(e,t,a){return L(e,t,a)},exportVectorLayer:function(t,a,n){return function(t,a,n){if(n=void 0!==n?n:null,!("exportLayers"in lizMap.config.options)||"True"!=lizMap.config.options.exportLayers)return O(lizDict["layer.export.right.required"],"error",!0),!1;a=void 0!==a?a:"GeoJSON";var i=y(lizMap.cleanName(t));i||(i=t);var r=lizMap.config.layers[i];const o=!(!r.geometryType||"none"==r.geometryType||"unknown"==r),l="request_params"in r&&"selectiontoken"in r.request_params&&null!=r.request_params.selectiontoken&&""!=r.request_params.selectiontoken,s=i.match(/[\(\)]/g);if(o&&l&&!s){var p=M(t,null,null,null,n),c=r.request_params.selectiontoken;p.options.SELECTIONTOKEN=c}else{var u=function(t){var a="";if(t in e.layers&&e.layers[t].selectedFeatures){var n=[],i=e.layers[t],r=t.split(" ").join("_");for(var o in"shortname"in i&&""!=i.shortname&&(r=i.shortname),i.selectedFeatures)n.push(r+"."+i.selectedFeatures[o]);n.length&&(a=n.join())}return a}(i);p=M(t,null,u,null,n)}return p.options.dl=1,p.options.OUTPUTFORMAT=a,document.querySelectorAll(".exportLayer").forEach((e=>e.disabled=!0)),O(lizDict["layer.export.started"],"info",!0).addClass("export-in-progress"),ie.downloadFile(p.url,p.options,(()=>{document.querySelectorAll(".exportLayer").forEach((e=>e.disabled=!1)),document.querySelector("#message .export-in-progress a").click()})),!1}(t,a,n)},getVectorLayerWfsUrl:function(e,t,a,n,i){return M(e,t,a,n,i)},getVectorLayerFeatureTypes:function(){return k()},getVectorLayerResultFormat:function(){return function(){let e=[];if(null==i)return e;for(const t of i.getElementsByTagName("ResultFormat")[0].children)e.push(t.tagName);return e}()},getLayerConfigById:function(e,t,a){return _(e,t,a)},getFeaturePopupContent:function(e,t,a){return function(e,t,a){if(!a)return;if(!t)return!1;0!=lizMap.map.popups.length&&lizMap.map.removePopup(lizMap.map.popups[0]);var n,i=e;lizMap.getLayerNameByCleanName(e)&&(i=lizMap.getLayerNameByCleanName(e));var r=null;if(i in lizMap.config.layers&&(r=lizMap.config.layers[i]),!r)return!1;var o=null;if(i in lizMap.config.attributeLayers&&(o=lizMap.config.attributeLayers[i].primaryKey),!o&&"atlasLayer"in lizMap.config.options&&"atlasPrimaryKey"in lizMap.config.options&&r.id==lizMap.config.options.atlasLayer&&""!=lizMap.config.options.atlasPrimaryKey&&(o=lizMap.config.options.atlasPrimaryKey),!o&&"atlas"in lizMap.config&&"layers"in lizMap.config.atlas&&Array.isArray(lizMap.config.atlas.layers)&&lizMap.config.atlas.layers.length>0)for(let e=0;e<lizMap.config.atlas.layers.length;e++){const t=lizMap.config.atlas.layers[e];if(r.id===t.layer){o=t.primaryKey;break}}if(!o)return!1;var l=t.properties[o];const s=r?.shortname||r?.name||i;n=s+':"'+o+"\" = '"+l+"'";var p="EPSG:4326";"crs"in lizMap.config.layers[i]&&""!=lizMap.config.layers[i].crs&&(p=lizMap.config.layers[i].crs);var c={LAYERS:s,QUERY_LAYERS:s,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",CRS:p,REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",INFO_FORMAT:"text/html",FEATURE_COUNT:1,FILTER:n};$.post(globalThis.lizUrls.service,c,(function(e){a(ie.sanitizeGFIContent(e))}))}(e,t,a)},getFeaturePopupContentByFeatureIntersection:function(e,t,a){return function(e,t,a){var n=lizMap.map.getUnits(),i=lizMap.config.layers[e],r=lizMap.config.options.mapScales.at(0),o=2*Math.max(r,i.minScale),l=lizMap.config.options.mapScales.at(-1);l<i.maxScale&&o>l?o=o/2+(l-o/2)/2:o>i.maxScale&&(o=o/2+(i.maxScale-o/2)/2);var s=OpenLayers.Util.getResolutionFromScale(o,n),p=t.geometry.CLASS_NAME;if("OpenLayers.Geometry.Polygon"==p||"OpenLayers.Geometry.MultiPolygon"==p||"OpenLayers.Geometry.Point"==p)var c=t.geometry.getBounds().getCenterLonLat();else{var u=t.geometry.getVertices(),m=u[Math.floor(u.length/2)];c=new OpenLayers.LonLat(m.x,m.y)}var d=new OpenLayers.Bounds(c.lon-5*s,c.lat-5*s,c.lon+5*s,c.lat+5*s),f=lizMap.map.getProjectionObject().toString();"EPSG:900913"==f&&(f="EPSG:3857");var g={LAYERS:e,QUERY_LAYERS:e,STYLES:"",SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_inimage",BBOX:d.toBBOX(),FEATURE_COUNT:10,HEIGHT:100,WIDTH:100,INFO_FORMAT:"text/html",CRS:f,I:50,J:50};$.post(globalThis.lizUrls.service,g,(function(e){a&&a(globalThis.lizUrls.service,g,ie.sanitizeGFIContent(e))}))}(e,t,a)},addGeometryFeatureInfo:function(e,t){return z(0,t)},addChildrenFeatureInfo:function(e,t){return N(0,t)},addChildrenDatavizFilteredByPopupFeature:function(e,t){return S(0,t)},addDock:function(e,t,a,n,i){return F(e,t,a,n,i)},getHashParamFromUrl:function(e){var t=location.hash.replace("#","").split(",");for(var a in t){var n=t[a].split(":");if(2==n.length){var i=n[0],r=n[1];if(i==e)return r}}return null},triggerLayerFilter:function(t,a){return function(t,a){const n=lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(t).wmsName;if(a&&""!=a)i=n+":"+a;else{a=null;var i=null}return"request_params"in e.layers[t]||(e.layers[t].request_params={}),e.layers[t].request_params.exp_filter=a,fetch(globalThis.lizUrls.service,{method:"POST",body:new URLSearchParams({service:"WMS",request:"GETFILTERTOKEN",typename:t,filter:i})}).then((e=>e.json())).then((a=>{var n=a.token;e.layers[t].request_params.filtertoken=n,lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(t).filterToken={expressionFilter:e.layers[t].request_params.exp_filter,token:a.token},lizMap.events.triggerEvent("layerFilterParamChanged",{featureType:t,filter:i,updateDrawing:!1})})),!0}(t,a)},deactivateMaplayerFilter:function(t){return function(t){lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(t).expressionFilter=null,"request_params"in e.layers[t]||(e.layers[t].request_params={}),e.layers[t].request_params.exp_filter=null,e.layers[t].request_params.filtertoken=null,e.layers[t].request_params.filter=null}(t)},init:function(){const p=document.getElementById("lizmap-vars")?.innerText;if(p)try{const e=JSON.parse(p);for(const t in e)globalThis[t]=e[t]}catch{console.warn("JSON for Lizmap global variables is not valid!")}var c=this;const f=fetch(globalThis.lizUrls.config+"?"+new URLSearchParams(globalThis.lizUrls.params)).then((function(e){if(!e.ok)throw"Config not loaded: "+e.status+" "+e.statusText;return e.json()})),y=fetch(globalThis.lizUrls.keyValueConfig+"?"+new URLSearchParams(globalThis.lizUrls.params)).then((function(e){if(!e.ok)throw"Key/value config not loaded: "+e.status+" "+e.statusText;return e.json()})),b=fetch(globalThis.lizUrls.service+"&"+new URLSearchParams({SERVICE:"WMS",REQUEST:"GetCapabilities",VERSION:"1.3.0"})).then((function(e){if(!e.ok)throw"WMS GetCapabilities not loaded: "+e.status+" "+e.statusText;return e.text()})),E=fetch(globalThis.lizUrls.service+"&"+new URLSearchParams({SERVICE:"WMTS",REQUEST:"GetCapabilities",VERSION:"1.0.0"})).then((function(e){if(!e.ok)throw"WMTS GetCapabilities not loaded: "+e.status+" "+e.statusText;return e.text()})),S=fetch(globalThis.lizUrls.service+"&"+new URLSearchParams({SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:"1.0.0"})).then((function(e){if(!e.ok)throw"WFS GetCapabilities not loaded: "+e.status+" "+e.statusText;return e.text()}));let N,_,w;const M=new URL(document.location).searchParams,P=M.get("layer"),A=M.get("filter");if(P&&A){const e={TYPENAME:P,EXP_FILTER:A};if(N=(new re).getFeature(e),"true"===M.get("popup")){const e={QUERY_LAYERS:P,LAYERS:P,FEATURE_COUNT:50,FILTER:`${P}:${A}`};_=(new oe).getFeatureInfo(e)}}Promise.allSettled([f,y,b,E,S,N,_]).then((async p=>{const f=[p[0],p[2],p[3],p[4]];for(const e of f)if("rejected"===e.status)throw new Error(e.reason);e=p[0].value,t=p[1].value;const y=p[2].value,b=p[3].value,E=p[4].value;let L=p[5].value?.features?.[0]?.bbox,S=p[5].value?.features;if(L)for(const e of S)N=L,(_=e.bbox)[0]<N[0]&&(N[0]=_[0]),_[2]>N[2]&&(N[2]=_[2]),_[1]<N[1]&&(N[1]=_[1]),_[3]>N[3]&&(N[3]=_[3]),L=N;var N,_;let M=e=>new Promise((t=>setTimeout(t,e))),P=100;const A=await async function(){let t=0;for(;t<1e4&&(c.events.triggerEvent("configsloaded",{initialConfig:e,wmsCapabilities:y,wmtsCapabilities:b,wfsCapabilities:E,startupFeatures:p[5].value}),void 0===c.mainLizmap);)await M(P),t+=P,P*=2;return t}();if(void 0===c.mainLizmap)throw new Error("Until we wait "+A+" ms, mainLizmap has not been loaded!");w=p[6].value;const R=new DOMParser;if(e.options.hasOverview=!1,"useLayerIDs"in e.options&&"True"==e.options.useLayerIDs)for(var x in e.layers){var I=e.layers[x];u[I.id]=x}for(var x in e.layers)"shortname"in(I=e.layers[x])&&""!=I.shortname&&(m[I.shortname]=x),I.cleanname=h(x);const j=new OpenLayers.Format.WMSCapabilities({version:"1.3.0"});if(!(a=j.read(y)).capability)throw"WMS Capabilities error";const D=new OpenLayers.Format.WMTSCapabilities({});if("exceptionReport"in(n=D.read(b))){var U=$("#metadata-wmts-getcapabilities-url");0!=U.length&&U.before('<i title="'+n.exceptionReport.exceptions[0].texts[0]+'" class="icon-warning-sign"></i>&nbsp;'),n=null}c.wmtsCapabilities=b,i=R.parseFromString(E,"application/xml");var B=k();for(const t of B){var G=t.getElementsByTagName("Name")[0].textContent;if(!(x=lizMap.getNameByTypeName(G)))if(G in e.layers)x=G;else if(G in m&&m[G]in e.layers)x=m[G];else for(var H in e.layers)if(H.split(" ").join("_")==G){x=H;break}x in e.layers&&((I=e.layers[x]).typename=G,d[G]=x)}$("#abstract").html(a.abstract?a.abstract:"");var q=a.capability;e.options.qgisProjectProjection=Object.assign({},e.options.projection),c.config=e,c.events.triggerEvent("beforetreecreated",c),function(){"EPSG:900913"in Proj4js.defs&&!("EPSG:3857"in Proj4js.defs)&&(Proj4js.defs["EPSG:3857"]=Proj4js.defs["EPSG:900913"]);var t=e.options.projection;if(t.ref?(t.ref in Proj4js.defs||(Proj4js.defs[t.ref]=t.proj4),new OpenLayers.Projection(t.ref)):(t.ref="EPSG:3857",t.proj4=Proj4js.defs["EPSG:3857"]),"osmMapnik"in e.options||"osmStamenToner"in e.options||"openTopoMap"in e.options||"osmCyclemap"in e.options||"googleStreets"in e.options||"googleSatellite"in e.options||"googleHybrid"in e.options||"googleTerrain"in e.options||"bingStreets"in e.options||"bingSatellite"in e.options||"bingHybrid"in e.options||"ignTerrain"in e.options||"ignStreets"in e.options||"ignSatellite"in e.options||"ignCadastral"in e.options){var a=new OpenLayers.Projection(t.ref),n=e.options.bbox,i=e.options.initialExtent,r=new OpenLayers.Bounds(Number(n[0]),Number(n[1]),Number(n[2]),Number(n[3])),o=new OpenLayers.Bounds(Number(i[0]),Number(i[1]),Number(i[2]),Number(i[3]));r.transform(a,"EPSG:3857"),o.transform(a,"EPSG:3857"),e.options.bbox=r.toArray(),e.options.initialExtent=o.toArray(),t.ref="EPSG:3857",t.proj4=Proj4js.defs["EPSG:3857"]}var l=[];"mapScales"in e.options&&(l=Array.from(e.options.mapScales)),l.length<2&&(l=[e.options.maxScale,e.options.minScale]),l.sort((function(e,t){return Number(t)-Number(e)}));var s=!1;if("use_native_zoom_levels"in e.options?s=e.options.use_native_zoom_levels:("EPSG:3857"==t.ref&&(s=!0),2==l.length&&(s=!0)),s)if("EPSG:3857"==t.ref){var p=new OpenLayers.Projection("EPSG:3857"),c=[];e.options.zoomLevelNumber=24;for(var u=l[0],m=OpenLayers.Util.getResolutionFromScale(u,p.proj.units),d=l[l.length-1],f=OpenLayers.Util.getResolutionFromScale(d,p.proj.units),g=156543.03390625,h=1;g>f&&h<e.options.zoomLevelNumber;)g<m&&c.push(g),g/=2,h++;m=c[0],f=c[c.length-1],u=OpenLayers.Util.getScaleFromResolution(m,p.proj.units),d=OpenLayers.Util.getScaleFromResolution(f,p.proj.units),e.options.resolutions=c,0!=c.length&&(e.options.zoomLevelNumber=c.length,e.options.maxScale=u,e.options.minScale=d)}else if(2==l.length){var y=[];u=l[0],d=l[l.length-1];let t=1;for(;10*Math.pow(10,t)-1<u;)y=y.concat([10,25,50].map((e=>Math.pow(10,t)*e))),t++;let a=[];for(const e of y)if(!(e<d)){if(e>u)break;a.push(e)}a.sort((function(e,t){return Number(t)-Number(e)})),e.options.mapScales=a,e.options.maxScale=l[0],e.options.minScale=l[l.length-1]}}();var W=q.nestedLayers[0];c.config=e,c.keyValueConfig=t,function(t){const a=document.body.dataset?.proj4jsLibPath;if(a&&(Proj4js.libPath=a),globalThis.lizProj4)for(var n in globalThis.lizProj4)n in Proj4js.defs||(Proj4js.defs[n]=globalThis.lizProj4[n]);var i=e.options.projection;i.ref in Proj4js.defs||(Proj4js.defs[i.ref]=i.proj4);var r=new OpenLayers.Projection(i.ref);if(!(i.ref in OpenLayers.Projection.defaults)&&(OpenLayers.Projection.defaults[i.ref]=r,i.ref in t.bbox)){var o=t.bbox[i.ref].bbox,l=OpenLayers.Bounds.fromArray(o);OpenLayers.Bounds.fromArray(e.options.initialExtent).intersectsBounds(l)||(OpenLayers.Projection.defaults[i.ref].yx=!0)}}(W),function(t){var a=e.options.projection,n=new OpenLayers.Projection(a.ref),i=new OpenLayers.Projection("EPSG:4326"),l=i,s=!1,p=e.options.bbox,c=new OpenLayers.Bounds(Number(p[0]),Number(p[1]),Number(p[2]),Number(p[3])),u=c.scale(3);const m=new URL(document.location).searchParams;if(m.has("bbox")){let e=m.get("bbox").split(",");4===e.length&&(t=e),m.has("crs")&&(l=new OpenLayers.Projection(m.get("crs"))),s=!0}let d=window.location.hash.substring(1).split("|")[0].split(",");if(4===d.length&&(t=d,l=i,s=!0),t)(t=new OpenLayers.Bounds(t)).transform(l,n);else if(t=c.clone(),"initialExtent"in e.options&&4==e.options.initialExtent.length){var f=e.options.initialExtent;t=new OpenLayers.Bounds(Number(f[0]),Number(f[1]),Number(f[2]),Number(f[3]))}var g=$("body").parent()[0].clientHeight;g||(g=$("window").innerHeight()),g-=$("#header").height(),g-=$("#headermenu").height(),$("#map").height(g),v();var h=[],y=[];"resolutions"in e.options?y=Array.from(e.options.resolutions):"mapScales"in e.options&&(h=Array.from(e.options.mapScales)),h.sort((function(e,t){return Number(t)-Number(e)}));for(var b=[];0!=h.length;){var E=h.pop(0);-1==$.inArray(E,b)&&b.push(E)}h=b,OpenLayers.Util.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.Util.DEFAULT_PRECISION=20,r=new OpenLayers.Map("map",{controls:[new OpenLayers.Control.Navigation({mouseWheelOptions:{interval:100}})],tileManager:null,maxExtent:c,restrictedExtent:u,initialExtent:t,zoomToClosest:s,maxScale:0==h.length?e.options.minScale:"auto",minScale:0==h.length?e.options.maxScale:"auto",numZoomLevels:0==h.length?e.options.zoomLevelNumber:h.length,scales:0==h.length?null:h,resolutions:0==y.length?null:y,projection:n,units:null!==n.proj.units?n.proj.units:"degrees",allOverlays:0==o.length,autoUpdateSize:!1}),window.addEventListener("resize",v)}(L),c.map=r,c.layers=l,c.baselayers=o,c.controls=s,c.events.triggerEvent("mapcreated",c),0===o.length&&r.addLayer(new OpenLayers.Layer.Vector("baselayer",{maxExtent:r.maxExtent,maxScale:r.maxScale,minScale:r.minScale,numZoomLevels:r.numZoomLevels,scales:r.scales,projection:r.projection,units:r.projection.proj.units})),"locateByLayer"in e&&function(){var t=[];for(var a in e.locateByLayer)"order"in e.locateByLayer[a]?t[e.locateByLayer[a].order]=a:t.push(a);var n=[];for(var i in t){a=t[i];var r=e.layers[a],o='<div class="locate-layer">';o+='<select id="locate-layer-'+h(a)+'" class="label">',o+="<option>"+r.title+"...</option>",o+="</select>",o+="</div>",n.push(o)}$("#locate .menu-content").html(n.join("<hr/>"));var l=k();if(0==l.length)e.locateByLayer={},$("#button-locate").parent().remove(),$("#locate-menu").remove();else{for(const t of l){var s=t.getElementsByTagName("Name")[0].textContent;if(!(a=lizMap.getNameByTypeName(s)))if(s in e.locateByLayer)a=s;else if(s in m&&m[s]in e.locateByLayer)a=m[s];else for(var p in e.locateByLayer)if(p.split(" ").join("_")==s){a=p;break}if(a in e.locateByLayer){(d=e.locateByLayer[a]).crs=t.getElementsByTagName("SRS")[0].textContent,C(d.crs,(function(){new OpenLayers.Projection(d.crs)}));var c=t.getElementsByTagName("LatLongBoundingBox")[0];d.bbox=[parseFloat(c.getAttribute("minx")),parseFloat(c.getAttribute("miny")),parseFloat(c.getAttribute("maxx")),parseFloat(c.getAttribute("maxy"))]}}for(var u in e.locateByLayer){var d;if("vectorjoins"in(d=e.locateByLayer[u])&&0!=d.vectorjoins.length){var f=d.vectorjoins[0];for(var g in d.joinFieldName=f.targetFieldName,e.locateByLayer){var y=e.locateByLayer[g];y.layerId==f.joinLayerId&&(f.joinLayer=g,d.joinLayer=g,y.joinFieldName=f.joinFieldName,y.joinLayer=u,y.filterjoins=[{targetFieldName:f.joinFieldName,joinFieldName:f.targetFieldName,joinLayerId:d.layerId,joinLayer:u}])}}}for(var a in e.locateByLayer)T(a);$(".btn-locate-clear").click((function(){return lizMap.mainLizmap.map.clearHighlightFeatures(),$("#locate select").val("-1"),$("div.locate-layer span > input").val(""),lizMap.lizmapLayerFilterActive&&lizMap.events.triggerEvent("lizmaplocatefeaturecanceled",{featureType:lizMap.lizmapLayerFilterActive}),!1})),$("#locate-close").click((function(){return $(".btn-locate-clear").click(),$("#button-locate").click(),!1}))}}(),c.events.triggerEvent("layersadded",c);var Y,V=r.layers[r.layers.length-1].getZIndex();V>r.Z_INDEX_BASE.Feature-100&&(r.Z_INDEX_BASE.Feature=V+100,r.Z_INDEX_BASE.Popup=r.Z_INDEX_BASE.Feature+25,r.Z_INDEX_BASE.Popup>r.Z_INDEX_BASE.Control-25&&(r.Z_INDEX_BASE.Control=r.Z_INDEX_BASE.Popup+25)),r.getCenter()||r.zoomToExtent(r.initialExtent,r.zoomToClosest),v(),r.events.triggerEvent("zoomend",{zoomChanged:!0}),Y=e.options,function(){var t=!1;for(var a in e.layers){var n=e.layers[a],i=null;if("editionLayers"in e&&a in e.editionLayers&&(i=e.editionLayers[a]),n&&n.popup&&"True"==n.popup||i&&("True"==i.capabilities.modifyGeometry||"True"==i.capabilities.modifyAttribute||"True"==i.capabilities.deleteFeature)){t=!0;break}}if(!t)return $("#mapmenu .nav-list > li.popupcontent > a").length&&$("#mapmenu .nav-list > li.popupcontent").remove(),null;if("popupLocation"in e.options&&"map"!=e.options.popupLocation){var o="popupcontent";if($("#mapmenu .nav-list > li.popupcontent > a").length)$("#mapmenu .nav-list > li.popupcontent > a > span.icon").append('<i class="icon-comment icon-white" style="margin-left: 4px;"></i>'),$("#mapmenu .nav-list > li.popupcontent > a > span.icon").css("background-image","none");else{"popup.msg.start"in lizDict||(lizDict["popup.msg.start"]="Click to the map to get informations.");var l='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.start"]+"</h4></div>";F(o,"Popup",e.options.popupLocation,l,"icon-comment")}$("#button-popupcontent").click((function(){$(this).parent().hasClass("active")?lizMap.mainLizmap.map.clearHighlightFeatures():z(0,o)}))}function s(e){if(e.updateDrawing){if(null==g)return!0;if(r.getPixelFromLonLat(g),!($("#liz_layer_popup  div.lizmapPopupContent").length<1&&$("#popupcontent > div.menu-content div.lizmapPopupContent").length<1)){var t="liz_layer_popup";0==$("#"+t+" div.lizmapPopupContent input.lizmap-popup-layer-feature-id").length&&(t="popupcontent");var a=!1;$("#"+t+" div.lizmapPopupContent input.lizmap-popup-layer-feature-id").each((function(){var t=$(this).val(),n=t.split(".").pop(),i=t.replace("."+n,""),r=lizMap.getLayerConfigById(i);if(r&&r[0]==e.featureType)return a=!0,!1})),a&&$("#"+t+' div.lizmapPopupContent input.lizmap-popup-layer-feature-id[value="'+e.layerId+"."+e.featureId+'"]').parent().remove()}}}lizMap.events.on({layerFilterParamChanged:function(t){let a=document.querySelectorAll("input.lizmap-popup-layer-feature-id").length;if(0!=a)for(var n in e.layers){let r=e.layers[n];if("True"==r.popup&&"request_params"in r&&null!=r.request_params&&(a=document.querySelectorAll(`input.lizmap-popup-layer-feature-id[value^=${r.id}]`).length,0!=a)&&(r.request_params,"filter"in r.request_params&&null!=r.request_params.filter&&""!=r.request_params.filter)){var i={service:"WMS",request:"GETFILTERTOKEN",typename:n,filter:r.request_params.filter};$.post(globalThis.lizUrls.service,i,(function(e){lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(r.name).filterToken={expressionFilter:r.request_params.exp_filter,token:e.token},s(t)}))}}},layerSelectionChanged:function(e){s(e)},lizmapeditionfeaturedeleted:function(t){if($("div.lizmapPopupContent input.lizmap-popup-layer-feature-id").length>1)s(t);else if(0!=r.popups.length&&r.removePopup(r.popups[0]),"popupLocation"in e.options&&"map"!=e.options.popupLocation){var a='<div class="lizmapPopupContent"><h4>'+lizDict["popup.msg.no.result"]+"</h4></div>";document.querySelector("#popupcontent div.menu-content").innerHTML=a,$("#mapmenu .nav-list > li.popupcontent").hasClass("active")&&$("#button-popupcontent").click(),$("#mapmenu .nav-list > li.popupcontent").hasClass("active")||$("#mapmenu .nav-list > li.popupcontent").hide()}}})}(),"geolocation"in Y&&"True"==Y.geolocation&&$("#geolocation button.btn-geolocation-close").click((function(){return $("#button-geolocation").click(),!1})),"measure"in Y&&"True"==Y.measure?function(){var e=new OpenLayers.Style;e.addRules([new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash",fillColor:"white",fillOpacity:.3}}})]);var t=new OpenLayers.StyleMap({default:e}),a={length:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),area:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),perimeter:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL}),angle:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{id:"angleMeasure",persist:!0,geodesic:!0,immediate:!0,handlerOptions:{maxVertices:3,layerOptions:{styleMap:t}},type:OpenLayers.Control.TYPE_TOOL})};function n(e){var t=e.units,a=e.order,n=e.measure,i="";if("angleMeasure"===e.object.id){if(i=lizDict["measure.handle"]+" 0°",3===e.geometry.components.length){if(void 0===e.object.invert){const t=e.geometry.components[0].clone(),a=e.geometry.components[1].clone();e.geometry.components[0].move(a.x-t.x,a.y-t.y),e.geometry.components[1].move(t.x-a.x,t.y-a.y),e.object.invert=!0}else"measure"===e.type&&(e.object.invert=void 0);const t=e.geometry.components[0],a=e.geometry.components[1],n=e.geometry.components[2],r=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)),o=Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)),l=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));let s=180*Math.acos((o*o+r*r-l*l)/(2*o*r))/Math.PI;isNaN(s)&&(s=0),i=lizDict["measure.handle"]+" "+s.toFixed(2)+"°"}}else i+=1==a?lizDict["measure.handle"]+" "+n.toFixed(3)+" "+t:lizDict["measure.handle"]+" "+n.toFixed(3)+" "+t+"<sup>2</sup>";var r=$("#lizmap-measure-message");0==r.length?(r=O(i)).attr("id","lizmap-measure-message"):r.html("<p>"+i+"</p>")}for(var i in a.length.events.on({activate:function(){O(lizDict["measure.activate.length"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.area.events.on({activate:function(){O(lizDict["measure.activate.area"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.perimeter.events.on({activate:function(){O(lizDict["measure.activate.perimeter"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.angle.events.on({activate:function(){O(lizDict["measure.activate.angle"],"info",!0).attr("id","lizmap-measure-message")},deactivate:function(){$("#lizmap-measure-message").remove()}}),a.perimeter.measure=function(e,t){var a,n;OpenLayers.Util.indexOf(e.CLASS_NAME,"LineString")>-1?(a=this.getBestLength(e),n=1):(a=this.getBestLength(e.components[0]),n=1),this.events.triggerEvent(t,{measure:a[0],units:a[1],order:n,geometry:e})},a){var o=a[i];o.events.on({measure:n,measurepartial:n}),r.addControl(o),s[i+"Measure"]=o}$("#measure-type").change((function(){var e=$(this);e.find("option").each((function(){var e=$(this).attr("value");e in a&&a[e].active&&a[e].deactivate()})),a[e.val()].activate()})),lizMap.events.on({minidockopened:function(e){"measure"==e.id&&(lizMap.mainLizmap.newOlMap=!1,$("#measure-type").change())},minidockclosed:function(e){if("measure"==e.id){lizMap.mainLizmap.newOlMap=!0;var t="";$("#measure-type option").each((function(){var e=$(this).attr("value");e in a&&a[e].active&&(t=e)})),""!=t&&a[t].deactivate()}}}),$("#measure-stop").click((function(){$("#button-measure").click()}))}():($("#measure").parent().remove(),$("#measure-length-menu").remove(),$("#measure-area-menu").remove(),$("#measure-perimeter-menu").remove()),c.events.triggerEvent("toolbarcreated",c),$("#mapmenu ul").on("click","li.nav-minidock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a);if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),lizMap.events.triggerEvent("minidockclosed",{id:a});else{var i=$("#mapmenu li.nav-minidock.active");0!=i.length&&(i.removeClass("active"),lizMap.events.triggerEvent("minidockclosed",{id:i.children("a").first().attr("href").substr(1)})),n.children("a").first().click(),t.addClass("active"),lizMap.events.triggerEvent("minidockopened",{id:a})}return e.blur(),!1})),"locateByLayer"in e?$("#button-locate").click():$("#button-locate").parent().hide(),0==$("#mapmenu ul li.nav-minidock.active").length&&($("#mini-dock-content > .tab-pane.active").removeClass("active"),$("#mini-dock-tabs li.active").removeClass("active")),$("#mapmenu ul").on("click","li.nav-dock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a),i="";if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),i="dockclosed";else{var r=$("#mapmenu li.nav-dock.active");0!=r.length&&(r.removeClass("active"),lizMap.events.triggerEvent("dockclosed",{id:r.children("a").first().attr("href").substr(1)})),n.show(),n.children("a").first().click(),t.addClass("active"),i="dockopened"}e.blur();var o=$("#dock");return 0==$("#dock-tabs .active").length?o.hide():o.is(":visible")||o.show(),""!=i&&lizMap.events.triggerEvent(i,{id:a}),!1})),$("#mapmenu ul").on("click","li.nav-right-dock > a",(function(){var e=$(this),t=e.parent(),a=e.attr("href").substr(1),n=$("#nav-tab-"+a),i="";if(t.hasClass("active"))$("#"+a).removeClass("active"),n.removeClass("active"),t.removeClass("active"),i="rightdockclosed";else{var r=$("#mapmenu li.nav-right-dock.active");0!=r.length&&(r.removeClass("active"),lizMap.events.triggerEvent("rightdockclosed",{id:r.children("a").first().attr("href").substr(1)})),n.show(),n.children("a").first().click(),t.addClass("active"),i="rightdockopened"}e.blur();var o=$("#right-dock");return 0==$("#right-dock-tabs .active").length?(o.hide(),$("#content").removeClass("right-dock-visible"),v()):o.is(":visible")||($("#content").addClass("right-dock-visible"),o.show(),v()),""!=i&&lizMap.events.triggerEvent(i,{id:a}),!1})),$("#menuToggle").click((function(){$(this).toggleClass("opened")})),$("#menuToggle:visible ~ #mapmenu ul").on("click","li > a",(function(){$("#menuToggle").removeClass("opened")})),$("#button-switcher").click(),v(),$('#headermenu .navbar-inner .nav a[rel="tooltip"]').tooltip(),$('#mapmenu .nav a[rel="tooltip"]').tooltip(),c.events.triggerEvent("uicreated",c)})).catch((e=>{console.error(e);let t=`\n          <p class="error-msg">\n          ${lizDict["startup.error"]}<br>\n          `;1==document.body.dataset.lizmapAdminUser?document.body.dataset.lizmapUserDefinedJsCount>0?t+=`${lizDict["startup.user_defined_js"]}<br>\n\n                            <a href="${globalThis.lizUrls.repositoryAdmin}"><button class="btn btn-primary" type="button">${lizDict["startup.goToRepositoryAdmin"]}</button></a>\n                            <a href="`+window.location+`&no_user_defined_js=1"><button class="btn btn-primary" type="button">${lizDict["startup.projectWithoutJSLink"]}</button></a>\n                    `:t+=`${lizDict["startup.error.developer.tools"]}<br>`:t+=`${lizDict["startup.error.administrator"]}<br>`,t+=`<a href="${globalThis.lizUrls.basepath}"><button class="btn btn-primary" type="button">${lizDict["startup.goToProject"]}</button></a>`,t+="</p>",document.getElementById("header").insertAdjacentHTML("afterend",t)})).finally((()=>{$("body").css("cursor","auto"),$("#loading").dialog("close"),w&&L(w,{x:r.size.w/2,y:r.size.h/2})}))}};return I.events=new OpenLayers.Events(I,null,["treecreated","mapcreated","layersadded","uicreated","dockopened","dockclosed"],!0,{includeXY:!0}),I}(),lizMap.events.on({mapcreated:function(e){},uicreated:function(e){lizMap.checkMobile()&&$("#button-switcher").parent().hasClass("active")&&$("#button-switcher").click(),$("#dock-close").click((function(){$("#mapmenu .nav-list > li.active.nav-dock > a").click()})),$("#right-dock-close").click((function(){$("#mapmenu .nav-list > li.active.nav-right-dock > a").click()}))}}),$(document).ready((function(){$("body").css("cursor","wait"),$("#loading").dialog({modal:!0,draggable:!1,resizable:!1,closeOnEscape:!1,dialogClass:"liz-dialog-wait",minHeight:128}).parent().removeClass("ui-corner-all").children(".ui-dialog-titlebar").removeClass("ui-corner-all"),OpenLayers.DOTS_PER_INCH=96,lizMap.init(),$("#loading").css("min-height","128px")}))})();
//# sourceMappingURL=map.js.map