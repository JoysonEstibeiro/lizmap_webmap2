{"version":3,"file":"map.js","mappings":"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","sources":["webpack://lizmap-web-client/./assets/src/modules/Errors.js","webpack://lizmap-web-client/./node_modules/dompurify/dist/purify.es.mjs","webpack://lizmap-web-client/./assets/src/modules/Utils.js","webpack://lizmap-web-client/./assets/src/modules/WFS.js","webpack://lizmap-web-client/./assets/src/modules/WMS.js","webpack://lizmap-web-client/./assets/src/legacy/map.js","webpack://lizmap-web-client/./node_modules/ol/extent.js"],"sourcesContent":["/**\n * @module modules/Errors.js\n * @name Errors\n * @copyright 2023 3Liz\n * @author DHONT René-Luc\n * @license MPL-2.0\n */\n\n/**\n * Representing a network error with message, resource and options fetched\n * @class\n * @augments Error\n */\nclass NetworkError extends Error {\n\n    /**\n     * Creating an HTTP error with message and status code\n     * @param {string} message    - Error message\n     * @param {string} resource   - The resource has been fetched\n     * @param {string} options    - The resource options\n     */\n    constructor(message, resource, options) {\n        super(message);\n        this.name = \"NetworkError\";\n        this.resource = resource;\n        this.options = options;\n    }\n}\n\n/**\n * Representing an HTTP error with message, status code, resource and options fetched\n * @class\n * @augments Error\n */\nclass HttpError extends NetworkError {\n\n    /**\n     * Creating an HTTP error with message and status code\n     * @param {string} message    - Error message\n     * @param {number} statusCode - HTTP Error status code\n     * @param {string} resource   - The resource has been fetched\n     * @param {string} options    - The resource options\n     */\n    constructor(message, statusCode, resource, options) {\n        super(message);\n        this.name = \"HttpError\";\n        this.statusCode = statusCode;\n        this.resource = resource;\n        this.options = options;\n    }\n}\n\n/**\n * Representing an HTTP error with message, response, resource and options fetched\n * @class\n * @augments Error\n */\nclass ResponseError extends NetworkError {\n\n    /**\n     * Creating an HTTP error with message and status code\n     * @param {string}   message    - Error message\n     * @param {Response} response - HTTP Error status code\n     * @param {string}   resource   - The resource has been fetched\n     * @param {string}   options    - The resource options\n     */\n    constructor(message, response, resource, options) {\n        super(message);\n        this.name = \"ResponseError\";\n        this.response = response;\n        this.resource = resource;\n        this.options = options;\n    }\n}\n\n/**\n * Representing a conversion error\n * @class\n * @augments Error\n */\nclass ConversionError extends Error {\n\n    /**\n     * Creating a conversion error\n     * @param {string} message - Error message\n     */\n    constructor(message) {\n        super(message);\n        this.name = \"ConversionError\";\n    }\n\n}\n\n/**\n * Representing a validation error\n * @class\n * @augments Error\n */\nclass ValidationError extends Error {\n\n    /**\n     * Creating a validation error\n     * @param {string} message - Error message\n     */\n    constructor(message) {\n        super(message);\n        this.name = \"ValidationError\";\n    }\n\n}\n\n/**\n * Representing a property required error\n * @class\n * @augments ValidationError\n */\nclass PropertyRequiredError extends ValidationError {\n\n    /**\n     * @param {string} property - The object property in error\n     */\n    constructor(property) {\n        super(\"No property:\" + property);\n        this.property = property;\n    }\n\n}\n\nexport { NetworkError, HttpError, ResponseError, ConversionError, ValidationError, PropertyRequiredError };\n","/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */\n\nconst {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor\n} = Object;\nlet {\n  freeze,\n  seal,\n  create\n} = Object; // eslint-disable-line import/no-mutable-exports\nlet {\n  apply,\n  construct\n} = typeof Reflect !== 'undefined' && Reflect;\nif (!freeze) {\n  freeze = function freeze(x) {\n    return x;\n  };\n}\nif (!seal) {\n  seal = function seal(x) {\n    return x;\n  };\n}\nif (!apply) {\n  apply = function apply(fun, thisValue, args) {\n    return fun.apply(thisValue, args);\n  };\n}\nif (!construct) {\n  construct = function construct(Func, args) {\n    return new Func(...args);\n  };\n}\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySplice = unapply(Array.prototype.splice);\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\nconst regExpTest = unapply(RegExp.prototype.test);\nconst typeErrorCreate = unconstruct(TypeError);\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply(func) {\n  return function (thisArg) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    return apply(func, thisArg, args);\n  };\n}\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct(func) {\n  return function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    return construct(func, args);\n  };\n}\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(set, array) {\n  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          array[l] = lcElement;\n        }\n        element = lcElement;\n      }\n    }\n    set[element] = true;\n  }\n  return set;\n}\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray(array) {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n  return array;\n}\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone(object) {\n  const newObject = create(null);\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (value && typeof value === 'object' && value.constructor === Object) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n  return newObject;\n}\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter(object, prop) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n    object = getPrototypeOf(object);\n  }\n  function fallbackValue() {\n    return null;\n  }\n  return fallbackValue;\n}\n\nconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'section', 'select', 'shadow', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);\nconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\nconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\nconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\nconst text = freeze(['#text']);\n\nconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);\nconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\nconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\nconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n// eslint-disable-next-line unicorn/better-regex\nconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nconst TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nconst DOCTYPE_NAME = seal(/^html$/i);\nconst CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n\nvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  ARIA_ATTR: ARIA_ATTR,\n  ATTR_WHITESPACE: ATTR_WHITESPACE,\n  CUSTOM_ELEMENT: CUSTOM_ELEMENT,\n  DATA_ATTR: DATA_ATTR,\n  DOCTYPE_NAME: DOCTYPE_NAME,\n  ERB_EXPR: ERB_EXPR,\n  IS_ALLOWED_URI: IS_ALLOWED_URI,\n  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n  MUSTACHE_EXPR: MUSTACHE_EXPR,\n  TMPLIT_EXPR: TMPLIT_EXPR\n});\n\n/* eslint-disable @typescript-eslint/indent */\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5,\n  // Deprecated\n  entityNode: 6,\n  // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12 // Deprecated\n};\nconst getGlobal = function getGlobal() {\n  return typeof window === 'undefined' ? null : window;\n};\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n    return null;\n  }\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      }\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n    return null;\n  }\n};\nconst _createHooksMap = function _createHooksMap() {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: []\n  };\n};\nfunction createDOMPurify() {\n  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n  const DOMPurify = root => createDOMPurify(root);\n  DOMPurify.version = '3.2.4';\n  DOMPurify.removed = [];\n  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n    return DOMPurify;\n  }\n  let {\n    document\n  } = window;\n  const originalDocument = document;\n  const currentScript = originalDocument.currentScript;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes\n  } = window;\n  const ElementPrototype = Element.prototype;\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName\n  } = document;\n  const {\n    importNode\n  } = originalDocument;\n  let hooks = _createHooksMap();\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT\n  } = EXPRESSIONS;\n  let {\n    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n  } = EXPRESSIONS;\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {\n    tagNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    allowCustomizedBuiltInElements: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: false\n    }\n  }));\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES = {};\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc = null;\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG = null;\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n  const formElement = document.createElement('form');\n  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function _parseConfig() {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n    PARSER_MEDIA_TYPE =\n    // eslint-disable-next-line unicorn/prefer-includes\n    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : {};\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : {};\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, html$1);\n        addToSet(ALLOWED_ATTR, html);\n      }\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, svg$1);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, svgFilters);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, mathMl$1);\n        addToSet(ALLOWED_ATTR, mathMl);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n    }\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n        ALLOWED_TAGS = clone(ALLOWED_TAGS);\n      }\n      addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n    }\n    if (cfg.ADD_ATTR) {\n      if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n        ALLOWED_ATTR = clone(ALLOWED_ATTR);\n      }\n      addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n    }\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n      }\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n      }\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n      }\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n    CONFIG = cfg;\n  };\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);\n  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function _checkValidNamespace(element) {\n    let parent = getParentNode(element);\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template'\n      };\n    }\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n      }\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n    }\n    // For XHTML and XML documents that support custom namespaces\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return true;\n    }\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function _forceRemove(node) {\n    arrayPush(DOMPurify.removed, {\n      element: node\n    });\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function _removeAttribute(name, element) {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element\n      });\n    }\n    element.removeAttribute(name);\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function _initDocument(dirty) {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n    }\n    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n    const body = doc.body || doc.documentElement;\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n    }\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n    }\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function _createNodeIterator(root) {\n    return createNodeIterator.call(root.ownerDocument || root, root,\n    // eslint-disable-next-line no-bitwise\n    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);\n  };\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function _isClobbered(element) {\n    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');\n  };\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function _isNode(value) {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n  function _executeHooks(hooks, currentNode, data) {\n    arrayForEach(hooks, hook => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function _sanitizeElements(currentNode) {\n    let content = null;\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS\n    });\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\\w]/g, currentNode.innerHTML) && regExpTest(/<[/\\w]/g, currentNode.textContent)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove any kind of possibly harmful comments */\n    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\\w]/g, currentNode.data)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Remove element if anything forbids its presence */\n    if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {\n          return false;\n        }\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {\n          return false;\n        }\n      }\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        content = stringReplace(content, expr, ' ');\n      });\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, {\n          element: currentNode.cloneNode()\n        });\n        currentNode.textContent = content;\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n    return false;\n  };\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n    /* Make sure attribute cannot clobber */\n    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n      return false;\n    }\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n      // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName)) ||\n      // Alternative, second condition checks if it's an `is`-attribute, AND\n      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n      return false;\n    } else ;\n    return true;\n  };\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n    const {\n      attributes\n    } = currentNode;\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined\n    };\n    let l = attributes.length;\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const {\n        name,\n        namespaceURI,\n        value: attrValue\n      } = attr;\n      const lcName = transformCaseFunc(name);\n      let value = name === 'value' ? attrValue : stringTrim(attrValue);\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n      /* Work around a security issue with comments inside attributes */\n      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title)/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n      /* Remove attribute */\n      _removeAttribute(name, currentNode);\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        continue;\n      }\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        continue;\n      }\n      /* Handle attributes that require Trusted Types */\n      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n        if (namespaceURI) ; else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML':\n              {\n                value = trustedTypesPolicy.createHTML(value);\n                break;\n              }\n            case 'TrustedScriptURL':\n              {\n                value = trustedTypesPolicy.createScriptURL(value);\n                break;\n              }\n          }\n        }\n      }\n      /* Handle invalid data-* attribute set by try-catching it */\n      try {\n        if (namespaceURI) {\n          currentNode.setAttributeNS(namespaceURI, name, value);\n        } else {\n          /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n          currentNode.setAttribute(name, value);\n        }\n        if (_isClobbered(currentNode)) {\n          _forceRemove(currentNode);\n        } else {\n          arrayPop(DOMPurify.removed);\n        }\n      } catch (_) {}\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n    while (shadowNode = shadowIterator.nextNode()) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty) {\n    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if (dirty.nodeName) {\n        const tagName = transformCaseFunc(dirty.nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&\n      // eslint-disable-next-line unicorn/prefer-includes\n      dirty.indexOf('<') === -1) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n      }\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n    /* Now start iterating over the created document */\n    while (currentNode = nodeIterator.nextNode()) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n      return returnNode;\n    }\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n    /* Serialize doctype if allowed */\n    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n  };\n  DOMPurify.setConfig = function () {\n    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n  DOMPurify.addHook = function (entryPoint, hookFunction) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n    return arrayPop(hooks[entryPoint]);\n  };\n  DOMPurify.removeHooks = function (entryPoint) {\n    hooks[entryPoint] = [];\n  };\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n  return DOMPurify;\n}\nvar purify = createDOMPurify();\n\nexport { purify as default };\n//# sourceMappingURL=purify.es.mjs.map\n","/**\n * @module modules/Utils.js\n * @name Utils\n * @copyright 2023 3Liz\n * @license MPL-2.0\n */\n\nimport { NetworkError, HttpError, ResponseError } from './Errors.js';\nimport DOMPurify from 'dompurify';\n\n/**\n * The main utils methods\n * @class\n * @name Utils\n */\nexport default class Utils {\n\n    /**\n     * Download a file provided as a string\n     * @static\n     * @param {string} text - file content\n     * @param {string} fileType - file's MIME type\n     * @param {string} fileName - file'name with extension\n     */\n    static downloadFileFromString(text, fileType, fileName) {\n        var blob = new Blob([text], { type: fileType });\n\n        var a = document.createElement('a');\n        a.download = fileName;\n        a.href = URL.createObjectURL(blob);\n        a.dataset.downloadurl = [fileType, a.download, a.href].join(':');\n        a.style.display = \"none\";\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        setTimeout(() => { URL.revokeObjectURL(a.href); }, 1500);\n    }\n\n    /**\n     * Send an ajax POST request to download a file\n     * @static\n     * @param {string} url        - A string or any other object with a stringifier — including a URL object — that provides the URL of the resource to send the request to.\n     * @param {Array} parameters  - Parameters that will be serialize as a Query string\n     * @param {Function} callback - optional callback executed when download ends\n     * @param {Function} errorCallback - optional callback executed when error event occurs\n     */\n    static downloadFile(url, parameters, callback, errorCallback) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', url, true);\n        xhr.responseType = 'arraybuffer';\n        xhr.onload = function () {\n            if (this.status === 200) {\n                var filename = \"\";\n                var disposition = xhr.getResponseHeader('Content-Disposition');\n                if (disposition && disposition.indexOf('filename') !== -1) {\n                    var filenameRegex = /filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/;\n                    var matches = filenameRegex.exec(disposition);\n                    if (matches != null && matches[1]) filename = matches[1].replace(/['\"]/g, '');\n                }\n\n                let type = xhr.getResponseHeader('Content-Type');\n\n                // Firefox >= 98 opens blob in its pdf viewer\n                // This is a hack to force download as in Chrome\n                if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 && type == 'application/pdf') {\n                    type = 'application/octet-stream';\n                }\n                const blob = new File([this.response], filename, { type: type });\n                const downloadUrl = URL.createObjectURL(blob);\n\n                if (filename) {\n                    // use HTML5 a[download] attribute to specify filename\n                    const a = document.createElement('a');\n                    a.href = downloadUrl;\n                    a.download = filename;\n                    a.dispatchEvent(new MouseEvent('click'));\n                } else {\n                    window.open(downloadUrl);\n                }\n\n                setTimeout(() => URL.revokeObjectURL(downloadUrl), 100); // cleanup\n            } else {\n                // Execute callback if any\n                if (typeof errorCallback === 'function') {\n                    errorCallback(new HttpError('HTTP error: ' + this.status, this.status, url, {method:'POST', body:$.param(parameters, true)}));\n                }\n            }\n\n            // Execute callback if any\n            if (typeof callback === 'function') {\n                callback();\n            }\n        };\n        // Add error callback if any\n        if (typeof errorCallback === 'function') {\n            xhr.addEventListener(\"error\", errorCallback);\n        }\n        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n        xhr.send($.param(parameters, true));\n    }\n\n    /**\n     * Fetching a resource from the network, returning a promise that is fulfilled once the response is successful.\n     * @static\n     * @param {string} resource - This defines the resource that you wish to fetch. A string or any other object with a stringifier — including a URL object — that provides the URL of the resource you want to fetch.\n     * @param {object} options  - An object containing any custom settings you want to apply to the request.\n     * @returns {Promise} A Promise that resolves to a successful Response object (status in the range 200 – 299)\n     * @throws {HttpError} In case of not successful response (status not in the range 200 – 299)\n     * @throws {NetworkError} In case of catch exceptions\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Response\n     */\n    static fetch(resource, options) {\n        return fetch(resource, options).then(response => {\n            if (response.ok) {\n                return response;\n            }\n\n            return Promise.reject(new HttpError('HTTP error: ' + response.status, response.status, resource, options));\n        }).catch(error => {\n            if (error instanceof NetworkError) {\n                return Promise.reject(error);\n            }\n            return Promise.reject(new NetworkError(error.message, resource, options));\n        });\n    }\n\n    /**\n     * Fetching a resource from the network, which is JSON or GeoJSON, returning a promise that resolves with the result of parsing the response body text as JSON.\n     * @static\n     * @param {string} resource - This defines the resource that you wish to fetch. A string or any other object with a stringifier — including a URL object — that provides the URL of the resource you want to fetch.\n     * @param {object} options - An object containing any custom settings you want to apply to the request.\n     * @returns {Promise} A Promise that resolves with the result of parsing the response body text as JSON.\n     * @throws {ResponseError} In case of invalid content type (not application/json or application/vnd.geo+json) or Invalid JSON\n     * @throws {HttpError} In case of not successful response (status not in the range 200 – 299)\n     * @throws {NetworkError} In case of catch exceptions\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Response\n     */\n    static fetchJSON(resource, options) {\n        return Utils.fetch(resource, options).then(response => {\n            const contentType = response.headers.get('Content-Type') || '';\n\n            if (contentType.includes('application/json') ||\n                contentType.includes('application/vnd.geo+json')) {\n                return response.json().catch(error => {\n                    return Promise.reject(new ResponseError('Invalid JSON: ' + error.message, response, resource, options));\n                });\n            }\n\n            return Promise.reject(new ResponseError('Invalid content type: ' + contentType, response, resource, options));\n        }).catch(error => {return Promise.reject(error)});\n    }\n\n    /**\n     * Fetching a resource from the network, which is HTML, returning a promise that resolves with a text representation of the response body.\n     * @static\n     * @param {string} resource - This defines the resource that you wish to fetch. A string or any other object with a stringifier — including a URL object — that provides the URL of the resource you want to fetch.\n     * @param {object} options - An object containing any custom settings you want to apply to the request.\n     * @returns {Promise} A Promise that resolves with a text representation of the response body.\n     * @throws {ResponseError} In case of invalid content type (not text/html)\n     * @throws {HttpError} In case of not successful response (status not in the range 200 – 299)\n     * @throws {NetworkError} In case of catch exceptions\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Response\n     */\n    static fetchHTML(resource, options) {\n        return Utils.fetch(resource, options).then(response => {\n            const contentType = response.headers.get('Content-Type') || '';\n\n            if (contentType.includes('text/html')) {\n                return response.text().catch(error => {\n                    return Promise.reject(new ResponseError('HTML error: ' + error.message, response, resource, options));\n                });\n            }\n\n            return Promise.reject(new ResponseError('Invalid content type: ' + contentType, response, resource, options));\n        }).catch(error => {return Promise.reject(error)});\n    }\n\n    /**\n     * Get the corresponding resolution for the scale with meters per unit\n     * @static\n     * @param {number} scale         - The scale\n     * @param {number} metersPerUnit - The meters per unit\n     * @returns {number} The corresponding resolution\n     * @see https://github.com/openlayers/ol2/blob/master/lib/OpenLayers/Util.js#L1101\n     */\n    static getResolutionFromScale(scale, metersPerUnit) {\n        const inchesPerMeter = 1000 / 25.4;\n        const DPI = 96;\n        const resolution = scale / (inchesPerMeter * DPI * metersPerUnit);\n        return resolution;\n    }\n\n    /**\n     * Get the corresponding scale for the resolution with meters per unit\n     * @static\n     * @param {number} resolution    - The scale\n     * @param {number} metersPerUnit - The meters per unit\n     * @returns {number} The corresponding scale\n     * @see getResolutionFromScale\n     */\n    static getScaleFromResolution(resolution, metersPerUnit) {\n        const inchesPerMeter = 1000 / 25.4;\n        const DPI = 96;\n        const scale = resolution * inchesPerMeter * DPI * metersPerUnit;\n        return scale;\n    }\n\n    static sanitizeGFIContent(content) {\n        DOMPurify.addHook('afterSanitizeAttributes', node => {\n            // Sandbox all iframes except those from the same origin\n            if (node.nodeName === 'IFRAME' &&\n                !node.attributes['src'].textContent.startsWith(document.location.origin)) {\n                node.setAttribute('sandbox','allow-scripts allow-forms');\n            }\n        });\n        return DOMPurify.sanitize(content, {\n            ADD_TAGS: ['iframe'],\n            ADD_ATTR: ['target'],\n            CUSTOM_ELEMENT_HANDLING: {\n                tagNameCheck: /^lizmap-/,\n                attributeNameCheck: /crs|bbox|edition-restricted|layerid|layertitle|uniquefield|expressionfilter|withgeometry|sortingfield|sortingorder|draggable/,\n            }\n        });\n    }\n}\n","/**\n * @module modules/WFS.js\n * @name WFS\n * @copyright 2023 3Liz\n * @license MPL-2.0\n */\n\nimport Utils from './Utils.js';\n\n/**\n * @class\n * @name WFS\n */\nexport default class WFS {\n\n    constructor() {\n        this._defaultGetFeatureParameters = {\n            repository: globalThis['lizUrls'].params.repository,\n            project: globalThis['lizUrls'].params.project,\n            SERVICE: 'WFS',\n            REQUEST: 'GetFeature',\n            VERSION: '1.0.0',\n            OUTPUTFORMAT: 'GeoJSON'\n        };\n\n        this._defaultDescribeFeatureTypeParameters = {\n            repository: globalThis['lizUrls'].params.repository,\n            project: globalThis['lizUrls'].params.project,\n            SERVICE: 'WFS',\n            REQUEST: 'DescribeFeatureType',\n            VERSION: '1.0.0',\n            OUTPUTFORMAT: 'JSON'\n        };\n    }\n\n    /**\n     * @param {object} options - optional parameters which can override this._defaultParameters\n     * @returns {Promise} Promise object represents data\n     * @memberof WFS\n     */\n    async getFeature(options) {\n        return Utils.fetchJSON(globalThis['lizUrls'].wms, {\n            method: \"POST\",\n            body: new URLSearchParams({\n                ...this._defaultGetFeatureParameters,\n                ...options\n            })\n        });\n    }\n\n    /**\n     * @param {object} options - optional parameters which can override this._defaultParameters\n     * @returns {Promise} Promise object represents data\n     * @memberof WFS\n     */\n    async describeFeatureType(options) {\n        return Utils.fetchJSON(globalThis['lizUrls'].wms, {\n            method: \"POST\",\n            body: new URLSearchParams({\n                ...this._defaultDescribeFeatureTypeParameters,\n                ...options\n            })\n        });\n    }\n}\n","/**\n * @module modules/WMS.js\n * @name WMS\n * @copyright 2023 3Liz\n * @license MPL-2.0\n */\n\nimport Utils from './Utils.js';\n\n/**\n * @class\n * @name WMS\n */\nexport default class WMS {\n\n    constructor() {\n        this._defaultGetFeatureInfoParameters = {\n            repository: globalThis['lizUrls'].params.repository,\n            project: globalThis['lizUrls'].params.project,\n            SERVICE: 'WMS',\n            REQUEST: 'GetFeatureInfo',\n            VERSION: '1.3.0',\n            CRS: 'EPSG:4326',\n            INFO_FORMAT: 'text/html'\n        };\n\n        this._defaultGetLegendGraphicParameters = {\n            repository: globalThis['lizUrls'].params.repository,\n            project: globalThis['lizUrls'].params.project,\n            SERVICE: 'WMS',\n            REQUEST: 'GetLegendGraphic',\n            VERSION: '1.3.0',\n            FORMAT: 'application/json',\n        };\n    }\n\n    /**\n     * @param {object} options - optional parameters which can override this._defaultGetFeatureInfoParameters\n     * @returns {Promise} Promise object represents data\n     * @memberof WMS\n     */\n    async getFeatureInfo(options) {\n        return Utils.fetchHTML(globalThis['lizUrls'].wms, {\n            method: \"POST\",\n            body: new URLSearchParams({\n                ...this._defaultGetFeatureInfoParameters,\n                ...options\n            })\n        });\n    }\n\n    /**\n     * @param {object} options - optional parameters which can override this._defaultGetLegendGraphicsParameters\n     * @returns {Promise} Promise object represents data\n     * @memberof WMS\n     */\n    async getLegendGraphic(options) {\n        return Utils.fetchJSON(globalThis['lizUrls'].wms, {\n            method: \"POST\",\n            body: new URLSearchParams({\n                ...this._defaultGetLegendGraphicParameters,\n                ...options\n            })\n        });\n    }\n}\n","/**\n * Class: lizMap\n * @package\n * @subpackage view\n * @author    3liz\n * @copyright 2011 3liz\n * @link      http://3liz.com\n * @license MPL-2.0\n */\n\nimport { extend } from 'ol/extent.js';\n\nimport WFS from '../modules/WFS.js';\nimport WMS from '../modules/WMS.js';\nimport Utils from '../modules/Utils.js';\nimport DOMPurify from 'dompurify';\n\nwindow.lizMap = function() {\n    /**\n     * PRIVATE Property: config\n     * {object} The map config\n     */\n    var config = null;\n    /**\n     * PRIVATE Property: keyValueConfig\n     * {object} Config to replace keys by values\n     */\n    var keyValueConfig = null;\n    /**\n     * PRIVATE Property: capabilities\n     * {object} The wms capabilities\n     */\n    var capabilities = null;\n    /**\n     * PRIVATE Property: wmtsCapabilities\n     * {object} The wmts capabilities\n     */\n    var wmtsCapabilities = null;\n    /**\n     * PRIVATE Property: wfsCapabilities\n     * {object} The wfs capabilities\n     */\n    var wfsCapabilities = null;\n    /**\n     * PRIVATE Property: map\n     * {<OpenLayers.Map>} The map\n     */\n    var map = null;\n    /**\n     * PRIVATE Property: baselayers\n     * {Array(<OpenLayers.Layer>)} Ordered list of base layers\n     */\n    var baselayers = [];\n    /**\n     * PRIVATE Property: layers\n     * {Array(<OpenLayers.Layer>)} Ordered list of layers\n     */\n    var layers = [];\n    /**\n     * PRIVATE Property: controls\n     * {Object({key:<OpenLayers.Control>})} Dictionary of controls\n     */\n    var controls = {};\n\n    /**\n     * PRIVATE Property: getFeatureInfoVendorParams\n     * {object} Additional QGIS Server parameter for click tolerance in pixels\n     */\n    var defaultGetFeatureInfoTolerances = {\n        'FI_POINT_TOLERANCE': 25,\n        'FI_LINE_TOLERANCE': 10,\n        'FI_POLYGON_TOLERANCE': 5\n    };\n\n    /**\n     * PRIVATE Property: externalBaselayersReplacement\n     *\n     */\n    var externalBaselayersReplacement = {\n        'osm': 'osm-mapnik',\n        'osm-toner': 'osm-stamen-toner',\n        'opentopomap': 'open-topo-map',\n        'osm-cycle': 'osm-cyclemap',\n        'gsat': 'google-satellite',\n        'ghyb': 'google-hybrid',\n        'gphy': 'google-terrain',\n        'gmap': 'google-street',\n        'bmap': 'bing-road',\n        'baerial': 'bing-aerial',\n        'bhybrid': 'bing-hybrid',\n        'ignmap': 'ign-scan',\n        'ignplan': 'ign-plan',\n        'ignphoto': 'ign-photo',\n        'igncadastral': 'ign-cadastral'\n    };\n\n    /**\n     * PRIVATE Property: cleanNameMap\n     *\n     */\n    var cleanNameMap = {\n    };\n\n    /**\n     * PRIVATE Property: layerIdMap\n     *\n     */\n    var layerIdMap = {\n    };\n    /**\n     * PRIVATE Property: shortNameMap\n     *\n     */\n    var shortNameMap = {\n    };\n    /**\n     * PRIVATE Property: typeNameMap\n     *\n     */\n    var typeNameMap = {\n    };\n\n    /**\n     * PRIVATE Property: layerCleanNames\n     *\n     */\n    var layerCleanNames = {};\n\n    /**\n     * PRIVATE Property: lizmapLayerFilterActive. Contains layer name if filter is active\n     *\n     */\n    var lizmapLayerFilterActive = null;\n\n    /**\n     * PRIVATE Property: editionPending. True when an edition form has already been displayed. Used to prevent double-click on launchEdition button\n     *\n     */\n    var editionPending = false;\n\n    var lastLonLatInfo = null;\n\n    /**\n     * Get the metadata written in the configuration file by the desktop Lizmap plugin.\n     *\n     * This method should be used EVERY TIME we need to add \"if\" conditions\n     * to adapt the code for configuration parameters changes across versions.\n     * This will ease in the future the review of the code to remove all the \"if\"\n     * conditions: we will just need to search for \"getLizmapDesktopPluginMetadata\"\n     * and not: \"if 'someproperty' in someconfig\".\n     *\n     * For very old configuration files, which have not the needed metadata, we\n     * return fake versions for each property.\n     *\n     * Dependencies:\n     * config\n     */\n    function getLizmapDesktopPluginMetadata()\n    {\n    // Default fake versions if the properties does not yet exist in configuration file\n    // lizmap/modules/lizmap/lib/Project/Project.php\n        var plugin_metadata = {\n            lizmap_plugin_version_str: \"3.1.8\",\n            lizmap_plugin_version: 30108,\n            lizmap_web_client_target_version: 30200,\n            qgis_desktop_version: 30000\n        };\n\n        if (!('metadata' in config)) {\n            return plugin_metadata;\n        }\n        if ('lizmap_plugin_version' in config['metadata']) {\n            plugin_metadata['lizmap_plugin_version'] = config['metadata']['lizmap_plugin_version'];\n        }\n        if ('lizmap_web_client_target_version' in config['metadata']) {\n            plugin_metadata['lizmap_web_client_target_version'] = config['metadata']['lizmap_web_client_target_version'];\n        }\n        if ('qgis_desktop_version' in config['metadata']) {\n            plugin_metadata['qgis_desktop_version'] = config['metadata']['qgis_desktop_version'];\n        }\n\n        return plugin_metadata;\n\n    }\n\n    /**\n     *\n     * @param aName\n     */\n    function performCleanName(aName) {\n        var accentMap = {\n            \"à\": \"a\",    \"á\": \"a\",    \"â\": \"a\",    \"ã\": \"a\",    \"ä\": \"a\",    \"ç\": \"c\",    \"è\": \"e\",    \"é\": \"e\",    \"ê\": \"e\",    \"ë\": \"e\",    \"ì\": \"i\",    \"í\": \"i\",    \"î\": \"i\",    \"ï\": \"i\",    \"ñ\": \"n\",    \"ò\": \"o\",    \"ó\": \"o\",    \"ô\": \"o\",    \"õ\": \"o\",    \"ö\": \"o\",    \"ù\": \"u\",    \"ú\": \"u\",    \"û\": \"u\",    \"ü\": \"u\",    \"ý\": \"y\",    \"ÿ\": \"y\",\n            \"À\": \"A\",    \"Á\": \"A\",    \"Â\": \"A\",    \"Ã\": \"A\",    \"Ä\": \"A\",    \"Ç\": \"C\",    \"È\": \"E\",    \"É\": \"E\",    \"Ê\": \"E\",    \"Ë\": \"E\",    \"Ì\": \"I\",    \"Í\": \"I\",    \"Î\": \"I\",    \"Ï\": \"I\",    \"Ñ\": \"N\",    \"Ò\": \"O\",    \"Ó\": \"O\",    \"Ô\": \"O\",    \"Õ\": \"O\",    \"Ö\": \"O\",    \"Ù\": \"U\",    \"Ú\": \"U\",    \"Û\": \"U\",    \"Ü\": \"U\",    \"Ý\": \"Y\",\n            \"-\":\" \", \"'\": \" \", \"(\": \" \", \")\": \" \"};\n        var normalize = function( term ) {\n            var ret = \"\";\n            for ( var i = 0; i < term.length; i++ ) {\n                ret += accentMap[ term.charAt(i) ] || term.charAt(i);\n            }\n            return ret;\n        };\n        var theCleanName = normalize(aName);\n        var reg = new RegExp('\\\\W', 'g');\n        return theCleanName.replace(reg, '_');\n    }\n\n    /**\n     * PRIVATE function: cleanName\n     * cleaning layerName for class and layer\n     * @param aName\n     */\n    function cleanName(aName){\n        if ( aName in cleanNameMap )\n            return aName;\n\n        if ( aName == undefined ) {\n            console.log( \"An undefined name has been clean\" );\n            return '';\n        }\n\n        var theCleanName = performCleanName( aName );\n        if ( (theCleanName in cleanNameMap) && cleanNameMap[theCleanName] != aName ){\n            var i = 1;\n            var nCleanName = theCleanName+i;\n            while( (nCleanName in cleanNameMap) && cleanNameMap[nCleanName] != aName ){\n                i += 1;\n                nCleanName = theCleanName+i;\n            }\n            theCleanName = nCleanName;\n        }\n        cleanNameMap[theCleanName] = aName;\n        return theCleanName;\n    }\n\n    /**\n     *\n     * @param cleanName\n     */\n    function getNameByCleanName( cleanName ){\n        var name = null;\n        if( cleanName in cleanNameMap )\n            name = cleanNameMap[cleanName];\n        return name;\n    }\n\n    /**\n     *\n     * @param shortName\n     */\n    function getNameByShortName( shortName ){\n        var name = null;\n        if( shortName in shortNameMap )\n            name = shortNameMap[shortName];\n        return name;\n    }\n\n    /**\n     *\n     * @param typeName\n     */\n    function getNameByTypeName( typeName ){\n        var name = null;\n        if( typeName in typeNameMap )\n            name = typeNameMap[typeName];\n        return name;\n    }\n\n    /**\n     *\n     * @param cleanName\n     */\n    function getLayerNameByCleanName( cleanName ){\n        var layerName = null;\n        if( cleanName in layerCleanNames )\n            layerName = layerCleanNames[cleanName];\n        if ( layerName == null && cleanName in cleanNameMap ) {\n            layerName = cleanNameMap[cleanName];\n            layerCleanNames[cleanName] = layerName;\n        }\n        return layerName;\n    }\n\n\n    /**\n     * PRIVATE function: updateMobile\n     * Determine if we should display the mobile version.\n     */\n    function updateMobile(){\n        var isMobile = mCheckMobile();\n        var contentIsMobile = $('#content').hasClass('mobile');\n        if (isMobile == contentIsMobile)\n            return;\n\n        if (isMobile) {\n            // Add mobile class to content\n            $('#content, #headermenu').addClass('mobile');\n\n            // Hide switcher\n            if( $('#button-switcher').parent().hasClass('active') )\n                $('#button-switcher').click();\n\n            if( $('#menu').is(':visible'))\n                $('#menu').hide();\n\n            $('#map-content').append($('#toolbar'));\n\n            $('#toggleLegend')\n                .attr('data-original-title',$('#toggleLegendOn').attr('value'))\n                .parent().attr('class','legend');\n\n            // autocompletion items for locatebylayer feature\n            $('div.locate-layer select').show();\n            $('span.custom-combobox').hide();\n        }\n        else\n        {\n            // Remove mobile class to content\n            $('#content, #headermenu').removeClass('mobile');\n\n            // Show switcher\n            if( !( $('#button-switcher').parent().hasClass('active') ) )\n                $('#button-switcher').click();\n\n            if( !$('#menu').is(':visible'))\n                $('#content span.ui-icon-open-menu').click();\n            else\n                $('#map-content').show();\n\n            $('#toolbar').insertBefore($('#switcher-menu'));\n\n            $('#toggleLegend')\n                .attr('data-original-title',$('#toggleMapOnlyOn').attr('value'))\n                .parent().attr('class','map');\n\n            // autocompletion items for locatebylayer feature\n            $('div.locate-layer select').hide();\n            $('span.custom-combobox').show();\n        }\n    }\n\n    /**\n     * PRIVATE function: updateContentSize\n     * update the content size\n     */\n    function updateContentSize(){\n\n        if (document.querySelector('body').classList.contains('print_popup')) {\n            return;\n        }\n\n        updateMobile();\n\n        // calculate height height\n        var h = $(window).innerHeight();\n        h = h - $('#header').height();\n        $('#map').height(h);\n\n        // Update body padding top by summing up header+headermenu\n        $('body').css('padding-top', $('#header').outerHeight() );\n\n        // calculate map width depending on theme configuration\n        // (fullscreen map or not, mobile or not)\n        var w = $('body').parent()[0].offsetWidth;\n        w -= parseInt($('#map-content').css('margin-left'));\n        w -= parseInt($('#map-content').css('margin-right'));\n        if ($('#menu').is(':hidden') || $('#map-content').hasClass('fullscreen')) {\n            $('#map-content').css('margin-left','auto');\n        } else {\n            w -= $('#menu').width();\n            $('#map-content').css('margin-left', $('#menu').width());\n        }\n        $('#map').width(w);\n\n        if ( $('#right-dock-tabs').is(':visible') ){\n            $('#right-dock-content').css( 'max-height', $('#right-dock').height() - $('#right-dock-tabs').height() );\n        }\n    }\n\n    /**\n     * PRIVATE function: getLayerScale\n     * get the layer scales based on children layer\n     *\n     * Parameters:\n     * nested - {Object} a capability layer\n     * minScale - {Float} the nested min scale\n     * maxScale - {Float} the nested max scale\n     *\n     * Dependencies:\n     * config\n     *\n     * Returns:\n     * {Object} the min and max scales\n     * @param nested\n     * @param minScale\n     * @param maxScale\n     */\n    function getLayerScale(nested,minScale,maxScale) {\n        for (var i = 0, len = nested.nestedLayers.length; i<len; i++) {\n            var layer = nested.nestedLayers[i];\n            var qgisLayerName = layer.name;\n            if ( 'useLayerIDs' in config.options && config.options.useLayerIDs == 'True' )\n                qgisLayerName = layerIdMap[layer.name];\n            else if ( layer.name in shortNameMap )\n                qgisLayerName = shortNameMap[layer.name];\n            var layerConfig = config.layers[qgisLayerName];\n            if (layer.nestedLayers.length != 0)\n                return getLayerScale(layer,minScale,maxScale);\n            if (layerConfig) {\n                if (minScale == null)\n                    minScale=layerConfig.minScale;\n                else if (layerConfig.minScale<minScale)\n                    minScale=layerConfig.minScale;\n                if (maxScale == null)\n                    maxScale=layerConfig.maxScale;\n                else if (layerConfig.maxScale>maxScale)\n                    maxScale=layerConfig.maxScale;\n            }\n        }\n        if ( minScale < 1 )\n            minScale = 1;\n        return {minScale:minScale,maxScale:maxScale};\n    }\n\n    /**\n     * PRIVATE function: getLayerOrder\n     * get the layer order and calculate it if it's a QGIS group\n     *\n     * Parameters:\n     * nested - {Object} a capability layer\n     *\n     * Dependencies:\n     * config\n     *\n     * Returns:\n     * {int} the layer's order\n     * @param nested\n     */\n    function getLayerOrder(nested) {\n    // there is no layersOrder in the project\n        if (!('layersOrder' in config))\n            return -1;\n\n        // the nested is a layer and not a group\n        if (nested.nestedLayers.length == 0) {\n            var qgisLayerName = nested.name;\n            if ( 'useLayerIDs' in config.options && config.options.useLayerIDs == 'True' )\n                qgisLayerName = layerIdMap[nested.name];\n            else if ( nested.name in shortNameMap )\n                qgisLayerName = shortNameMap[nested.name];\n            if (qgisLayerName in config.layersOrder)\n                return config.layersOrder[nested.name];\n            else\n                return -1;\n        }\n\n        // the nested is a group\n        var order = -1;\n        for (var i = 0, len = nested.nestedLayers.length; i<len; i++) {\n            var layer = nested.nestedLayers[i];\n            var qgisLayerName = layer.name;\n            if ( 'useLayerIDs' in config.options && config.options.useLayerIDs == 'True' )\n                qgisLayerName = layerIdMap[layer.name];\n            else if ( layer.name in shortNameMap )\n                qgisLayerName = shortNameMap[layer.name];\n            var lOrder = -1;\n            if (layer.nestedLayers.length != 0)\n                lOrder = getLayerScale(layer);\n            else if (qgisLayerName in config.layersOrder)\n                lOrder = config.layersOrder[qgisLayerName];\n            else\n                lOrder = -1;\n            if (lOrder != -1) {\n                if (order == -1 || lOrder < order)\n                    order = lOrder;\n            }\n        }\n        return order;\n    }\n\n    /**\n     *\n     */\n    function buildNativeScales() {\n        if (('EPSG:900913' in Proj4js.defs)\n            && !('EPSG:3857' in Proj4js.defs)) {\n            Proj4js.defs['EPSG:3857'] = Proj4js.defs['EPSG:900913'];\n        }\n\n        // Check config projection\n        var proj = config.options.projection;\n        if (proj.ref) {\n            if ( !(proj.ref in Proj4js.defs) ) {\n                Proj4js.defs[proj.ref]=proj.proj4;\n            }\n            // Build proj\n            new OpenLayers.Projection(proj.ref);\n        } else {\n            proj.ref = 'EPSG:3857';\n            proj.proj4 = Proj4js.defs['EPSG:3857'];\n        }\n\n        // Force projection if config contains old external baselayers\n        // To be removed when baselayers only in the tree\n        if ('osmMapnik' in config.options\n            || 'osmStamenToner' in config.options\n            || 'openTopoMap' in config.options\n            || 'osmCyclemap' in config.options\n            || 'googleStreets' in config.options\n            || 'googleSatellite' in config.options\n            || 'googleHybrid' in config.options\n            || 'googleTerrain' in config.options\n            || 'bingStreets' in config.options\n            || 'bingSatellite' in config.options\n            || 'bingHybrid' in config.options\n            || 'ignTerrain' in config.options\n            || 'ignStreets' in config.options\n            || 'ignSatellite' in config.options\n            || 'ignCadastral' in config.options) {\n            // get projection\n            var projection = new OpenLayers.Projection(proj.ref);\n\n            // get and define the max extent\n            var bbox = config.options.bbox;\n            var initialBbox = config.options.initialExtent;\n            var extent = new OpenLayers.Bounds(Number(bbox[0]),Number(bbox[1]),Number(bbox[2]),Number(bbox[3]));\n            var initialExtent = new OpenLayers.Bounds(Number(initialBbox[0]),Number(initialBbox[1]),Number(initialBbox[2]),Number(initialBbox[3]));\n            extent.transform(projection, 'EPSG:3857');\n            initialExtent.transform(projection, 'EPSG:3857');\n            config.options.bbox = extent.toArray();\n            config.options.initialExtent = initialExtent.toArray();\n            proj.ref = 'EPSG:3857';\n            proj.proj4 = Proj4js.defs['EPSG:3857'];\n        }\n\n        var scales = [];\n        if ('mapScales' in config.options){\n            scales = Array.from(config.options.mapScales);\n        }\n\n        if (scales.length < 2){\n            scales = [config.options.maxScale,config.options.minScale];\n        }\n        scales.sort(function(a, b) {\n            return Number(b) - Number(a);\n        });\n\n        var useNativeZoomLevels = false;\n        if (!('use_native_zoom_levels' in config.options)) {\n            if (proj.ref == 'EPSG:3857') {\n                useNativeZoomLevels = true;\n            }\n            if (scales.length == 2) {\n                useNativeZoomLevels = true;\n            }\n        } else {\n            useNativeZoomLevels = config.options['use_native_zoom_levels'];\n        }\n\n        // Nothing to change\n        if (!useNativeZoomLevels) {\n            return;\n        }\n\n        if (proj.ref == 'EPSG:3857') {\n            var projOSM = new OpenLayers.Projection('EPSG:3857');\n            var resolutions = [];\n            config.options.zoomLevelNumber = 24;\n            var maxScale = scales[0];\n            var maxRes = OpenLayers.Util.getResolutionFromScale(maxScale, projOSM.proj.units);\n            var minScale = scales[scales.length-1];\n            var minRes = OpenLayers.Util.getResolutionFromScale(minScale, projOSM.proj.units);\n            var res = 156543.03390625;\n            var n = 1;\n            while ( res > minRes && n < config.options.zoomLevelNumber) {\n                if ( res < maxRes ) {\n                    //Add extra scale\n                    resolutions.push(res);\n                }\n                res = res/2;\n                n++;\n            }\n            maxRes = resolutions[0];\n            minRes = resolutions[resolutions.length-1];\n            //Add extra scale\n            var maxScale = OpenLayers.Util.getScaleFromResolution(maxRes, projOSM.proj.units);\n            var minScale = OpenLayers.Util.getScaleFromResolution(minRes, projOSM.proj.units);\n            config.options['resolutions'] = resolutions;\n\n            if (resolutions.length != 0 ) {\n                config.options.zoomLevelNumber = resolutions.length;\n                config.options.maxScale = maxScale;\n                config.options.minScale = minScale;\n            }\n        } else if (scales.length == 2) {\n            var nativeScales = [];\n            var maxScale = scales[0];\n            var minScale = scales[scales.length-1];\n            let n=1;\n            while (10*Math.pow(10,n)-1 < maxScale) {\n                nativeScales = nativeScales.concat([10, 25, 50].map((x) => Math.pow(10,n)*x));\n                n++;\n            }\n            let mapScales = [];\n            for (const scale of nativeScales) {\n                if (scale < minScale) {\n                    continue;\n                }\n                if (scale > maxScale) {\n                    break;\n                }\n                mapScales.push(scale);\n            }\n            mapScales.sort(function(a, b) {\n                return Number(b) - Number(a);\n            });\n            config.options.mapScales = mapScales;\n            config.options.maxScale = scales[0];\n            config.options.minScale = scales[scales.length-1];\n        }\n    }\n\n    /**\n     *\n     * @param firstLayer\n     */\n    function initProjections(firstLayer) {\n        // Set Proj4js.libPath\n        const proj4jsLibPath = document.body.dataset?.proj4jsLibPath;\n        if (proj4jsLibPath) {\n            Proj4js.libPath = proj4jsLibPath;\n        }\n\n        // Insert or update projection list\n        if ( globalThis['lizProj4'] ) {\n            for( var ref in globalThis['lizProj4'] ) {\n                if ( !(ref in Proj4js.defs) ) {\n                    Proj4js.defs[ref]=globalThis['lizProj4'][ref];\n                }\n            }\n        }\n\n        // get and define projection\n        var proj = config.options.projection;\n        if ( !(proj.ref in Proj4js.defs) )\n            Proj4js.defs[proj.ref]=proj.proj4;\n        var projection = new OpenLayers.Projection(proj.ref);\n\n        if ( !(proj.ref in OpenLayers.Projection.defaults) ) {\n            OpenLayers.Projection.defaults[proj.ref] = projection;\n\n            // test extent for inverted axis\n            if ( proj.ref in firstLayer.bbox ) {\n                var wmsBbox = firstLayer.bbox[proj.ref].bbox;\n                var wmsBounds = OpenLayers.Bounds.fromArray( wmsBbox );\n                var initBounds = OpenLayers.Bounds.fromArray( config.options.initialExtent );\n                if ( !initBounds.intersectsBounds( wmsBounds ) )\n                    OpenLayers.Projection.defaults[proj.ref].yx = true;\n            }\n        }\n    }\n\n    /**\n     * PRIVATE function: createMap\n     * creating the map {<OpenLayers.Map>}\n     * @param {Array} initialExtent initial extent in EPSG:4326 projection\n     */\n    function createMap(initialExtent) {\n    // get projection\n        var proj = config.options.projection;\n        var projection = new OpenLayers.Projection(proj.ref);\n        var proj4326 = new OpenLayers.Projection('EPSG:4326');\n        var initialExtentProj = proj4326;\n        var zoomToClosest = false;\n\n        // get and define the max extent\n        var bbox = config.options.bbox;\n        var extent = new OpenLayers.Bounds(Number(bbox[0]),Number(bbox[1]),Number(bbox[2]),Number(bbox[3]));\n\n        var restrictedExtent = extent.scale(3);\n\n        const urlParameters = (new URL(document.location)).searchParams;\n        if (urlParameters.has('bbox')) {\n            let initialExtentParam = urlParameters.get('bbox').split(',');\n            if (initialExtentParam.length === 4) {\n                initialExtent = initialExtentParam;\n            }\n            if (urlParameters.has('crs')) {\n                initialExtentProj = new OpenLayers.Projection(urlParameters.get('crs'));\n            }\n            zoomToClosest = true;\n        }\n\n        let initialExtentPermalink = window.location.hash.substring(1).split('|')[0].split(',');\n        if (initialExtentPermalink.length === 4) {\n            initialExtent = initialExtentPermalink;\n            initialExtentProj = proj4326;\n            zoomToClosest = true;\n        }\n\n        if(initialExtent){\n            initialExtent = new OpenLayers.Bounds(initialExtent);\n            initialExtent.transform(initialExtentProj, projection);\n        } else {\n            initialExtent = extent.clone();\n            if ( 'initialExtent' in config.options && config.options.initialExtent.length == 4 ) {\n                var initBbox = config.options.initialExtent;\n                initialExtent = new OpenLayers.Bounds(Number(initBbox[0]),Number(initBbox[1]),Number(initBbox[2]),Number(initBbox[3]));\n            }\n        }\n\n        // calculate the map height\n        var mapHeight = $('body').parent()[0].clientHeight;\n        if(!mapHeight)\n            mapHeight = $('window').innerHeight();\n        mapHeight = mapHeight - $('#header').height();\n        mapHeight = mapHeight - $('#headermenu').height();\n        $('#map').height(mapHeight);\n\n        // Make sure interface divs size are updated before creating the map\n        // This avoid the request of each singlettile layer 2 times on startup\n        updateContentSize();\n\n        var scales = [];\n        var resolutions = [];\n        if ('resolutions' in config.options){\n            resolutions = Array.from(config.options.resolutions);\n        }\n        else if ('mapScales' in config.options){\n            scales = Array.from(config.options.mapScales);\n        }\n\n        scales.sort(function(a, b) {\n            return Number(b) - Number(a);\n        });\n        // remove duplicate scales\n        var nScales = [];\n        while (scales.length != 0){\n            var scale = scales.pop(0);\n            if ($.inArray( scale, nScales ) == -1 )\n                nScales.push( scale );\n        }\n        scales = nScales;\n\n\n        // creating the map\n        OpenLayers.Util.IMAGE_RELOAD_ATTEMPTS = 3; // Avoid some issues with tiles not displayed\n        OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;\n        OpenLayers.Util.DEFAULT_PRECISION=20; // default is 14 : change needed to avoid rounding problem with cache\n\n        map = new OpenLayers.Map('map'\n            ,{\n                controls:[\n                    new OpenLayers.Control.Navigation({mouseWheelOptions: {interval: 100}})\n                ]\n                ,tileManager: null // prevent bug with OL 2.13 : white tiles on panning back\n                ,maxExtent:extent\n                ,restrictedExtent: restrictedExtent\n                ,initialExtent:initialExtent\n                ,zoomToClosest: zoomToClosest\n                ,maxScale: scales.length == 0 ? config.options.minScale : \"auto\"\n                ,minScale: scales.length == 0 ? config.options.maxScale : \"auto\"\n                ,numZoomLevels: scales.length == 0 ? config.options.zoomLevelNumber : scales.length\n                ,scales: scales.length == 0 ? null : scales\n                ,resolutions: resolutions.length == 0 ? null : resolutions\n                ,projection:projection\n                ,units:projection.proj.units !== null ? projection.proj.units : \"degrees\"\n                ,allOverlays:(baselayers.length == 0)\n                ,autoUpdateSize: false\n            });\n\n        // add handler to update the map size\n        window.addEventListener('resize', updateContentSize);\n    }\n\n    /**\n     * Get features for locate by layer tool\n     * @param aName\n     */\n    function updateLocateFeatureList(aName) {\n        var locate = config.locateByLayer[aName];\n        // clone features reference\n        var features = {};\n        for ( var fid in locate.features ) {\n            features[fid] = locate.features[fid];\n        }\n        // filter by filter field name\n        if ('filterFieldName' in locate) {\n            var filterValue = $('#locate-layer-'+cleanName(aName)+'-'+locate.filterFieldName).val();\n            if ( filterValue != '-1' ) {\n                for (var fid in features) {\n                    var feat = features[fid];\n                    if (feat.properties[locate.filterFieldName] != filterValue)\n                        delete features[fid];\n                }\n            } else\n                features = {}\n        }\n        // filter by vector joins\n        if ( 'vectorjoins' in locate && locate.vectorjoins.length != 0 ) {\n            var vectorjoins = locate.vectorjoins;\n            for ( var i=0, len =vectorjoins.length; i< len; i++) {\n                var vectorjoin = vectorjoins[i];\n                var jName = vectorjoin.joinLayer;\n                if ( jName in config.locateByLayer ) {\n                    var jLocate = config.locateByLayer[jName];\n                    var jVal = $('#locate-layer-'+cleanName(jName)).val();\n                    if ( jVal == '-1' ) continue;\n                    var jFeat = jLocate.features[jVal];\n                    for (var fid in features) {\n                        var feat = features[fid];\n                        if ( feat.properties[vectorjoin.targetFieldName] != jFeat.properties[vectorjoin.joinFieldName] )\n                            delete features[fid];\n                    }\n                }\n            }\n        }\n        // create the option list\n        const placeHolder = config.layers[aName].title;\n        var options = '<option value=\"-1\" label=\"'+placeHolder+'\"></option>';\n        for (var fid in features) {\n            var feat = features[fid];\n            options += '<option value=\"' + feat.id + '\">' + DOMPurify.sanitize(feat.properties[locate.fieldName]) + '</option>';\n        }\n        // add option list\n        $('#locate-layer-'+cleanName(aName)).html(options);\n    }\n\n    /**\n     *\n     * @param layer_name\n     */\n    function clearDrawLayer(layer_name) {\n        var layer = map.getLayersByName(layer_name);\n        if (layer.length == 0) {\n            return;\n        }\n        layer[0].destroyFeatures();\n    }\n\n    /**\n     * Zoom to locate feature\n     * @param aName\n     */\n    function zoomToLocateFeature(aName) {\n        // clear highlight layer\n        lizMap.mainLizmap.map.clearHighlightFeatures();\n\n        // get locate by layer val\n        var locate = config.locateByLayer[aName];\n        var layerName = cleanName(aName);\n        var proj = new OpenLayers.Projection(locate.crs);\n        var val = $('#locate-layer-'+layerName).val();\n        if (val == '-1') {\n\n            // Trigger event\n            lizMap.events.triggerEvent('lizmaplocatefeaturecanceled',\n                {\n                    'featureType': aName\n                }\n            );\n        } else {\n            // zoom to val\n            var feat = locate.features[val];\n            var format = new OpenLayers.Format.GeoJSON({\n                ignoreExtraDims: true\n            });\n            feat = format.read(feat)[0];\n\n            if( feat.geometry != null){\n                feat.geometry.transform(proj, map.getProjection());\n                // Show geometry if asked\n                if (locate.displayGeom == 'True') {\n                    var getFeatureUrlData = getVectorLayerWfsUrl( aName, null, null, null );\n                    getFeatureUrlData['options']['PROPERTYNAME'] = ['geometry',locate.fieldName].join(',');\n                    getFeatureUrlData['options']['FEATUREID'] = val;\n                    // Get data\n                    $.post( getFeatureUrlData['url'], getFeatureUrlData['options'], function(data) {\n                        if ( !data.features ){\n                            data = JSON.parse(data);\n                        }\n                        lizMap.mainLizmap.map.setHighlightFeatures(data.features[0], \"geojson\");\n                    }).fail(function(){\n                        lizMap.mainLizmap.map.setHighlightFeatures(feat, \"geojson\");\n                    });\n                }\n                // zoom to extent\n                map.zoomToExtent(feat.geometry.getBounds());\n            }\n\n            var fid = val.split('.')[1];\n\n            // Trigger event\n            lizMap.events.triggerEvent('lizmaplocatefeaturechanged',\n                {\n                    'featureType': aName,\n                    'featureId': fid\n                }\n            );\n        }\n    }\n\n    /**\n     * Get features for locate by layer tool\n     * @param aName\n     */\n    function getLocateFeature(aName) {\n        var locate = config.locateByLayer[aName];\n\n        // get fields to retrieve\n        var fields = ['geometry',locate.fieldName];\n        // if a filter field is defined\n        if ('filterFieldName' in locate)\n            fields.push( locate.filterFieldName );\n        // check for join fields\n        if ( 'filterjoins' in locate ) {\n            var filterjoins = locate.filterjoins;\n            for ( var i=0, len=filterjoins.length; i<len; i++) {\n                var filterjoin = filterjoins[i];\n                fields.push( filterjoin.targetFieldName );\n            }\n        }\n        if ( 'vectorjoins' in locate ) {\n            var vectorjoins = locate.vectorjoins;\n            for ( var i=0, len=vectorjoins.length; i<len; i++) {\n                var vectorjoin = vectorjoins[i];\n                fields.push( vectorjoin.targetFieldName );\n            }\n        }\n\n        // Get WFS url and options\n        var getFeatureUrlData = getVectorLayerWfsUrl( aName, null, null, 'extent' );\n        getFeatureUrlData['options']['PROPERTYNAME'] = fields.join(',');\n\n        var layerName = cleanName(aName);\n\n        // Get data\n        $.post( getFeatureUrlData['url'], getFeatureUrlData['options'], function(data) {\n            var lConfig = config.layers[aName];\n            locate['features'] = {};\n            if ( !data.features )\n                data = JSON.parse(data);\n            var features = data.features;\n            if( locate.crs != 'EPSG:4326' && features.length != 0) {\n                // load projection to be sure to have the definition\n                loadProjDefinition( locate.crs, function() {\n                    locate.crs = 'EPSG:4326';\n                });\n            }\n\n            if ('filterFieldName' in locate) {\n                // create filter combobox for the layer\n                features.sort(function(a, b) {\n                    var aProperty = a.properties[locate.filterFieldName];\n                    var bProperty = b.properties[locate.filterFieldName];\n                    if (isNaN(aProperty)) {\n                        if (isNaN(bProperty)) {  // a and b are strings\n                            return aProperty.localeCompare(bProperty);\n                        } else {         // a string and b number\n                            return 1;  // a > b\n                        }\n                    } else {\n                        if (isNaN(bProperty)) {  // a number and b string\n                            return -1;  // a < b\n                        } else {         // a and b are numbers\n                            return parseFloat(aProperty) - parseFloat(bProperty);\n                        }\n                    }\n                });\n                var filterPlaceHolder = '';\n                if ( 'filterFieldAlias' in locate && locate.filterFieldAlias!='')\n                    filterPlaceHolder += locate.filterFieldAlias+' ';\n                else\n                    filterPlaceHolder += locate.filterFieldName;\n                filterPlaceHolder +=' ('+ lConfig.title + ')';\n                var fOptions = '<option value=\"-1\"></option>';\n                var fValue = '-1';\n                for (var i=0, len=features.length; i<len; i++) {\n                    var feat = features[i];\n                    if ( fValue != feat.properties[locate.filterFieldName] ) {\n                        fValue = feat.properties[locate.filterFieldName];\n                        fOptions += '<option value=\"'+fValue+'\">'+fValue+'</option>';\n                    }\n                }\n\n\n                // add filter values list\n                $('#locate-layer-'+layerName).parent().before('<div class=\"locate-layer\"><select id=\"locate-layer-'+layerName+'-'+locate.filterFieldName+'\">'+fOptions+'</select></div><br/>');\n                // listen to filter select changes\n                $('#locate-layer-'+layerName+'-'+locate.filterFieldName).change(function(){\n                    var filterValue = $(this).children(':selected').val();\n                    updateLocateFeatureList( aName );\n                    if (filterValue == '-1')\n                        $('#locate-layer-'+layerName+'-'+locate.filterFieldName+' ~ span > input').val('');\n                    $('#locate-layer-'+layerName+' ~ span > input').val('');\n                    $('#locate-layer-'+layerName).val('-1');\n                    zoomToLocateFeature(aName);\n                });\n                // add combobox to the filter select\n                $('#locate-layer-'+layerName+'-'+locate.filterFieldName).combobox({\n                    position: { my : \"right top\", at: \"right bottom\" },\n                    \"selected\": function(evt, ui){\n                        if ( ui.item ) {\n                            var self = $(this);\n                            var uiItem = $(ui.item);\n                            window.setTimeout(function(){\n                                self.val(uiItem.val()).change();\n                            }, 1);\n                        }\n                    }\n                });\n\n                // add place holder to the filter combobox input\n                $('#locate-layer-'+layerName+'-'+locate.filterFieldName+' ~ span > input').attr('placeholder', filterPlaceHolder).val('');\n                $('#locate-layer-'+layerName+'-'+locate.filterFieldName+' ~ span > input').autocomplete('close');\n            }\n\n            // create combobox for the layer\n            features.sort(function(a, b) {\n                var aProperty = a.properties[locate.fieldName];\n                var bProperty = b.properties[locate.fieldName];\n                if (isNaN(aProperty)) {\n                    if (isNaN(bProperty)) {  // a and b are strings\n                        return aProperty.localeCompare(bProperty);\n                    } else {         // a string and b number\n                        return 1;  // a > b\n                    }\n                } else {\n                    if (isNaN(bProperty)) {  // a number and b string\n                        return -1;  // a < b\n                    } else {         // a and b are numbers\n                        return parseFloat(aProperty) - parseFloat(bProperty);\n                    }\n                }\n            });\n            var placeHolder = '';\n            if ('filterFieldName' in locate) {\n                if ( 'fieldAlias' in locate && locate.fieldAlias!='' )\n                    placeHolder += locate.fieldAlias+' ';\n                else\n                    placeHolder += locate.fieldName+' ';\n                placeHolder += '('+lConfig.title+')';\n            } else {\n                placeHolder = lConfig.title;\n            }\n            var options = '<option value=\"-1\"></option>';\n            for (var i=0, len=features.length; i<len; i++) {\n                var feat = features[i];\n                locate.features[feat.id.toString()] = feat;\n                if ( !('filterFieldName' in locate) )\n                    options += '<option value=\"' + feat.id + '\">' + DOMPurify.sanitize(feat.properties[locate.fieldName]) + '</option>';\n            }\n            // listen to select changes\n            $('#locate-layer-'+layerName).html(options).change(function() {\n                var val = $(this).children(':selected').val();\n                if (val == '-1') {\n                    $('#locate-layer-'+layerName+' ~ span > input').val('');\n                    // update to join layer\n                    if ( 'filterjoins' in locate && locate.filterjoins.length != 0 ) {\n                        var filterjoins = locate.filterjoins;\n                        for (var i=0, len=filterjoins.length; i<len; i++) {\n                            var filterjoin = filterjoins[i];\n                            var jName = filterjoin.joinLayer;\n                            if ( jName in config.locateByLayer ) {\n                                // update joined select options\n                                var oldVal = $('#locate-layer-'+cleanName(jName)).val();\n                                updateLocateFeatureList( jName );\n                                $('#locate-layer-'+cleanName(jName)).val( oldVal );\n                                return;\n                            }\n                        }\n                    }\n                    // zoom to parent selection\n                    if ( 'vectorjoins' in locate && locate.vectorjoins.length == 1 ) {\n                        var jName = locate.vectorjoins[0].joinLayer;\n                        if ( jName in config.locateByLayer ) {\n                            zoomToLocateFeature( jName );\n                            return;\n                        }\n                    }\n                    // clear the map\n                    zoomToLocateFeature( aName );\n                } else {\n                    // zoom to val\n                    zoomToLocateFeature( aName );\n                    // update joined layer\n                    if ( 'filterjoins' in locate && locate.filterjoins.length != 0 ) {\n                        var filterjoins = locate.filterjoins;\n                        for (var i=0, len=filterjoins.length; i<len; i++) {\n                            var filterjoin = filterjoins[i];\n                            var jName = filterjoin.joinLayer;\n                            if ( jName in config.locateByLayer ) {\n                                // update joined select options\n                                updateLocateFeatureList( jName );\n                                $('#locate-layer-'+cleanName(jName)).val('-1');\n                                $('#locate-layer-'+cleanName(jName)+' ~ span > input').val('');\n                            }\n                        }\n                    }\n                }\n                $(this).blur();\n                return;\n            });\n            $('#locate-layer-'+layerName).combobox({\n                \"minLength\": ('minLength' in locate) ? locate.minLength : 0,\n                \"position\": { my : \"right top\", at: \"right bottom\" },\n                \"selected\": function(evt, ui){\n                    if ( ui.item ) {\n                        var self = $(this);\n                        var uiItem = $(ui.item);\n                        window.setTimeout(function(){\n                            self.val(uiItem.val()).change();\n                        }, 1);\n                    }\n                }\n            });\n            $('#locate-layer-'+layerName+' ~ span > input').attr('placeholder', placeHolder).val('');\n            $('#locate-layer-'+layerName+' option[value=-1]').attr('label', placeHolder);\n            $('#locate-layer-'+layerName+' ~ span > input').autocomplete('close');\n            if ( ('minLength' in locate) && locate.minLength > 0 )\n                $('#locate-layer-'+layerName).parent().addClass('no-toggle');\n            if(mCheckMobile()){\n                // autocompletion items for locatebylayer feature\n                $('div.locate-layer select').show();\n                $('span.custom-combobox').hide();\n            }\n        },'json');\n    }\n\n    function addLocateByLayer(){\n        var locateByLayerList = [];\n        for (var lname in config.locateByLayer) {\n            if ('order' in config.locateByLayer[lname])\n                locateByLayerList[config.locateByLayer[lname].order] = lname;\n            else\n                locateByLayerList.push(lname);\n        }\n        var locateContent = [];\n        for (var l in locateByLayerList) {\n            var lname = locateByLayerList[l];\n            var lConfig = config.layers[lname];\n            var html = '<div class=\"locate-layer\">';\n            html += '<select id=\"locate-layer-' + cleanName(lname) + '\" class=\"label\">';\n            html += '<option>' + lConfig.title + '...</option>';\n            html += '</select>';\n            html += '</div>';\n            //constructing the select\n            locateContent.push(html);\n        }\n        $('#locate .menu-content').html(locateContent.join('<hr/>'));\n\n        var featureTypes = getVectorLayerFeatureTypes();\n        if (featureTypes.length == 0) {\n            config.locateByLayer = {};\n            $('#button-locate').parent().remove();\n            $('#locate-menu').remove();\n        } else {\n            for (const featureType of featureTypes) {\n                var typeName = featureType.getElementsByTagName('Name')[0].textContent;\n                var lname = lizMap.getNameByTypeName(typeName);\n                if (!lname) {\n                    if (typeName in config.locateByLayer)\n                        lname = typeName\n                    else if ((typeName in shortNameMap) && (shortNameMap[typeName] in config.locateByLayer))\n                        lname = shortNameMap[typeName];\n                    else {\n                        for (var lbl in config.locateByLayer) {\n                            if (lbl.split(' ').join('_') == typeName) {\n                                lname = lbl;\n                                break;\n                            }\n                        }\n                    }\n                }\n\n                if (!(lname in config.locateByLayer))\n                    continue;\n\n                var locate = config.locateByLayer[lname];\n                locate['crs'] = featureType.getElementsByTagName('SRS')[0].textContent;\n                loadProjDefinition(locate.crs, function () {\n                    new OpenLayers.Projection(locate.crs);\n                });\n                var bbox = featureType.getElementsByTagName('LatLongBoundingBox')[0];\n                locate['bbox'] = [\n                    parseFloat(bbox.getAttribute('minx'))\n                    , parseFloat(bbox.getAttribute('miny'))\n                    , parseFloat(bbox.getAttribute('maxx'))\n                    , parseFloat(bbox.getAttribute('maxy'))\n                ];\n            }\n\n            // get joins\n            for (var lName in config.locateByLayer) {\n                var locate = config.locateByLayer[lName];\n                if ('vectorjoins' in locate && locate['vectorjoins'].length != 0) {\n                    var vectorjoin = locate['vectorjoins'][0];\n                    locate['joinFieldName'] = vectorjoin['targetFieldName'];\n                    for (var jName in config.locateByLayer) {\n                        var jLocate = config.locateByLayer[jName];\n                        if (jLocate.layerId == vectorjoin.joinLayerId) {\n                            vectorjoin['joinLayer'] = jName;\n                            locate['joinLayer'] = jName;\n                            jLocate['joinFieldName'] = vectorjoin['joinFieldName'];\n                            jLocate['joinLayer'] = lName;\n                            jLocate['filterjoins'] = [{\n                                'targetFieldName': vectorjoin['joinFieldName'],\n                                'joinFieldName': vectorjoin['targetFieldName'],\n                                'joinLayerId': locate.layerId,\n                                'joinLayer': lName\n                            }];\n                        }\n                    }\n                }\n            }\n\n            // get locate by layers features\n            for (var lname in config.locateByLayer) {\n                getLocateFeature(lname);\n            }\n            $('.btn-locate-clear').click(function () {\n                lizMap.mainLizmap.map.clearHighlightFeatures();\n                $('#locate select').val('-1');\n                $('div.locate-layer span > input').val('');\n\n                if (lizMap.lizmapLayerFilterActive) {\n                    lizMap.events.triggerEvent('lizmaplocatefeaturecanceled',\n                        { 'featureType': lizMap.lizmapLayerFilterActive }\n                    );\n                }\n                return false;\n\n            });\n            $('#locate-close').click(function () {\n                $('.btn-locate-clear').click(); // deactivate locate and filter\n                $('#button-locate').click();\n                return false;\n            });\n        }\n    }\n\n    /**\n     * PRIVATE function: createToolbar\n     * create the tool bar (collapse switcher, etc)\n     */\n    function createToolbar() {\n        var configOptions = config.options;\n\n        addFeatureInfo();\n\n        if (('geolocation' in configOptions)\n      && configOptions['geolocation'] == 'True'){\n            $('#geolocation button.btn-geolocation-close').click(function () {\n                $('#button-geolocation').click();\n                return false;\n            });\n        }\n\n        if ( ('measure' in configOptions)\n        && configOptions['measure'] == 'True')\n            addMeasureControls();\n        else {\n            $('#measure').parent().remove();\n            $('#measure-length-menu').remove();\n            $('#measure-area-menu').remove();\n            $('#measure-perimeter-menu').remove();\n        }\n    }\n\n    /**\n     * PRIVATE function: deactivateToolControls\n     * Deactivate Openlayers controls\n     * @param evt\n     */\n    function deactivateToolControls( evt ) {\n        for (var id in controls) {\n            var ctrl = controls[id];\n            if(ctrl){\n                if (evt && ('object' in evt) && ctrl == evt.object){\n                    continue;\n                }\n                if (ctrl.type == OpenLayers.Control.TYPE_TOOL){\n                    ctrl.deactivate();\n                }\n            }\n        }\n        return true;\n    }\n\n    /**\n     *\n     * @param {string} text - text to display\n     * @param {object} xy - x and y in pixels\n     * @param {array} coordinate - coordinate in map unit\n     */\n    function displayGetFeatureInfo(text, xy, coordinate){\n        // clear highlight layer\n        lizMap.mainLizmap.map.clearHighlightFeatures();\n\n        var eventLonLatInfo = map.getLonLatFromPixel(xy);\n\n        var popup = null;\n        var popupContainerId = null;\n        if( 'popupLocation' in config.options && config.options.popupLocation != 'map' ){\n            popupContainerId = 'popupcontent';\n\n            // create content\n            var popupReg = new RegExp('lizmapPopupTable', 'g');\n            text = text.replace( popupReg, 'table table-condensed table-striped table-bordered lizmapPopupTable');\n            var pcontent = '<div class=\"lizmapPopupContent\">'+text+'</div>';\n            var hasPopupContent = (!(!text || text == null || text == ''));\n            document.querySelector('#popupcontent div.menu-content').innerHTML = pcontent;\n            if ( !$('#mapmenu .nav-list > li.popupcontent').is(':visible') )\n                $('#mapmenu .nav-list > li.popupcontent').show();\n\n            // Warn user no data has been found\n            if( !hasPopupContent ){\n                pcontent = '<div class=\"lizmapPopupContent noContent\"><h4>'+lizDict['popup.msg.no.result']+'</h4></div>';\n                document.querySelector('#popupcontent div.menu-content').innerHTML = pcontent;\n                window.setTimeout(function(){\n                    if ( $('#mapmenu .nav-list > li.popupcontent').hasClass('active') &&\n                $('#popupcontent .lizmapPopupContent').hasClass('noContent') &&\n                config.options.popupLocation != 'right-dock'){\n                        $('#button-popupcontent').click();\n                    }\n                },2000);\n            }\n\n            // Display dock if needed\n            if(\n                !$('#mapmenu .nav-list > li.popupcontent').hasClass('active')\n          && (!mCheckMobile() || ( mCheckMobile() && hasPopupContent ) )\n          && (lastLonLatInfo == null || eventLonLatInfo.lon != lastLonLatInfo.lon || eventLonLatInfo.lat != lastLonLatInfo.lat)\n            ){\n                $('#button-popupcontent').click();\n            }\n            else if(\n                $('#mapmenu .nav-list > li.popupcontent').hasClass('active')\n          && ( mCheckMobile() && hasPopupContent )\n            ){\n                $('#button-popupcontent').click();\n            }\n        } else {\n            // Hide previous popup\n            lizMap.mainLizmap.popup.mapPopup.setVisible(false);\n\n            if (!text || text == null || text == ''){\n                return false;\n            }\n\n            document.getElementById('liz_layer_popup_contentDiv').innerHTML = text;\n            if (coordinate) {\n                lizMap.mainLizmap.popup.mapPopup.setPosition(coordinate);\n            } else {\n                lizMap.mainLizmap.popup.mapPopup.setPosition([eventLonLatInfo.lon, eventLonLatInfo.lat]);\n            }\n\n            // Activate Boostrap 2 tabs here as they are not\n            // automatically activated when created in popup anchored\n            $('#' + popupContainerId + ' a[data-toggle=\"tab\"]').on( 'click',function (e) {\n                e.preventDefault();\n                $(this).tab('show');\n            });\n        }\n        lastLonLatInfo = eventLonLatInfo;\n\n        // Display related children objects\n        addChildrenFeatureInfo( popup, popupContainerId );\n        // Display geometries\n        addGeometryFeatureInfo( popup, popupContainerId );\n        // Display the plots of the children layers features filtered by popup item\n        addChildrenDatavizFilteredByPopupFeature( popup, popupContainerId );\n\n        // Trigger event\n        lizMap.events.triggerEvent(\"lizmappopupdisplayed\",\n            {'popup': popup, 'containerId': popupContainerId}\n        );\n    }\n\n    /**\n     *\n     * @param popup\n     * @param containerId\n     */\n    function addGeometryFeatureInfo( popup, containerId ) {\n        // Build selector\n        let selector = 'div.lizmapPopupContent div.lizmapPopupDiv > input.lizmap-popup-layer-feature-geometry';\n        if ( containerId ){\n            selector = '#'+ containerId +' '+ selector;\n        }\n        // Highlight geometries\n        const geometriesWKT = [];\n        document.querySelectorAll(selector).forEach(element => geometriesWKT.push(element.value));\n        if (geometriesWKT.length) {\n            const geometryCollectionWKT = `GEOMETRYCOLLECTION(${geometriesWKT.join()})`;\n            lizMap.mainLizmap.map.setHighlightFeatures(geometryCollectionWKT, \"wkt\");\n        }\n    }\n\n    /**\n     *\n     * @param popup\n     * @param containerId\n     */\n    function addChildrenDatavizFilteredByPopupFeature(popup, containerId) {\n        if ('datavizLayers' in lizMap.config) {\n            // build selector\n            var selector = 'div.lizmapPopupContent div.lizmapPopupDiv';\n            if ( containerId )\n                selector = '#'+ containerId +' '+ selector;\n            $(selector).each(function(){\n                var mydiv = $(this);\n\n                // Do not add plots if already present\n                if( $(this).find('div.lizdataviz').length > 0 )\n                    return true;\n\n                if ($(this).find('input.lizmap-popup-layer-feature-id:first').val()) {\n                    var getLayerId = $(this).find('input.lizmap-popup-layer-feature-id:first').val().split('.');\n                    var popupId = getLayerId[0] + '_' + getLayerId[1];\n                    var layerId = getLayerId[0];\n                    var fid = getLayerId[1];\n\n                    var getLayerConfig = lizMap.getLayerConfigById( layerId );\n\n                    // verifiying  related children objects\n                    if ( !getLayerConfig )\n                        return true;\n                    var featureType = getLayerConfig[0];\n\n                    // We do not want to deactivate the display of filtered children dataviz\n                    // when children popup are not displayed : comment the 2 following lines\n                    if ( !('relations' in lizMap.config) || !(layerId in lizMap.config.relations) )\n                        return true;\n\n                    //If dataviz exists, get config\n                    if( !('datavizLayers' in lizMap.config ))\n                        return true;\n\n                    lizMap.getLayerFeature(featureType, fid, function(feat) {\n                        // Where there is all plots\n                        var plotLayers = lizMap.config.datavizLayers.layers;\n                        var lrelations = lizMap.config.relations[layerId];\n                        var nbPlotByLayer = 1;\n\n                        for ( var i in plotLayers) {\n\n                            for(var x in lrelations){\n                                var rel = lrelations[x];\n                                // Id of the layer which is the child of layerId\n                                var getChildrenId = rel.referencingLayer;\n\n                                // Filter of the plot\n                                var filter = '\"' + rel.referencingField + '\" IN (\\''+feat.properties[rel.referencedField]+'\\')';\n\n\n                                if(plotLayers[i].layer_id==getChildrenId)\n                                {\n                                    var plot_config=plotLayers[i];\n                                    if('popup_display_child_plot' in plot_config\n                              && plot_config.popup_display_child_plot == \"True\"\n                                    ){\n                                        var plot_id=plotLayers[i].plot_id;\n                                        popupId = getLayerId[0] + '_' + getLayerId[1] + '_' + String(nbPlotByLayer);\n                                        // Be sure the id is unique ( popup can be displayed in atlas tool too)\n                                        popupId+= '_' + new Date().valueOf()+btoa(Math.random()).substring(0,12);\n                                        var phtml = lizDataviz.buildPlotContainerHtml(\n                                            plot_config.title_popup,\n                                            plot_config.abstract,\n                                            popupId,\n                                            false\n                                        );\n                                        var html = '<div class=\"lizmapPopupChildren lizdataviz\">';\n                                        html+= '<h4>'+ plot_config.title_popup+'</h4>';\n                                        html+= phtml\n                                        html+= '</div>';\n                                        var haspc = $(mydiv).find('div.lizmapPopupChildren:last');\n                                        if( haspc.length > 0 )\n                                            $(haspc).after(html);\n                                        else\n                                            $(mydiv).append(html);\n                                        lizDataviz.getPlot(plot_id, filter, popupId);\n                                        nbPlotByLayer++;\n                                    }\n                                }\n                            }\n                        }\n                    });\n                }\n            });\n        }else{\n            return false;\n        }\n    }\n\n    /**\n     *\n     * @param popup\n     * @param containerId\n     */\n    function addChildrenFeatureInfo( popup, containerId ) {\n        var selector = 'div.lizmapPopupContent input.lizmap-popup-layer-feature-id';\n        if ( containerId )\n            selector = '#'+ containerId +' '+ selector;\n        $(selector).each(function(){\n            var self = $(this);\n            var val = self.val();\n            var fid = val.split('.').pop();\n            var layerId = val.replace( '.' + fid, '' );\n\n            var getLayerConfig = getLayerConfigById( layerId );\n\n            // verifiying  related children objects\n            if ( !getLayerConfig )\n                return true;\n            var layerConfig = getLayerConfig[1];\n            var featureType = getLayerConfig[0];\n            if ( !('popupDisplayChildren' in layerConfig) || layerConfig.popupDisplayChildren != 'True')\n                return true;\n            if ( !('relations' in config) || !(layerId in config.relations) )\n                return true;\n\n            // Display related children objects\n            var relations = config.relations[layerId];\n            var popupMaxFeatures = 10;\n            if ( 'popupMaxFeatures' in layerConfig && !isNaN(parseInt(layerConfig.popupMaxFeatures)) )\n                popupMaxFeatures = parseInt(layerConfig.popupMaxFeatures);\n            popupMaxFeatures == 0 ? 10 : popupMaxFeatures;\n            getLayerFeature(featureType, fid, function(feat) {\n                var parentDiv = self.parent();\n\n                // Array of Promise w/ fetch to request children popup content\n                const popupChidrenRequests = [];\n\n                // Array of pre-processed objects for WMS popup requests\n                const preProcessedRequests = [];\n\n                // Array of object contains utilities for each relation\n                const preProcessUtilities = [];\n\n                const rConfigLayerAll = [];\n\n                // Build POST query for every child based on QGIS relations\n                for ( const relation of relations ){\n                    const rLayerId = relation.referencingLayer;\n                    let preProcessRequest = null;\n\n                    // prepare utilities object\n                    let rUtilities = {\n                        rLayerId : rLayerId, // pivot id or table id\n                        relationId: relation.relationId, // relationId\n                    };\n                    const pivotAttributeLayerConf = lizMap.getLayerConfigById( rLayerId, lizMap.config.attributeLayers, 'layerId' );\n                    // check if child is a pivot table\n                    if (pivotAttributeLayerConf && pivotAttributeLayerConf[1]?.pivot == 'True' && config.relations.pivot && config.relations.pivot[rLayerId]) {\n                        // looking for related children\n                        const pivotConfig =  lizMap.getLayerConfigById(\n                            rLayerId,\n                            config.layers,\n                            'id'\n                        );\n                        if (pivotConfig) {\n                            // n to m -> get \"m\" layer id\n                            var mLayer = Object.keys(config.relations.pivot[rLayerId]).filter((k)=>{ return k !== layerId})\n                            if (mLayer.length == 1) {\n                                // \"m\" layer config\n                                const mLayerConfig = getLayerConfigById( mLayer[0] );\n                                if (mLayerConfig) {\n                                    let clRefname = mLayerConfig[1]?.shortname || mLayerConfig[1]?.cleanname;\n                                    if ( clRefname === undefined ) {\n                                        clRefname = cleanName(mLayerConfig[1].name);\n                                        mLayerConfig[1].cleanname = clRefname;\n                                    }\n                                    if (mLayerConfig[1].popup == 'True' && self.parent().find('div.lizmapPopupChildren.'+clRefname).length == 0) {\n                                        // get results from pivot table\n                                        const typeName = pivotConfig[1].typename;\n                                        const wfsParams = {\n                                            TYPENAME: typeName,\n                                            GEOMETRYNAME: 'extent'\n                                        };\n\n                                        wfsParams['EXP_FILTER'] = '\"' + config.relations.pivot[rLayerId][layerId] + '\" = ' + \"'\" + feat.properties[relation.referencedField] + \"'\";\n                                        // Calculate bbox\n                                        if (config.options?.limitDataToBbox == 'True') {\n                                            wfsParams['BBOX'] = lizMap.mainLizmap.map.getView().calculateExtent();\n                                            wfsParams['SRSNAME'] = lizMap.mainLizmap.map.getView().getProjection().getCode();\n                                        }\n                                        preProcessRequest = lizMap.mainLizmap.wfs.getFeature(wfsParams);\n\n                                        let ut = {\n                                            pivotTableId: rLayerId,\n                                            mLayerConfig: mLayerConfig\n                                        }\n                                        rUtilities = {...rUtilities,...ut};\n                                    }\n                                }\n                            }\n                        }\n                    } else {\n                        // one to n relation\n                        const rGetLayerConfig = getLayerConfigById( rLayerId );\n                        if ( rGetLayerConfig ) {\n                            preProcessRequest = {\n                                oneToN:true,\n                                layer:rGetLayerConfig[1],\n                                relationId:relation.relationId,\n                            }\n                            let ut = {\n                                referencingField: relation.referencingField,\n                                referencedField: relation.referencedField\n                            }\n                            rUtilities = {...rUtilities, ...ut}\n                        }\n                    }\n                    preProcessedRequests.push(preProcessRequest);\n                    preProcessUtilities.push(rUtilities)\n                }\n\n                Promise.allSettled(preProcessedRequests).then(preProcessResponses =>{\n                    for (let rr = 0; rr < preProcessResponses.length; rr++) {\n                        const resp = preProcessResponses[rr];\n                        const utilities = preProcessUtilities[rr];\n                        if (resp.value) {\n                            const respValue = resp.value;\n                            var confLayer = null, wmsFilter = null;\n                            if (respValue.oneToN && utilities.referencingField && utilities.referencedField) {\n                                confLayer = respValue.layer;\n                                wmsFilter = '\"'+utilities.referencingField+'\" = \\''+feat.properties[utilities.referencedField]+'\\'';\n                            } else {\n                                if (respValue.features) {\n                                    const features = respValue.features;\n                                    const referencedFieldForFilter = config.relations[utilities.mLayerConfig[1].id].filter((fil)=>{\n                                        return fil.referencingLayer == utilities.rLayerId\n                                    })[0]?.referencedField;\n                                    let filArray = [];\n                                    const feats = {};\n                                    features.forEach((feat)=>{\n                                        var fid = feat.id.split('.')[1];\n                                        feats[fid] = feat;\n                                        if (feat.properties && feat.properties[config.relations.pivot[utilities.rLayerId][utilities.mLayerConfig[1].id]]) {\n                                            filArray.push(feat.properties[config.relations.pivot[utilities.rLayerId][utilities.mLayerConfig[1].id]])\n                                        }\n                                    })\n\n                                    if (filArray.length) {\n                                        let fil = filArray.map(function(val){\n                                            return '\"'+referencedFieldForFilter+'\" = \\''+val+'\\'';\n                                        })\n\n                                        wmsFilter = fil.join(\" OR \");\n                                    }\n                                    const pivotConfig = lizMap.getLayerConfigById(\n                                        utilities.pivotTableId,\n                                        config.layers,\n                                        'id'\n                                    );\n                                    pivotConfig[1].features = feats;\n                                    // get feature of mLayer\n                                    confLayer = utilities.mLayerConfig[1];\n                                }\n                            }\n                            if (wmsFilter && confLayer) {\n                                const rConfigLayer = confLayer;\n                                let clname = rConfigLayer?.shortname || rConfigLayer.cleanname;\n                                if ( clname === undefined ) {\n                                    clname = cleanName(rConfigLayer.name);\n                                    rConfigLayer.cleanname = clname;\n                                }\n                                if ( rConfigLayer.popup == 'True' && self.parent().find('div.lizmapPopupChildren.'+clname).length == 0) {\n                                    let wmsName = rConfigLayer?.shortname || rConfigLayer.name;\n                                    const wmsOptions = {\n                                        'LAYERS': wmsName\n                                        ,'QUERY_LAYERS': wmsName\n                                        ,'STYLES': ''\n                                        ,'SERVICE': 'WMS'\n                                        ,'VERSION': '1.3.0'\n                                        ,'CRS': (('crs' in rConfigLayer) && rConfigLayer.crs != '') ? rConfigLayer.crs : 'EPSG:4326'\n                                        ,'REQUEST': 'GetFeatureInfo'\n                                        ,'EXCEPTIONS': 'application/vnd.ogc.se_inimage'\n                                        ,'FEATURE_COUNT': popupMaxFeatures\n                                        ,'INFO_FORMAT': 'text/html'\n                                    };\n                                    if ( 'popupMaxFeatures' in rConfigLayer && !isNaN(parseInt(rConfigLayer.popupMaxFeatures)) )\n                                        wmsOptions['FEATURE_COUNT'] = parseInt(rConfigLayer.popupMaxFeatures);\n                                    if ( wmsOptions['FEATURE_COUNT'] == 0 )\n                                        wmsOptions['FEATURE_COUNT'] = popupMaxFeatures;\n                                    if ( rConfigLayer.request_params && rConfigLayer.request_params.filter &&\n                                        rConfigLayer.request_params.filter !== '' )\n                                        wmsOptions['FILTER'] = rConfigLayer.request_params.filter+' AND '+wmsFilter;\n                                    else\n                                        wmsOptions['FILTER'] = wmsName+':'+wmsFilter;\n\n                                    // Fetch queries\n                                    // Keep `rConfigLayer` in array with same order that fetch queries\n                                    // for later user when Promise.allSettled resolves\n                                    rConfigLayerAll.push(rConfigLayer);\n                                    popupChidrenRequests.push(\n                                        fetch(globalThis['lizUrls'].service, {\n                                            \"method\": \"POST\",\n                                            \"body\": new URLSearchParams(wmsOptions)\n                                        }).then(function (response) {\n                                            return response.text();\n                                        }).then( function (textResp) {\n                                            // add utilities object to response for further controls\n                                            return {\n                                                popupChildData:textResp,\n                                                utilities:utilities\n                                            }\n                                        })\n                                    );\n                                }\n                            }\n                        }\n                    }\n\n                    // Fetch GetFeatureInfo query for every children popups\n                    Promise.allSettled(popupChidrenRequests).then(popupChildrenData => {\n\n                        const childPopupElements = [];\n\n                        for (let index = 0; index < popupChildrenData.length; index++) {\n                            let popupResponse = popupChildrenData[index].value;\n                            let popupChildData = popupResponse.popupChildData;\n                            const utilities = popupResponse.utilities;\n                            var hasPopupContent = (!(!popupChildData || popupChildData == null || popupChildData == ''))\n                            if (hasPopupContent) {\n                                var popupReg = new RegExp('lizmapPopupTable', 'g');\n                                popupChildData = popupChildData.replace(popupReg, 'table table-condensed table-striped lizmapPopupTable');\n\n                                const configLayer = rConfigLayerAll[index];\n\n                                var clname = configLayer.cleanname;\n                                if (clname === undefined) {\n                                    clname = cleanName(configLayer.name);\n                                    configLayer.cleanname = clname;\n                                }\n\n                                if(utilities.pivotTableId){\n                                    var popupFeatureToolbarReg = new RegExp('<lizmap-feature-toolbar ', 'g');\n                                    popupChildData = popupChildData.replace(popupFeatureToolbarReg,\"<lizmap-feature-toolbar parent-layer-id='\"+layerId+\"' pivot-layer='\"+utilities.pivotTableId+':'+fid+\"'\")\n\n                                }\n\n                                const resizeTablesButtons =\n                                    '<button class=\"compact-tables btn btn-small\" data-original-title=\"' + lizDict['popup.table.compact'] + '\"><i class=\"icon-resize-small\"></i></button>'+\n                                    '<button class=\"explode-tables btn btn-small hide\" data-original-title=\"' + lizDict['popup.table.explode'] + '\"><i class=\"icon-resize-full\"></i></button>';\n\n                                var childPopup = $('<div class=\"lizmapPopupChildren ' + clname + '\" data-layername=\"' + clname + '\" data-title=\"' + configLayer.title + '\">' + resizeTablesButtons + popupChildData + '</div>');\n\n                                // Manage if the user choose to create a table for children\n                                if (['qgis', 'form'].indexOf(configLayer.popupSource) !== -1 && childPopup.find('.lizmap_merged').length != 0) {\n                                    // save inputs\n                                    childPopup.find(\".lizmapPopupDiv\").each(function (i, e) {\n                                        var popupDiv = $(e);\n                                        if (popupDiv.find(\".lizmapPopupHeader\").prop(\"tagName\") == 'TR') {\n                                            popupDiv.find(\".lizmapPopupHeader\").prepend(\"<th></th>\");\n                                            popupDiv.find(\".lizmapPopupHeader\").next().prepend(\"<td></td>\");\n                                        } else {\n                                            popupDiv.find(\".lizmapPopupHeader\").next().prepend(\"<span></span>\");\n                                        }\n                                        popupDiv.find(\".lizmapPopupHeader\").next().children().first().append(popupDiv.find(\"input\"));\n                                    });\n                                    childPopup.find(\"h4\").each(function (i, e) {\n                                        if (i != 0)\n                                            $(e).remove();\n                                    });\n\n                                    childPopup.find(\".lizmapPopupHeader\").each(function (i, e) {\n                                        if (i != 0)\n                                            $(e).remove();\n                                    });\n\n                                    childPopup.find(\".lizmapPopupDiv\").contents().unwrap();\n                                    childPopup.find(\".lizmap_merged\").contents().unwrap();\n                                    childPopup.find(\".lizmapPopupDiv\").remove();\n                                    childPopup.find(\".lizmap_merged\").remove();\n\n                                    childPopup.find(\".lizmapPopupHidden\").hide();\n\n                                    var tChildPopup = $(\"<table class='lizmap_merged'></table>\");\n                                    childPopup.append(tChildPopup);\n                                    childPopup.find('tr').appendTo(tChildPopup);\n\n                                    childPopup.children('tbody').remove();\n                                }\n\n                                var oldPopupChild = parentDiv.find('div.lizmapPopupChildren.' + clname);\n                                if (oldPopupChild.length != 0) {\n                                    oldPopupChild.remove();\n                                }\n\n                                parentDiv.append(childPopup);\n\n                                childPopupElements.push({\n                                    childPopupElement:childPopup,\n                                    relationId:utilities.relationId,\n                                });\n\n                                // Trigger event for single popup children\n                                lizMap.events.triggerEvent(\n                                    \"lizmappopupchildrendisplayed\",\n                                    { 'html': childPopup.html() }\n                                );\n                            }\n                        }\n\n                        // Handle compact-tables/explode-tables behaviour\n                        parentDiv.find('.lizmapPopupChildren .popupAllFeaturesCompact table').DataTable({\n                            order: [[1, 'asc']],\n                            language: { url:globalThis['lizUrls'][\"dataTableLanguage\"] }\n                        });\n\n                        parentDiv.find('.lizmapPopupChildren .compact-tables, .lizmapPopupChildren .explode-tables').tooltip();\n\n                        parentDiv.find('.lizmapPopupChildren .compact-tables').off('click').on('click',function() {\n                            $(this)\n                                .addClass('hide')\n                                .siblings('.explode-tables').removeClass('hide')\n                                .siblings('.popupAllFeaturesCompact, .lizmapPopupSingleFeature').toggle();\n                        });\n\n                        parentDiv.find('.lizmapPopupChildren .explode-tables').off('click').on('click',function () {\n                            $(this)\n                                .addClass('hide')\n                                .siblings('.compact-tables').removeClass('hide')\n                                .siblings('.popupAllFeaturesCompact, .lizmapPopupSingleFeature').toggle();\n                        });\n\n                        // place children in the right div, if any\n                        let relations = parentDiv.children('.container.popup_lizmap_dd').find(\".popup_lizmap_dd_relation\");\n                        relations.each((ind, relation) => {\n                            let relationId = relation.dataset.relationId;\n                            let elementToMove = childPopupElements.filter(c => c.relationId == relationId);\n                            if (elementToMove.length == 1) {\n                                $(relation).append(elementToMove[0].childPopupElement);\n                            }\n                        });\n\n                        // Trigger event for all popup children\n                        lizMap.events.triggerEvent(\n                            \"lizmappopupallchildrendisplayed\",\n                            {\n                                parentPopupElement: self.parents('.lizmapPopupSingleFeature'),\n                                childPopupElements: childPopupElements.map(c => c.childPopupElement)\n                            }\n                        );\n                    });\n                })\n            });\n        });\n    }\n\n    /**\n     *\n     */\n    function addFeatureInfo() {\n        // Verifying layers\n        var popupsAvailable = false;\n        for ( var l in config.layers ) {\n            var configLayer = config.layers[l];\n            var editionLayer = null;\n            if ( ('editionLayers' in config) && (l in config.editionLayers) )\n                editionLayer = config.editionLayers[l];\n            if( (configLayer && configLayer.popup && configLayer.popup == 'True')\n           || (editionLayer && ( editionLayer.capabilities.modifyGeometry == 'True'\n                              || editionLayer.capabilities.modifyAttribute == 'True'\n                              || editionLayer.capabilities.deleteFeature == 'True') ) ){\n                popupsAvailable = true;\n                break;\n            }\n        }\n        if ( !popupsAvailable ) {\n            if ($('#mapmenu .nav-list > li.popupcontent > a').length ) {\n                $('#mapmenu .nav-list > li.popupcontent').remove();\n            }\n            return null;\n        }\n\n        // Create the dock if needed\n        if( 'popupLocation' in config.options && config.options.popupLocation != 'map' ){\n            var popupContainerId = 'popupcontent';\n            if ( !$('#mapmenu .nav-list > li.popupcontent > a').length ) {\n                // Verifying the message\n                if ( !('popup.msg.start' in lizDict) )\n                    lizDict['popup.msg.start'] = 'Click to the map to get informations.';\n                // Initialize dock\n                var pcontent = '<div class=\"lizmapPopupContent\"><h4>'+lizDict['popup.msg.start']+'</h4></div>';\n                addDock(popupContainerId, 'Popup', config.options.popupLocation, pcontent, 'icon-comment');\n            } else {\n                $('#mapmenu .nav-list > li.popupcontent > a > span.icon').append('<i class=\"icon-comment icon-white\" style=\"margin-left: 4px;\"></i>');\n                $('#mapmenu .nav-list > li.popupcontent > a > span.icon').css('background-image', 'none');\n            }\n\n            $('#button-popupcontent').click(function(){\n                if ($(this).parent().hasClass('active')) {\n                    // clear highlight layer but keep information\n                    lizMap.mainLizmap.map.clearHighlightFeatures();\n                } else {\n                    // Display geometry associated with popups\n                    addGeometryFeatureInfo(null, popupContainerId);\n                }\n            });\n        }\n\n        /**\n         *\n         * @param evt\n         */\n        function refreshGetFeatureInfo( evt ) {\n            if ( !evt.updateDrawing )\n                return;\n            if ( lastLonLatInfo == null )\n                return true;\n            var lastPx = map.getPixelFromLonLat(lastLonLatInfo);\n            if ( $('#liz_layer_popup  div.lizmapPopupContent').length < 1\n          && $('#popupcontent > div.menu-content div.lizmapPopupContent').length < 1)\n                return;\n\n            var popupContainerId = \"liz_layer_popup\";\n            if ( $('#'+popupContainerId+' div.lizmapPopupContent input.lizmap-popup-layer-feature-id').length == 0 )\n                popupContainerId = 'popupcontent';\n\n            // Refresh if needed\n            var refreshInfo = false;\n            $('#'+popupContainerId+' div.lizmapPopupContent input.lizmap-popup-layer-feature-id').each(function(){\n                var self = $(this);\n                var val = self.val();\n                var fid = val.split('.').pop();\n                var layerId = val.replace( '.' + fid, '' );\n                var aConfig = lizMap.getLayerConfigById( layerId );\n                if ( aConfig && aConfig[0] == evt.featureType ) {\n                    refreshInfo = true;\n                    return false;\n                }\n            });\n            if ( refreshInfo  ) {\n            //lastLonLatInfo = null;\n                $('#'+popupContainerId+' div.lizmapPopupContent input.lizmap-popup-layer-feature-id[value=\"'+evt.layerId+'.'+evt.featureId+'\"]').parent().remove();\n            }\n            return;\n        }\n        lizMap.events.on({\n            \"layerFilterParamChanged\": function( evt ) {\n            // Continue only if there is a popup displayed\n            // This would avoid useless GETFILTERTOKEN requests\n                let nbPopupDisplayed = document.querySelectorAll('input.lizmap-popup-layer-feature-id').length;\n                if (nbPopupDisplayed == 0) {\n                    return;\n                }\n\n                for ( var  lName in config.layers ) {\n                    let lConfig = config.layers[lName];\n\n                    // Do not request if the layer has no popup\n                    if ( lConfig.popup != 'True' )\n                        continue;\n\n                    // Do not request if the layer has no request parameters\n                    if ( !('request_params' in lConfig)\n                  || lConfig['request_params'] == null )\n                        continue;\n\n                    // Do not get the filter token if the popup is not displayed\n                    nbPopupDisplayed = document.querySelectorAll(\n                  `input.lizmap-popup-layer-feature-id[value^=${lConfig.id}]`\n                    ).length;\n                    if (nbPopupDisplayed == 0) {\n                        continue;\n                    }\n\n                    // Get the filter token only if there is a request_params filter\n                    var requestParams = lConfig['request_params'];\n                    if ( ('filter' in lConfig['request_params'])\n                  && lConfig['request_params']['filter'] != null\n                  && lConfig['request_params']['filter'] != \"\" ) {\n\n                        // Get filter token\n                        var sdata = {\n                            service: 'WMS',\n                            request: 'GETFILTERTOKEN',\n                            typename: lName,\n                            filter: lConfig['request_params']['filter']\n                        };\n                        $.post(globalThis['lizUrls'].service, sdata, function(result){\n                        // Update layer state\n                            lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(lConfig.name).filterToken = {\n                                expressionFilter: lConfig['request_params']['exp_filter'],\n                                token: result.token\n                            };\n                            // Refresh GetFeatureInfo\n                            refreshGetFeatureInfo(evt);\n                        });\n                    }\n                }\n            },\n            \"layerSelectionChanged\": function( evt ) {\n                refreshGetFeatureInfo(evt);\n            },\n            \"lizmapeditionfeaturedeleted\": function( evt ) {\n                if ( $('div.lizmapPopupContent input.lizmap-popup-layer-feature-id').length > 1 ) {\n                    refreshGetFeatureInfo(evt);\n                } else {\n                    if (map.popups.length != 0)\n                        map.removePopup(map.popups[0]);\n\n                    if( 'popupLocation' in config.options && config.options.popupLocation != 'map' ){\n                        var pcontent = '<div class=\"lizmapPopupContent\"><h4>'+lizDict['popup.msg.no.result']+'</h4></div>';\n                        document.querySelector('#popupcontent div.menu-content').innerHTML = pcontent;\n                        if ( $('#mapmenu .nav-list > li.popupcontent').hasClass('active') )\n                            $('#button-popupcontent').click();\n                        if ( !$('#mapmenu .nav-list > li.popupcontent').hasClass('active') )\n                            $('#mapmenu .nav-list > li.popupcontent').hide();\n                    }\n                }\n            }\n        });\n    }\n\n    /**\n     *\n     * @param aLayerId\n     * @param aConfObjet\n     * @param aIdAttribute\n     */\n    function getLayerConfigById( aLayerId, aConfObjet, aIdAttribute ) {\n    // Set function parameters if not given\n        aConfObjet = typeof aConfObjet !== 'undefined' ?  aConfObjet : config.layers;\n        aIdAttribute = typeof aIdAttribute !== 'undefined' ?  aIdAttribute : 'id';\n\n        // Loop through layers to get the one by id\n        for ( var lx in aConfObjet ) {\n            if ( aConfObjet[lx][aIdAttribute] == aLayerId )\n                return [lx, aConfObjet[lx] ];\n        }\n        return null;\n    }\n\n\n    /**\n     *\n     */\n    function addMeasureControls() {\n    // style the sketch fancy\n        var sketchSymbolizers = {\n            \"Point\": {\n                pointRadius: 4,\n                graphicName: \"square\",\n                fillColor: \"white\",\n                fillOpacity: 1,\n                strokeWidth: 1,\n                strokeOpacity: 1,\n                strokeColor: \"#333333\"\n            },\n            \"Line\": {\n                strokeWidth: 3,\n                strokeOpacity: 1,\n                strokeColor: \"#666666\",\n                strokeDashstyle: \"dash\"\n            },\n            \"Polygon\": {\n                strokeWidth: 2,\n                strokeOpacity: 1,\n                strokeColor: \"#666666\",\n                strokeDashstyle: \"dash\",\n                fillColor: \"white\",\n                fillOpacity: 0.3\n            }\n        };\n        var style = new OpenLayers.Style();\n        style.addRules([\n            new OpenLayers.Rule({symbolizer: sketchSymbolizers})\n        ]);\n        var styleMap = new OpenLayers.StyleMap({\"default\": style});\n\n        var measureControls = {\n            length: new OpenLayers.Control.Measure(\n                OpenLayers.Handler.Path, {\n                    persist: true,\n                    geodesic: true,\n                    immediate: true,\n                    handlerOptions: {\n                        layerOptions: {\n                            styleMap: styleMap\n                        }\n                    },\n                    type:OpenLayers.Control.TYPE_TOOL\n                }\n            ),\n            area: new OpenLayers.Control.Measure(\n                OpenLayers.Handler.Polygon, {\n                    persist: true,\n                    geodesic: true,\n                    immediate: true,\n                    handlerOptions: {\n                        layerOptions: {\n                            styleMap: styleMap\n                        }\n                    },\n                    type:OpenLayers.Control.TYPE_TOOL\n                }\n            ),\n            perimeter: new OpenLayers.Control.Measure(\n                OpenLayers.Handler.Polygon, {\n                    persist: true,\n                    geodesic: true,\n                    immediate: true,\n                    handlerOptions: {\n                        layerOptions: {\n                            styleMap: styleMap\n                        }\n                    },\n                    type:OpenLayers.Control.TYPE_TOOL\n                }\n            ),\n            angle: new OpenLayers.Control.Measure(\n                OpenLayers.Handler.Path, {\n                    id: 'angleMeasure',\n                    persist: true,\n                    geodesic: true,\n                    immediate: true,\n                    handlerOptions: {\n                        maxVertices: 3,\n                        layerOptions: {\n                            styleMap: styleMap\n                        }\n                    },\n                    type: OpenLayers.Control.TYPE_TOOL\n                }\n            )\n        };\n        measureControls.length.events.on({\n            activate: function() {\n                mAddMessage(lizDict['measure.activate.length'],'info',true).attr('id','lizmap-measure-message');\n            },\n            deactivate: function() {\n                $('#lizmap-measure-message').remove();\n            }\n        });\n        measureControls.area.events.on({\n            activate: function() {\n                mAddMessage(lizDict['measure.activate.area'],'info',true).attr('id','lizmap-measure-message');\n            },\n            deactivate: function() {\n                $('#lizmap-measure-message').remove();\n            }\n        });\n        measureControls.perimeter.events.on({\n            activate: function () {\n                mAddMessage(lizDict['measure.activate.perimeter'], 'info', true).attr('id', 'lizmap-measure-message');\n            },\n            deactivate: function () {\n                $('#lizmap-measure-message').remove();\n            }\n        });\n        measureControls.angle.events.on({\n            activate: function () {\n                mAddMessage(lizDict['measure.activate.angle'], 'info', true).attr('id', 'lizmap-measure-message');\n            },\n            deactivate: function () {\n                $('#lizmap-measure-message').remove();\n            }\n        });\n\n        measureControls.perimeter.measure = function(geometry, eventType) {\n            var stat, order;\n            if( OpenLayers.Util.indexOf( geometry.CLASS_NAME, 'LineString' ) > -1) {\n                stat = this.getBestLength(geometry);\n                order = 1;\n            } else {\n                stat = this.getBestLength(geometry.components[0]);\n                order = 1;\n            }\n            this.events.triggerEvent(eventType, {\n                measure: stat[0],\n                units: stat[1],\n                order: order,\n                geometry: geometry\n            });\n        };\n\n        /**\n         *\n         * @param evt\n         */\n        function handleMeasurements(evt) {\n            var units = evt.units;\n            var order = evt.order;\n            var measure = evt.measure;\n            var out = \"\";\n\n            // Angle\n            if (evt.object.id === \"angleMeasure\") {\n\n                out = lizDict['measure.handle'] + \" 0°\";\n\n                // Three points are needed to measure an angle\n                if (evt.geometry.components.length === 3){\n                    // Invert first and second points and use a flag to make this change occurs once until next measurement\n                    if(evt.object.invert === undefined){\n                        const firstComponent = evt.geometry.components[0].clone();\n                        const secondComponent = evt.geometry.components[1].clone();\n                        evt.geometry.components[0].move(secondComponent.x - firstComponent.x, secondComponent.y - firstComponent.y);\n                        evt.geometry.components[1].move(firstComponent.x - secondComponent.x, firstComponent.y - secondComponent.y);\n\n                        evt.object.invert = true;\n                    } else if (evt.type === \"measure\"){\n                        evt.object.invert = undefined;\n                    }\n\n                    // Display angle ABC between three points. B is center\n                    const A = evt.geometry.components[0];\n                    const B = evt.geometry.components[1];\n                    const C = evt.geometry.components[2];\n\n                    const AB = Math.sqrt(Math.pow(B.x - A.x, 2) + Math.pow(B.y - A.y, 2));\n                    const BC = Math.sqrt(Math.pow(B.x - C.x, 2) + Math.pow(B.y - C.y, 2));\n                    const AC = Math.sqrt(Math.pow(C.x - A.x, 2) + Math.pow(C.y - A.y, 2));\n                    let angleInDegrees = (Math.acos((BC * BC + AB * AB - AC * AC) / (2 * BC * AB)) * 180) / Math.PI;\n\n                    if (isNaN(angleInDegrees)) {\n                        angleInDegrees = 0;\n                    }\n\n                    out = lizDict['measure.handle'] + \" \" + angleInDegrees.toFixed(2) + \"°\";\n                }\n                // Other measurement tools\n            }else{\n                if (order == 1) {\n                    out += lizDict['measure.handle'] + \" \" + measure.toFixed(3) + \" \" + units;\n                } else {\n                    out += lizDict['measure.handle'] + \" \" + measure.toFixed(3) + \" \" + units + \"<sup>2</\" + \"sup>\";\n                }\n            }\n\n            var element = $('#lizmap-measure-message');\n            if ( element.length == 0 ) {\n                element = mAddMessage(out);\n                element.attr('id','lizmap-measure-message');\n            } else {\n                element.html('<p>'+out+'</p>');\n            }\n        }\n\n        for(var key in measureControls) {\n            var control = measureControls[key];\n            control.events.on({\n                \"measure\": handleMeasurements,\n                \"measurepartial\": handleMeasurements\n            });\n            map.addControl(control);\n            controls[key+'Measure'] = control;\n        }\n        $('#measure-type').change(function() {\n            var self = $(this);\n            self.find('option').each(function() {\n                var val = $( this ).attr('value');\n                if ( val in measureControls && measureControls[val].active )\n                    measureControls[val].deactivate();\n            });\n            measureControls[self.val()].activate();\n        });\n        lizMap.events.on({\n            minidockopened: function(e) {\n                if ( e.id == 'measure' ) {\n                    // Put old OL2 map on top and synchronize position with new OL map\n                    lizMap.mainLizmap.newOlMap = false;\n\n                    $('#measure-type').change();\n                }\n            },\n            minidockclosed: function(e) {\n                if ( e.id == 'measure' ) {\n                    // Put old OL2 map at bottom\n                    lizMap.mainLizmap.newOlMap = true;\n\n                    var activeCtrl = '';\n                    $('#measure-type option').each(function() {\n                        var val = $( this ).attr('value');\n                        if ( val in measureControls && measureControls[val].active )\n                            activeCtrl = val;\n                    });\n                    if ( activeCtrl != '' )\n                        measureControls[activeCtrl].deactivate();\n                }\n            }\n        });\n\n        $('#measure-stop').click(function(){\n            $('#button-measure').click();\n        });\n\n        return measureControls;\n    }\n\n    /**\n     * PRIVATE function: loadProjDefinition\n     * load CRS definition and activate it\n     *\n     * Parameters:\n     * aCRS - {String}\n     * aCallbalck - {function ( proj )}\n     * @param aCRS\n     * @param aCallback\n     */\n    function loadProjDefinition( aCRS, aCallback ) {\n        var proj = aCRS.replace(/^\\s+|\\s+$/g, ''); // trim();\n        if ( proj in Proj4js.defs ) {\n            aCallback( proj );\n        } else {\n            $.get( globalThis['lizUrls'].service, {\n                'SERVICE':'WMS',\n                'REQUEST':'GetProj4'\n                ,'authid': proj\n            }, function ( aText ) {\n                Proj4js.defs[proj] = aText;\n                new OpenLayers.Projection(proj);\n                aCallback( proj );\n            }\n            );\n        }\n    }\n\n    /**\n     * PRIVATE function: mCheckMobile\n     * Check wether in mobile context.\n     *\n     *\n     * Returns:\n     * {Boolean} True if in mobile context.\n     */\n    function mCheckMobile() {\n        var minMapSize = 450;\n        var w = $('body').parent()[0].offsetWidth;\n        var leftW = w - minMapSize;\n        if(leftW < minMapSize || w < minMapSize)\n            return true;\n        return false;\n    }\n\n    /**\n     * PRIVATE function: mAddMessage\n     * Write message to the UI\n     *\n     *\n     * Returns:\n     * {jQuery Object} The message added.\n     * @param aMessage\n     * @param aType\n     * @param aClose\n     * @param aTimeout\n     */\n    function mAddMessage( aMessage, aType, aClose, aTimeout ) {\n        var mType = 'info';\n        var mTypeList = ['info', 'error', 'success'];\n        var mClose = false;\n\n        if ( mTypeList.includes(aType) ){\n            mType = aType;\n        }\n\n        if ( aClose ){\n            mClose = true;\n        }\n\n        var html = '<div class=\"alert alert-block alert-'+mType+' fade in\" data-alert=\"alert\">';\n        if ( mClose ){\n            html += '<a class=\"close\" data-dismiss=\"alert\" href=\"#\">×</a>';\n        }\n        html += '<p>'+aMessage+'</p>';\n        html += '</div>';\n\n        var elt = $(html);\n        $('#message').append(elt);\n\n        if (aTimeout) {\n            window.setTimeout(() => {\n                elt.remove();\n            }, aTimeout)\n        }\n\n        return elt;\n    }\n\n    /**\n     * PRIVATE function: exportVectorLayer\n     * @param aName\n     * @param eformat\n     * @param restrictToMapExtent\n     */\n    function exportVectorLayer( aName, eformat, restrictToMapExtent ) {\n\n        restrictToMapExtent = typeof restrictToMapExtent !== 'undefined' ?  restrictToMapExtent : null;\n\n        // right not set\n        if ( !('exportLayers' in lizMap.config.options) || lizMap.config.options.exportLayers != 'True' ) {\n            mAddMessage(lizDict['layer.export.right.required'],'error',true);\n            return false;\n        }\n\n        // Set function parameters if not given\n        eformat = typeof eformat !== 'undefined' ?  eformat : 'GeoJSON';\n\n        // Get selected features\n        var cleanName = lizMap.cleanName( aName );\n        var selectionLayer = getLayerNameByCleanName( cleanName );\n\n        if (!selectionLayer) {\n            selectionLayer = aName;\n        }\n\n        // Get the layer Lizmap configuration\n        var config_layer = lizMap.config.layers[selectionLayer];\n\n        // Check if the layer is spatial\n        const is_spatial = (\n            config_layer['geometryType'] && config_layer['geometryType'] != 'none' && config_layer != 'unknown'\n        ) ? true : false;\n\n        // Check if there is a selection token\n        const has_selection_token = (\n            'request_params' in config_layer && 'selectiontoken' in config_layer['request_params']\n        && config_layer['request_params']['selectiontoken'] != null\n        && config_layer['request_params']['selectiontoken'] != ''\n        ) ? true : false;\n\n        // Check for parenthesis inside the layer name\n        // There is a bug to be fixed in QGIS Server WFS request for this context\n        const parenthesis_regex = /[\\(\\)]/g;\n        const has_parenthesis = selectionLayer.match(parenthesis_regex);\n\n        // If there is a selection, use the selectiontoken,\n        // not a list of features ids to avoid to have too big urls\n        // There is some cases when we do not want to use the selection token\n        // * Layers with no selection token\n        // * Layers with parenthesis inside the layer name (Bug to be fixed in QGIS Server WFS request)\n        // * Layers with no geometry, because there is no request_params (as it is only for Openlayers layers)\n        if (is_spatial && has_selection_token && !has_parenthesis) {\n        // Get the WFS URL with no filter\n            var getFeatureUrlData = getVectorLayerWfsUrl( aName, null, null, null, restrictToMapExtent );\n            // Add the SELECTIONTOKEN parameter\n            var selection_token = config_layer['request_params']['selectiontoken'];\n            getFeatureUrlData['options']['SELECTIONTOKEN'] = selection_token;\n        } else {\n        // Get the WFS feature ids\n            var featureid = getVectorLayerSelectionFeatureIdsString( selectionLayer );\n            // Restrict the WFS URL for these IDS\n            var getFeatureUrlData = getVectorLayerWfsUrl( aName, null, featureid, null, restrictToMapExtent );\n        }\n\n        // Force download\n        getFeatureUrlData['options']['dl'] = 1;\n\n        // Set export format\n        getFeatureUrlData['options']['OUTPUTFORMAT'] = eformat;\n\n        // Download file\n        document.querySelectorAll('.exportLayer').forEach(el => el.disabled = true);\n        mAddMessage(lizDict['layer.export.started'], 'info', true).addClass('export-in-progress');\n        Utils.downloadFile(getFeatureUrlData['url'], getFeatureUrlData['options'], () => {\n            document.querySelectorAll('.exportLayer').forEach(el => el.disabled = false);\n            document.querySelector('#message .export-in-progress a').click();\n        });\n\n        return false;\n    }\n\n    /**\n     *\n     * @param aName\n     */\n    function getVectorLayerSelectionFeatureIdsString( aName ) {\n        var featureidParameter = '';\n        if( aName in config.layers && config.layers[aName]['selectedFeatures'] ){\n            var fids = [];\n\n            // Get WFS typename\n            var configLayer = config.layers[aName];\n            var typeName = aName.split(' ').join('_');\n            if ( 'shortname' in configLayer && configLayer.shortname != '' )\n                typeName = configLayer.shortname;\n\n            for( var id in configLayer['selectedFeatures'] ) {\n                fids.push( typeName + '.' + configLayer['selectedFeatures'][id] );\n            }\n            if( fids.length )\n                featureidParameter = fids.join();\n        }\n\n        return featureidParameter;\n    }\n\n    /**\n     *\n     * @param aName\n     * @param aFilter\n     * @param aFeatureId\n     * @param geometryName\n     * @param restrictToMapExtent\n     * @param startIndex\n     * @param maxFeatures\n     */\n    function getVectorLayerWfsUrl( aName, aFilter, aFeatureId, geometryName, restrictToMapExtent, startIndex, maxFeatures ) {\n        var getFeatureUrlData = {};\n\n        // Set function parameters if not given\n        aFilter = typeof aFilter !== 'undefined' ?  aFilter : null;\n        aFeatureId = typeof aFeatureId !== 'undefined' ?  aFeatureId : null;\n        geometryName = typeof geometryName !== 'undefined' ?  geometryName : null;\n        restrictToMapExtent = typeof restrictToMapExtent !== 'undefined' ?  restrictToMapExtent : false;\n        startIndex = typeof startIndex !== 'undefined' ?  startIndex : null;\n        maxFeatures = typeof maxFeatures !== 'undefined' ?  maxFeatures : null;\n\n        // Build WFS request parameters\n        if ( !(aName in config.layers) ) {\n            var qgisName = lizMap.getNameByCleanName(aName);\n            if ( !qgisName || !(qgisName in config.layers))\n                qgisName = lizMap.getNameByShortName(aName);\n            if ( !qgisName || !(qgisName in config.layers))\n                qgisName = lizMap.getNameByTypeName(aName);\n            if ( qgisName && (qgisName in config.layers)) {\n                aName = qgisName;\n            } else {\n                console.log('getVectorLayerWfsUrl: \"'+aName+'\" and \"'+qgisName+'\" not found in config');\n                return false;\n            }\n        }\n        var configLayer = config.layers[aName];\n        var typeName = aName.split(' ').join('_');\n        if ( 'shortname' in configLayer && configLayer.shortname != '' )\n            typeName = configLayer.shortname;\n        else if ( 'typename' in configLayer && configLayer.typename != '' )\n            typeName = configLayer.typename;\n\n        var wfsOptions = {\n            'SERVICE':'WFS'\n            ,'VERSION':'1.0.0'\n            ,'REQUEST':'GetFeature'\n            ,'TYPENAME':typeName\n            ,'OUTPUTFORMAT':'GeoJSON'\n        };\n\n        if( startIndex )\n            wfsOptions['STARTINDEX'] = startIndex;\n\n        if( maxFeatures )\n            wfsOptions['MAXFEATURES'] = maxFeatures;\n\n        var filterParam = [];\n\n        if( aFilter ){\n            // Remove layerName followed by :\n            aFilter = aFilter.replace( aName + ':', '');\n            if ( aFilter != '' )\n                filterParam.push( aFilter );\n        }else{\n            // If not filter passed, check if a filter does not exists for the layer\n            if( 'request_params' in config.layers[aName] && 'filter' in config.layers[aName]['request_params'] ){\n                var aFilter = config.layers[aName]['request_params']['filter'];\n                if( aFilter ){\n                    aFilter = aFilter.replace( aName + ':', '');\n                    filterParam.push( aFilter );\n                }\n            }\n        }\n\n        // optionnal parameter filterid or EXP_FILTER\n        if( aFeatureId )\n            wfsOptions['FEATUREID'] = aFeatureId.replace(new RegExp(aName, 'g'), typeName);\n        else if( filterParam.length )\n            wfsOptions['EXP_FILTER'] = filterParam.join( ' AND ' );\n\n\n        // Calculate bbox from map extent if needed\n        if( restrictToMapExtent ) {\n            const mapExtent = lizMap.mainLizmap.map.getView().calculateExtent();\n            const transformedExtent = lizMap.mainLizmap.transformExtent (\n                mapExtent,\n                lizMap.mainLizmap.map.getView().getProjection().getCode(),\n                config.layers[aName].crs\n            );\n            wfsOptions['BBOX'] = transformedExtent.join();\n        }\n\n        // Optionnal parameter geometryname\n        if( geometryName\n        && $.inArray( geometryName.toLowerCase(), ['none', 'extent', 'centroid'] ) != -1\n        ){\n            wfsOptions['GEOMETRYNAME'] = geometryName;\n        }\n\n        getFeatureUrlData['url'] = globalThis['lizUrls'].service;\n        getFeatureUrlData['options'] = wfsOptions;\n\n        return getFeatureUrlData;\n    }\n\n    /**\n     * storage for callbacks given to getFeatureData\n     *\n     * used to avoid multiple request for the same feature\n     * @type {{}}\n     */\n    var featureDataPool = {};\n\n    /**\n     *\n     * @param poolId\n     * @param features\n     */\n    function callFeatureDataCallBacks(poolId, features) {\n        var callbacksData = featureDataPool[poolId];\n        delete featureDataPool[poolId];\n        callbacksData.callbacks.forEach(function(callback) {\n            if (callback) {\n                callback(callbacksData.layerName, callbacksData.filter, features, callbacksData.alias, callbacksData.types);\n            }\n        });\n    }\n\n    /**\n     *\n     * @param aName\n     * @param aFilter\n     * @param aFeatureID\n     * @param aGeometryName\n     * @param restrictToMapExtent\n     * @param startIndex\n     * @param maxFeatures\n     * @param aCallBack\n     */\n    function getFeatureData(aName, aFilter, aFeatureID, aGeometryName, restrictToMapExtent, startIndex, maxFeatures, aCallBack) {\n        // Set function parameters if not given\n        aFilter = typeof aFilter !== 'undefined' ?  aFilter : null;\n        aFeatureID = typeof aFeatureID !== 'undefined' ? aFeatureID : null;\n        aGeometryName = typeof aGeometryName !== 'undefined' ? aGeometryName : null;\n        restrictToMapExtent = typeof restrictToMapExtent !== 'undefined' ?  restrictToMapExtent : false;\n        startIndex = typeof startIndex !== 'undefined' ?  startIndex : null;\n        maxFeatures = typeof maxFeatures !== 'undefined' ?  maxFeatures : null;\n\n        // get layer configs\n        if ( !(aName in config.layers) ) {\n            var qgisName = lizMap.getNameByCleanName(aName);\n            if ( !qgisName || !(qgisName in config.layers))\n                qgisName = lizMap.getNameByShortName(aName);\n            if ( !qgisName || !(qgisName in config.layers))\n                qgisName = lizMap.getNameByTypeName(aName);\n            if ( qgisName && (qgisName in config.layers)) {\n                aName = qgisName;\n            } else {\n                console.log('getFeatureData: \"'+aName+'\" and \"'+qgisName+'\" not found in config');\n                return false;\n            }\n        }\n        var aConfig = config.layers[aName];\n\n        $('body').css('cursor', 'wait');\n\n        var getFeatureUrlData = lizMap.getVectorLayerWfsUrl( aName, aFilter, aFeatureID, aGeometryName, restrictToMapExtent, startIndex, maxFeatures );\n\n        // see if a request for the same feature is not already made\n        var poolId = getFeatureUrlData['url'] + \"|\" + JSON.stringify(getFeatureUrlData['options']);\n        if (poolId in featureDataPool) {\n            // there is already a request, let's store our callback and wait...\n            if (aCallBack) {\n                featureDataPool[poolId].callbacks.push(aCallBack);\n            }\n            return;\n        }\n        // no request yet, let's do it and store the callback and its parameters\n        featureDataPool[poolId] = {\n            callbacks: [ aCallBack ],\n            layerName: aName,\n            filter: aFilter,\n            alias: aConfig['alias'],\n            types: aConfig['types']\n        };\n\n        const wfs = new WFS();\n        wfs.getFeature(getFeatureUrlData['options']).then(data => {\n            aConfig['featureCrs'] = 'EPSG:4326';\n\n            if (aConfig?.['alias'] && aConfig?.['types']) {\n                callFeatureDataCallBacks(poolId, data.features);\n                $('body').css('cursor', 'auto');\n            } else {\n                $.post(globalThis['lizUrls'].service, {\n                    'SERVICE':'WFS'\n                    ,'VERSION':'1.0.0'\n                    ,'REQUEST':'DescribeFeatureType'\n                    ,'TYPENAME': ('typename' in aConfig) ? aConfig.typename : aName\n                    ,'OUTPUTFORMAT':'JSON'\n                }, function(describe) {\n\n                    aConfig['alias'] = describe.aliases;\n                    aConfig['types'] = describe.types;\n                    aConfig['columns'] = describe.columns;\n\n                    callFeatureDataCallBacks(poolId, data.features);\n\n                    $('body').css('cursor', 'auto');\n\n                },'json');\n            }\n        });\n\n        // $.post( getFeatureUrlData['url'], getFeatureUrlData['options'], function(incomingData) {\n        //     const data = DOMPurify.sanitize(incomingData);\n\n        //     aConfig['featureCrs'] = 'EPSG:4326';\n\n        //     if (aConfig?.['alias'] && aConfig?.['types']) {\n        //         callFeatureDataCallBacks(poolId, data.features);\n        //         $('body').css('cursor', 'auto');\n        //     } else {\n        //         $.post(globalThis['lizUrls'].service, {\n        //             'SERVICE':'WFS'\n        //             ,'VERSION':'1.0.0'\n        //             ,'REQUEST':'DescribeFeatureType'\n        //             ,'TYPENAME': ('typename' in aConfig) ? aConfig.typename : aName\n        //             ,'OUTPUTFORMAT':'JSON'\n        //         }, function(describe) {\n\n        //             aConfig['alias'] = describe.aliases;\n        //             aConfig['types'] = describe.types;\n        //             aConfig['columns'] = describe.columns;\n\n        //             callFeatureDataCallBacks(poolId, data.features);\n\n        //             $('body').css('cursor', 'auto');\n\n        //         },'json');\n        //     }\n\n        // },'json');\n\n        return true;\n    }\n\n    /**\n     *\n     * @param feature\n     * @param proj\n     * @param zoomAction\n     */\n    function zoomToOlFeature( feature, proj, zoomAction ){\n        zoomAction = typeof zoomAction !== 'undefined' ?  zoomAction : 'zoom';\n        var format = new OpenLayers.Format.GeoJSON({\n            ignoreExtraDims: true\n        });\n        var feat = format.read(feature)[0];\n        if( feat && 'geometry' in feat ){\n            feat.geometry.transform( proj, lizMap.map.getProjection() );\n\n            // Zoom or center to selected feature\n            if( zoomAction == 'zoom' )\n                map.zoomToExtent(feat.geometry.getBounds());\n            if( zoomAction == 'center' ){\n                var lonlat = feat.geometry.getBounds().getCenterLonLat()\n                map.setCenter(lonlat);\n            }\n        }\n    }\n\n    /**\n     *\n     * @param featureType\n     * @param fid\n     * @param zoomAction\n     */\n    function zoomToFeature( featureType, fid, zoomAction ){\n        zoomAction = typeof zoomAction !== 'undefined' ?  zoomAction : 'zoom';\n\n        getLayerFeature(featureType, fid, function(feat) {\n            var proj = new OpenLayers.Projection(config.layers[featureType].crs);\n            if( config.layers[featureType].featureCrs )\n                proj = new OpenLayers.Projection(config.layers[featureType].featureCrs);\n            zoomToOlFeature( feat, proj, zoomAction );\n        });\n    }\n\n    /**\n     *\n     * @param featureType\n     * @param fid\n     * @param aCallback\n     * @param aCallbackNotfound\n     * @param forceToLoad\n     */\n    function getLayerFeature( featureType, fid, aCallback, aCallbackNotfound, forceToLoad ){\n        if ( !aCallback )\n            return;\n        if ( !(featureType in config.layers) )\n            return;\n\n        var layerConfig = config.layers[featureType];\n        var featureId = featureType + '.' + fid;\n\n        // Use already retrieved feature\n        if(!forceToLoad && layerConfig['features'] && fid in layerConfig['features'] ){\n            aCallback(layerConfig['features'][fid]);\n        }\n        // Or get the feature via WFS in needed\n        else{\n            getFeatureData(featureType, null, featureId, 'extent', false, null, null,\n                function( aName, aFilter, cFeatures, cAliases ){\n\n                    if (cFeatures.length == 1) {\n                        var feat = cFeatures[0];\n                        if( !layerConfig['features'] ) {\n                            layerConfig['features'] = {};\n                        }\n                        layerConfig['features'][fid] = feat;\n                        aCallback(feat);\n                    }\n                    else if(aCallbackNotfound) {\n                        aCallbackNotfound(featureType, fid);\n                    }\n                });\n        }\n    }\n\n    /**\n     *\n     */\n    function getVectorLayerFeatureTypes() {\n        if ( wfsCapabilities == null ){\n            return [];\n        }\n        return wfsCapabilities.getElementsByTagName('FeatureType');\n    }\n\n    /**\n     *\n     */\n    function getVectorLayerResultFormat() {\n        let formats = [];\n        if ( wfsCapabilities == null ){\n            return formats;\n        }else{\n            for (const format of wfsCapabilities.getElementsByTagName('ResultFormat')[0].children) {\n                formats.push(format.tagName);\n            }\n            return formats;\n        }\n    }\n\n\n    /**\n     *\n     * @param aName\n     * @param feat\n     * @param aCallback\n     */\n    function getFeaturePopupContent( aName, feat, aCallback) {\n        // Only use this function with callback\n        if ( !aCallback )\n            return;\n\n        // Only use when feat is set\n        if( !feat )\n            return false;\n\n        // Remove map popup to avoid confusion\n        if (lizMap.map.popups.length != 0)\n            lizMap.map.removePopup( lizMap.map.popups[0] );\n\n        // Get popup content by FILTER and not with virtual click on map\n        var filter = '';\n        var qgisName = aName;\n        if( lizMap.getLayerNameByCleanName(aName) ){\n            qgisName = lizMap.getLayerNameByCleanName(aName);\n        }\n\n        var layerConfig = null;\n        if (qgisName in lizMap.config.layers) {\n            layerConfig = lizMap.config.layers[qgisName];\n        }\n\n        if( !layerConfig )\n            return false;\n\n        var pkey = null;\n        // Get primary key with attributelayer options\n        if( (qgisName in lizMap.config.attributeLayers) ){\n            pkey = lizMap.config.attributeLayers[qgisName]['primaryKey'];\n        }\n\n\n        // Test if primary key is set in the atlas tool\n        // Atlas config with one layer (legacy)\n        if( !pkey && 'atlasLayer' in lizMap.config.options && 'atlasPrimaryKey' in lizMap.config.options ){\n            if( layerConfig.id == lizMap.config.options['atlasLayer'] && lizMap.config.options['atlasPrimaryKey'] != '' ){\n                pkey = lizMap.config.options['atlasPrimaryKey'];\n            }\n        }\n\n        // Atlas config with several layers (LWC >= 3.4)\n        if (!pkey && 'atlas' in lizMap.config && 'layers' in lizMap.config.atlas && Array.isArray(lizMap.config.atlas['layers']) && lizMap.config.atlas['layers'].length > 0) {\n            for (let index = 0; index < lizMap.config.atlas.layers.length; index++) {\n                const layer = lizMap.config.atlas.layers[index];\n                if (layerConfig.id === layer.layer){\n                    pkey = layer.primaryKey;\n                    break;\n                }\n            }\n        }\n\n        if( !pkey )\n            return false;\n\n        var pkVal = feat.properties[pkey];\n\n        const wmsName = layerConfig?.shortname || layerConfig?.name || qgisName;\n        filter = wmsName + ':\"' + pkey + '\" = ' + \"'\" + pkVal + \"'\" ;\n\n        var crs = 'EPSG:4326';\n        if(('crs' in lizMap.config.layers[qgisName]) && lizMap.config.layers[qgisName].crs != ''){\n            crs = lizMap.config.layers[qgisName].crs;\n        }\n\n        var wmsOptions = {\n            'LAYERS': wmsName\n            ,'QUERY_LAYERS': wmsName\n            ,'STYLES': ''\n            ,'SERVICE': 'WMS'\n            ,'VERSION': '1.3.0'\n            ,'CRS': crs\n            ,'REQUEST': 'GetFeatureInfo'\n            ,'EXCEPTIONS': 'application/vnd.ogc.se_inimage'\n            ,'INFO_FORMAT': 'text/html'\n            ,'FEATURE_COUNT': 1\n            ,'FILTER': filter\n        };\n\n        // Query the server\n        $.post(globalThis['lizUrls'].service, wmsOptions, function(data) {\n            aCallback(Utils.sanitizeGFIContent(data));\n        });\n    }\n\n    // Get the popup content for a layer given a feature\n    /**\n     *\n     * @param aName\n     * @param feat\n     * @param aCallback\n     */\n    function getFeaturePopupContentByFeatureIntersection(aName, feat, aCallback) {\n\n        // Calculate fake bbox around the feature\n        var units = lizMap.map.getUnits();\n        var lConfig = lizMap.config.layers[aName];\n        var minMapScale = lizMap.config.options.mapScales.at(0);\n        var scale = Math.max( minMapScale, lConfig.minScale ) * 2;\n        var maxMapScale = lizMap.config.options.mapScales.at(-1);\n        if (maxMapScale < lConfig.maxScale && scale > maxMapScale) {\n            scale =scale/2 + (maxMapScale-scale/2)/2;\n        } else if (scale > lConfig.maxScale) {\n            scale =scale/2 + (lConfig.maxScale-scale/2)/2\n        }\n\n        var res = OpenLayers.Util.getResolutionFromScale(scale, units);\n\n        var geomType = feat.geometry.CLASS_NAME;\n        if (\n            geomType == 'OpenLayers.Geometry.Polygon'\n      || geomType == 'OpenLayers.Geometry.MultiPolygon'\n      || geomType == 'OpenLayers.Geometry.Point'\n        ) {\n            var lonlat = feat.geometry.getBounds().getCenterLonLat()\n        }\n        else {\n            var vert = feat.geometry.getVertices();\n            var middlePoint = vert[Math.floor(vert.length/2)];\n            var lonlat = new OpenLayers.LonLat(middlePoint.x, middlePoint.y);\n        }\n\n        // Calculate fake bbox\n        var bbox = new OpenLayers.Bounds(\n            lonlat.lon - 5 * res,\n            lonlat.lat - 5 * res,\n            lonlat.lon + 5 * res,\n            lonlat.lat + 5 * res\n        );\n\n        var gfiCrs = lizMap.map.getProjectionObject().toString();\n        if ( gfiCrs == 'EPSG:900913' )\n            gfiCrs = 'EPSG:3857';\n\n        var wmsOptions = {\n            'LAYERS': aName\n            ,'QUERY_LAYERS': aName\n            ,'STYLES': ''\n            ,'SERVICE': 'WMS'\n            ,'VERSION': '1.3.0'\n            ,'REQUEST': 'GetFeatureInfo'\n            ,'EXCEPTIONS': 'application/vnd.ogc.se_inimage'\n            ,'BBOX': bbox.toBBOX()\n            ,'FEATURE_COUNT': 10\n            ,'HEIGHT': 100\n            ,'WIDTH': 100\n            ,'INFO_FORMAT': 'text/html'\n            ,'CRS': gfiCrs\n            ,'I': 50\n            ,'J': 50\n        };\n\n        // Query the server\n        $.post(globalThis['lizUrls'].service, wmsOptions, function(data) {\n            if (aCallback) {\n                aCallback(globalThis['lizUrls'].service, wmsOptions, Utils.sanitizeGFIContent(data));\n            }\n        });\n    }\n\n    // Create new dock or minidock\n    // Example : lizMap.addDock('mydock', 'My dock title', 'dock', 'Some content', 'icon-pencil');\n    // see icon list here : http://getbootstrap.com/2.3.2/base-css.html#icons\n    /**\n     *\n     * @param dname\n     * @param dlabel\n     * @param dtype\n     * @param dcontent\n     * @param dicon\n     */\n    function addDock( dname, dlabel, dtype, dcontent, dicon){\n        // First check if this dname already exists\n        if( $('#mapmenu .nav-list > li.'+dname+' > a').length ){\n            console.log(dname + ' menu item already exists');\n            return;\n        }\n\n        // Create menu icon for activating dock\n        var dockli = '';\n        dockli+='<li class=\"'+dname+' nav-'+dtype+'\">';\n        dockli+='   <a id=\"button-'+dname+'\" rel=\"tooltip\" data-original-title=\"'+dlabel+'\" data-placement=\"right\" href=\"#'+dname+'\" data-container=\"#content\">';\n        dockli += '       <span class=\"icon\"><i class=\"' + dicon + ' icon-white\"></i></span><span class=\"menu-title\">' + dname +'</span>';\n        dockli+='   </a>';\n        dockli+='</li>';\n        $('#mapmenu div ul li.nav-'+dtype+':last').after(dockli);\n        if ( $('#mapmenu div ul li.nav-'+dtype+'.'+dname).length == 0 )\n            $('#mapmenu div ul li:last').after(dockli);\n\n        //  Remove native lizmap icon\n        $('#mapmenu .nav-list > li.'+dname+' > a .icon').css('background-image','none');\n        $('#mapmenu .nav-list > li.'+dname+' > a .icon >i ').css('margin-left', '4px');\n\n        // Add tooltip\n        $('#mapmenu .nav-list > li.'+dname+' > a').tooltip();\n\n        // Create dock tab content\n        var docktab = '';\n        docktab+='<div class=\"tab-pane\" id=\"'+dname+'\">';\n        if( dtype == 'minidock'){\n            docktab+='<div class=\"mini-dock-close\" title=\"' + lizDict['toolbar.content.stop'] + '\" style=\"padding:7px;float:right;cursor:pointer;\"><i class=\"icon-remove icon-white\"></i></div>';\n            docktab+='    <div class=\"'+dname+'\">';\n            docktab+='        <h3>';\n            docktab+='            <span class=\"title\">';\n            docktab+='              <i class=\"'+dicon+' icon-white\"></i>';\n            docktab+='              <span class=\"text\">&nbsp;'+dlabel+'&nbsp;</span>';\n            docktab+='            </span>';\n            docktab+='        </h3>';\n        }\n        docktab+='        <div class=\"menu-content\">';\n        docktab+= dcontent;\n        docktab+='        </div>';\n        docktab+='    </div>';\n        docktab+='</div>';\n        if( dtype == 'minidock'){\n            $('#mini-dock-content').append(docktab);\n            $('#'+dname+' div.mini-dock-close').click(function(){\n                if( $('#mapmenu .nav-list > li.'+dname).hasClass('active') ){\n                    $('#button-'+dname).click();\n                }\n            });\n        }\n        else if( dtype == 'right-dock' )\n            $('#right-dock-content').append(docktab);\n        else if( dtype == 'dock' )\n            $('#dock-content').append(docktab);\n        else if( dtype == 'bottomdock' )\n            $('#bottom-dock-content').append(docktab);\n\n        // Create dock tab li\n        var docktabli = '';\n        docktabli+= '<li id=\"nav-tab-'+dname+'\"><a href=\"#'+dname+'\" data-toggle=\"tab\">'+dlabel+'</a></li>';\n        if( dtype == 'minidock')\n            $('#mini-dock-tabs').append(docktabli);\n        else if( dtype == 'right-dock' )\n            $('#right-dock-tabs').append(docktabli);\n        else if( dtype == 'dock' )\n            $('#dock-tabs').append(docktabli);\n        else if( dtype == 'bottomdock' )\n            $('#bottom-dock-tabs').append(docktabli);\n\n    }\n\n    /**\n     * PRIVATE function: getFeatureInfoTolerances\n     * Get tolerances for point, line and polygon\n     * as configured with lizmap plugin, or default\n     * if no configuration found.\n     * Returns:\n     * {Object} The tolerances for point, line and polygon\n     */\n    function getFeatureInfoTolerances(){\n\n        var tolerances = defaultGetFeatureInfoTolerances;\n        if( 'pointTolerance' in config.options\n        && 'lineTolerance' in config.options\n        && 'polygonTolerance' in config.options\n        ){\n            tolerances = {\n                'FI_POINT_TOLERANCE': config.options.pointTolerance,\n                'FI_LINE_TOLERANCE': config.options.lineTolerance,\n                'FI_POLYGON_TOLERANCE': config.options.polygonTolerance\n            };\n        }\n        return tolerances;\n\n    }\n\n    /* PRIVATE function: isHighDensity\n   * Return True when the screen is of high density\n   * Returns:\n   * Boolean\n   */\n    /**\n     *\n     */\n    function isHighDensity(){\n        return ((window.matchMedia && (window.matchMedia('only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)').matches || window.matchMedia('only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)').matches)) || (window.devicePixelRatio && window.devicePixelRatio > 1.3));\n    }\n\n    /**\n     *\n     * @param layername\n     */\n    function deactivateMaplayerFilter (layername) {\n        let layer = lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(layername);\n        layer.expressionFilter = null;\n\n        // Remove layer filter\n        if( !('request_params' in config.layers[layername]) ){\n            config.layers[layername]['request_params'] = {};\n        }\n        config.layers[layername]['request_params']['exp_filter'] = null;\n        config.layers[layername]['request_params']['filtertoken'] = null;\n        config.layers[layername]['request_params']['filter'] = null;\n    }\n\n    /**\n     *\n     * @param layername\n     * @param filter\n     */\n    function triggerLayerFilter (layername, filter) {\n        // Get layer information\n        const layer = lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(layername);\n        const layerWmsName = layer.wmsName;\n\n        // Add filter to the layer\n        if( !filter || filter == ''){\n            filter = null;\n            var lfilter = null;\n\n        }else{\n            var lfilter = layerWmsName + ':' + filter;\n        }\n\n        if( !('request_params' in config.layers[layername]) ){\n            config.layers[layername]['request_params'] = {};\n        }\n\n        // Add WFS exp_filter param\n        config.layers[layername]['request_params']['exp_filter'] = filter;\n\n        // Get WMS filter token ( used via GET in GetMap or GetPrint )\n        fetch(globalThis['lizUrls'].service, {\n            method: \"POST\",\n            body: new URLSearchParams({\n                service: 'WMS',\n                request: 'GETFILTERTOKEN',\n                typename: layername,\n                filter: lfilter\n            })\n        }).then(response => {\n            return response.json();\n        }).then(result => {\n            var filtertoken = result.token;\n            // Add OpenLayers layer parameter\n            config.layers[layername]['request_params']['filtertoken'] = filtertoken;\n\n            // Update layer state\n            lizMap.mainLizmap.state.layersAndGroupsCollection.getLayerByName(layername).filterToken = {\n                expressionFilter: config.layers[layername]['request_params']['exp_filter'],\n                token: result.token\n            };\n\n\n            // Tell popup to be aware of the filter\n            lizMap.events.triggerEvent(\"layerFilterParamChanged\",\n                {\n                    'featureType': layername,\n                    'filter': lfilter,\n                    'updateDrawing': false\n                }\n            );\n        });\n\n        return true;\n    }\n\n    // creating the lizMap object\n    var obj = {\n    /**\n     * Property: map\n     * {<OpenLayers.Map>} The map\n     */\n        map: null,\n        /**\n         * Property: layers\n         * {Array(<OpenLayers.Layer>)} The layers\n         */\n        layers: null,\n        /**\n         * Property: baselayers\n         * {Array(<OpenLayers.Layer>)} The base layers\n         */\n        baselayers: null,\n        /**\n         * Property: events\n         * {<OpenLayers.Events>} An events object that handles all\n         *                       events on the lizmap\n         */\n        events: null,\n        /**\n         * Property: config\n         * {Object} The map config\n         */\n        config: null,\n        /**\n         * Property: dictionnary\n         * {Object} The map dictionnary\n         */\n        dictionary: null,\n        /**\n         * Property: tree\n         * {Object} The map tree\n         */\n        tree: null,\n        /**\n         * Property: lizmapLayerFilterActive\n         * {Object} Contains main filtered layer if filter is active\n         */\n        lizmapLayerFilterActive: null,\n\n        /**\n         * Method: getLizmapDesktopPluginMetadata\n         */\n        getLizmapDesktopPluginMetadata: function() {\n            return getLizmapDesktopPluginMetadata();\n        },\n\n        /**\n         * Method: checkMobile\n         */\n        checkMobile: function() {\n            return mCheckMobile();\n        },\n\n        /**\n         * Method: cleanName\n         * @param aName\n         */\n        cleanName: function( aName ) {\n            return cleanName( aName );\n        },\n\n        /**\n         * Method: getNameByCleanName\n         * @param cleanName\n         */\n        getNameByCleanName: function( cleanName ) {\n            return getNameByCleanName( cleanName );\n        },\n\n        /**\n         * Method: getNameByShortName\n         * @param shortName\n         */\n        getNameByShortName: function( shortName ) {\n            return getNameByShortName( shortName );\n        },\n\n        /**\n         * Method: getNameByTypeName\n         * @param typeName\n         */\n        getNameByTypeName: function( typeName ) {\n            return getNameByTypeName( typeName );\n        },\n\n        /**\n         * Method: getLayerNameByCleanName\n         * @param cleanName\n         */\n        getLayerNameByCleanName: function( cleanName ) {\n            return getLayerNameByCleanName( cleanName );\n        },\n\n        /**\n         * Method: addMessage\n         * @param aMessage\n         * @param aType\n         * @param aClose\n         * @param aTimeout\n         */\n        addMessage: function( aMessage, aType, aClose, aTimeout ) {\n            return mAddMessage( aMessage, aType, aClose, aTimeout );\n        },\n\n        /**\n         * Method: transformBounds\n         * @param aCRS\n         * @param aCallback\n         */\n        loadProjDefinition: function( aCRS, aCallback ) {\n            return loadProjDefinition( aCRS, aCallback );\n        },\n\n        /**\n         * Method: updateContentSize\n         */\n        updateContentSize: function() {\n            return updateContentSize();\n        },\n\n        /**\n         * Method: clearDrawLayer\n         * @param layerName\n         */\n        clearDrawLayer: function(layerName) {\n            return clearDrawLayer(layerName);\n        },\n\n        /**\n         * Method: getLayerFeature\n         * @param featureType\n         * @param fid\n         * @param aCallback\n         * @param aCallbackNotfound\n         * @param forceToLoad\n         */\n        getLayerFeature: function( featureType, fid, aCallback, aCallbackNotfound, forceToLoad ) {\n            getLayerFeature( featureType, fid, aCallback, aCallbackNotfound, forceToLoad );\n        },\n\n        /**\n         * Method: getFeatureData\n         * @param aName\n         * @param aFilter\n         * @param aFeatureID\n         * @param aGeometryName\n         * @param restrictToMapExtent\n         * @param startIndex\n         * @param maxFeatures\n         * @param aCallBack\n         */\n        getFeatureData: function(aName, aFilter, aFeatureID, aGeometryName, restrictToMapExtent, startIndex, maxFeatures, aCallBack) {\n            getFeatureData(aName, aFilter, aFeatureID, aGeometryName, restrictToMapExtent, startIndex, maxFeatures, aCallBack);\n        },\n\n        /**\n         * Method: translateWfsFieldValues\n         * @param aName\n         * @param fieldName\n         * @param fieldValue\n         * @param translation_dict\n         */\n        translateWfsFieldValues: function(aName, fieldName, fieldValue, translation_dict) {\n            return translateWfsFieldValues(aName, fieldName, fieldValue, translation_dict);\n        },\n\n        /**\n         * Method: zoomToFeature\n         * @param featureType\n         * @param fid\n         * @param zoomAction\n         */\n        zoomToFeature: function( featureType, fid, zoomAction ) {\n            zoomToFeature( featureType, fid, zoomAction );\n        },\n\n        /**\n         * Method: getExternalBaselayersReplacement\n         */\n        getExternalBaselayersReplacement: function() {\n            return externalBaselayersReplacement;\n        },\n\n        launchEdition: function() {\n            return false;\n        },\n\n        deleteEditionFeature: function(){\n            return false;\n        },\n\n        deactivateToolControls: function( evt ) {\n            return deactivateToolControls( evt );\n        },\n\n        displayGetFeatureInfo: function( text, xy, coordinate ) {\n            return displayGetFeatureInfo( text, xy, coordinate );\n        },\n\n        /**\n         * Method: exportVectorLayer\n         * @param aName\n         * @param eformat\n         * @param restrictToMapExtent\n         */\n        exportVectorLayer: function( aName, eformat, restrictToMapExtent ) {\n            return exportVectorLayer( aName, eformat, restrictToMapExtent );\n        },\n\n        /**\n         * Method: getVectorLayerWfsUrl\n         * @param aName\n         * @param aFilter\n         * @param aFeatureId\n         * @param geometryName\n         * @param restrictToMapExtent\n         */\n        getVectorLayerWfsUrl: function( aName, aFilter, aFeatureId, geometryName, restrictToMapExtent ) {\n            return getVectorLayerWfsUrl( aName, aFilter, aFeatureId, geometryName, restrictToMapExtent );\n        },\n\n        /**\n         * Method: getVectorLayerFeatureType\n         * @returns {Array} Array of FeatureType Elements\n         */\n        getVectorLayerFeatureTypes: function() {\n            return getVectorLayerFeatureTypes();\n        },\n\n        /**\n         * Method: getVectorLayerResultFormat\n         * @returns {string[]} Array of format for file export\n         */\n        getVectorLayerResultFormat: function() {\n            return getVectorLayerResultFormat();\n        },\n\n        /**\n         * Method: getLayerConfigById\n         * @param aLayerId\n         * @param aConfObjet\n         * @param aIdAttribute\n         */\n        getLayerConfigById: function( aLayerId, aConfObjet, aIdAttribute ) {\n            return getLayerConfigById( aLayerId, aConfObjet, aIdAttribute );\n        },\n\n        /**\n         * Method: getFeaturePopupContent\n         * @param aName\n         * @param feat\n         * @param aCallback\n         */\n        getFeaturePopupContent: function( aName, feat, aCallback) {\n            return getFeaturePopupContent(aName, feat, aCallback);\n        },\n\n        /**\n         * Method: getFeaturePopupContentByFeatureIntersection\n         * @param aName\n         * @param feat\n         * @param aCallback\n         */\n        getFeaturePopupContentByFeatureIntersection: function( aName, feat, aCallback) {\n            return getFeaturePopupContentByFeatureIntersection(aName, feat, aCallback);\n        },\n\n        /**\n         * Method: addGeometryFeatureInfo\n         * @param popup\n         * @param containerId\n         */\n        addGeometryFeatureInfo: function(popup, containerId){\n            return addGeometryFeatureInfo(popup, containerId);\n        },\n\n        /**\n         * Method: addChildrenFeatureInfo\n         * @param popup\n         * @param containerId\n         */\n        addChildrenFeatureInfo: function(popup, containerId){\n            return addChildrenFeatureInfo(popup, containerId);\n        },\n\n        /**\n         * Method: addChildrenDatavizFilteredByPopupFeature\n         * @param popup\n         * @param containerId\n         */\n        addChildrenDatavizFilteredByPopupFeature: function(popup, containerId){\n            return addChildrenDatavizFilteredByPopupFeature(popup, containerId);\n        },\n\n        /**\n         * Method: addDock\n         * @param dname\n         * @param dlabel\n         * @param dtype\n         * @param dcontent\n         * @param dicon\n         */\n        addDock: function( dname, dlabel, dtype, dcontent, dicon){\n            return addDock(dname, dlabel, dtype, dcontent, dicon);\n        },\n\n        /**\n         * Method: getHashParamFromUrl\n         * Utility function to get searched key in URL's hash\n         * @param {string} hash_key - searched key in hash\n         * @returns {string} value for searched key\n         * @example\n         * URL: https://liz.map/index.php/view/map/?repository=demo&project=cats#fid:v_cat20180426181713938.16,other_param:foo\n         * console.log(getHashParamFromUrl('fid'))\n         * returns 'v_cat20180426181713938.16'\n         */\n        getHashParamFromUrl: function (hash_key) {\n            var ret_val = null;\n            var hash = location.hash.replace('#', '');\n            var hash_items = hash.split(',');\n            for (var i in hash_items) {\n                var item = hash_items[i];\n                var param = item.split(':');\n                if (param.length == 2) {\n                    var key = param[0];\n                    var val = param[1];\n                    if (key == hash_key) {\n                        return val;\n                    }\n                }\n            }\n            return ret_val;\n        },\n\n\n        /**\n         * Apply the global filter on a OpenLayer layer\n         * Only used by filter.js and timemanager.js\n         * @param layername\n         * @param filter\n         */\n        triggerLayerFilter: function (layername, filter) {\n            return triggerLayerFilter(layername, filter);\n        },\n\n        /**\n         * Deactivate the global filter on a OpenLayer layer\n         * Only used by filter.js and timemanager.js\n         * @param layername\n         */\n        deactivateMaplayerFilter: function (layername) {\n            // Get layer information\n            return deactivateMaplayerFilter(layername);\n        },\n\n        /**\n         * Method: init\n         */\n        init: function() {\n            // Initialize global variables\n            const lizmapVariablesJSON = document.getElementById('lizmap-vars')?.innerText;\n            if (lizmapVariablesJSON) {\n                try {\n                    const lizmapVariables = JSON.parse(lizmapVariablesJSON);\n                    for (const variable in lizmapVariables) {\n                        globalThis[variable] = lizmapVariables[variable];\n                    }\n                } catch {\n                    console.warn('JSON for Lizmap global variables is not valid!');\n                }\n            }\n\n            var self = this;\n\n            // Get config\n            const configRequest = fetch(globalThis['lizUrls'].config + '?' + new URLSearchParams(globalThis['lizUrls'].params)).then(function (response) {\n                if (!response.ok) {\n                    throw 'Config not loaded: ' + response.status + ' ' + response.statusText\n                }\n                return response.json()\n            });\n\n            // Get key/value config\n            const keyValueConfigRequest = fetch(globalThis['lizUrls'].keyValueConfig + '?' + new URLSearchParams(globalThis['lizUrls'].params)).then(function (response) {\n                if (!response.ok) {\n                    throw 'Key/value config not loaded: ' + response.status + ' ' + response.statusText\n                }\n                return response.json()\n            });\n\n            // Get WMS, WMTS, WFS capabilities\n            const WMSRequest = fetch(globalThis['lizUrls'].service + '&' + new URLSearchParams({ SERVICE: 'WMS', REQUEST: 'GetCapabilities', VERSION: '1.3.0' })).then(function (response) {\n                if (!response.ok) {\n                    throw 'WMS GetCapabilities not loaded: ' + response.status + ' ' + response.statusText\n                }\n                return response.text()\n            });\n            const WMTSRequest = fetch(globalThis['lizUrls'].service + '&' + new URLSearchParams({ SERVICE: 'WMTS', REQUEST: 'GetCapabilities', VERSION: '1.0.0' })).then(function (response) {\n                if (!response.ok) {\n                    throw 'WMTS GetCapabilities not loaded: ' + response.status + ' ' + response.statusText\n                }\n                return response.text()\n            });\n            const WFSRequest = fetch(globalThis['lizUrls'].service + '&' + new URLSearchParams({ SERVICE: 'WFS', REQUEST: 'GetCapabilities', VERSION: '1.0.0' })).then(function (response) {\n                if (!response.ok) {\n                    throw 'WFS GetCapabilities not loaded: ' + response.status + ' ' + response.statusText\n                }\n                return response.text()\n            });\n\n            // Get feature extent if defined in URL\n            let featureExtentRequest;\n            // Get feature info if defined in URL\n            let getFeatureInfoRequest;\n            let getFeatureInfo;\n\n            const urlParameters = (new URL(document.location)).searchParams;\n\n            const layerName = urlParameters.get('layer');\n            const filter = urlParameters.get('filter');\n\n            if(layerName && filter){\n\n                // Feature extent\n                const wfs = new WFS();\n                const wfsParams = {\n                    TYPENAME: layerName,\n                    EXP_FILTER: filter\n                };\n\n                featureExtentRequest = wfs.getFeature(wfsParams);\n\n                // Feature info\n                if(urlParameters.get('popup') === 'true'){\n                    const wms = new WMS();\n                    const wmsParams = {\n                        QUERY_LAYERS: layerName,\n                        LAYERS: layerName,\n                        FEATURE_COUNT: 50, // TODO: get this value from config after it has been loaded?\n                        FILTER: `${layerName}:${filter}`,\n                    };\n\n                    getFeatureInfoRequest = wms.getFeatureInfo(wmsParams);\n                }\n            }\n\n            // Request config and capabilities in parallel\n            Promise.allSettled([\n                configRequest,\n                keyValueConfigRequest,\n                WMSRequest,\n                WMTSRequest,\n                WFSRequest,\n                featureExtentRequest,\n                getFeatureInfoRequest,\n            ]).then(async (responses) => {\n                // Raise an error when one those required requests fails\n                // Other requests can fail silently\n                const requiredRequests = [responses[0], responses[2], responses[3], responses[4]];\n\n                for (const request of requiredRequests) {\n                    if (request.status === \"rejected\") {\n                        throw new Error(request.reason);\n                    }\n                }\n\n                // `config` is defined globally\n                config = responses[0].value;\n                keyValueConfig = responses[1].value;\n                const wmsCapaData = responses[2].value;\n                const wmtsCapaData = responses[3].value;\n                const wfsCapaData = responses[4].value;\n                let featuresExtent = responses[5].value?.features?.[0]?.bbox;\n                let startupFeatures = responses[5].value?.features;\n\n                if(featuresExtent){\n                    for (const feature of startupFeatures) {\n                        featuresExtent = extend(featuresExtent, feature.bbox);\n                    }\n                }\n\n                /**\n                 * mainLizmap is loaded in another JS file\n                 * and could not be available when `configsloaded` is fired\n                 * in this case all the Lizmap is not build\n                 * to be sur mainLizmap is ready when `configsloaded` is fired\n                 * we have to wait until `lizMap.mainLizmap` is not `undefined`\n                 */\n\n                // sleep Promise\n                let sleep = ms => new Promise(r => setTimeout(r, ms));\n                // sleep step first value the *2\n                let sleepStep = 100;\n                // max wait to 10 seconds\n                const maxWait = 10000;\n                // waitFor function returns waiting time in milliseconds\n                let waitFor = async function waitFor(f){\n                    let waitingTime = 0;\n                    while(waitingTime < maxWait && !f()) {\n                        await sleep(sleepStep);\n                        waitingTime += sleepStep;\n                        sleepStep *= 2;\n                    }\n                    return waitingTime;\n                };\n                // wait until lizMap.mainLizmap is not undefined\n                // lizMap.mainLizmap is defined when configsloaded is fired\n                const waitingFor = await waitFor(() => {\n                    self.events.triggerEvent(\"configsloaded\", {\n                        initialConfig: config,\n                        wmsCapabilities: wmsCapaData,\n                        wmtsCapabilities: wmtsCapaData,\n                        wfsCapabilities: wfsCapaData,\n                        startupFeatures: responses[5].value,\n                    });\n                    return self.mainLizmap !== undefined;\n                });\n                // lizMap.mainLizmap is still undefined\n                if (self.mainLizmap === undefined) {\n                    throw new Error('Until we wait '+waitingFor+' ms, mainLizmap has not been loaded!');\n                }\n\n                getFeatureInfo = responses[6].value;\n\n                const domparser = new DOMParser();\n\n                config.options.hasOverview = false;\n\n                // store layerIDs\n                if ('useLayerIDs' in config.options && config.options.useLayerIDs == 'True') {\n                    for (var layerName in config.layers) {\n                        var configLayer = config.layers[layerName];\n                        layerIdMap[configLayer.id] = layerName;\n                    }\n                }\n                // store shortnames and shortnames\n                for (var layerName in config.layers) {\n                    var configLayer = config.layers[layerName];\n                    if ('shortname' in configLayer && configLayer.shortname != '')\n                        shortNameMap[configLayer.shortname] = layerName;\n                    configLayer.cleanname = cleanName(layerName);\n                }\n\n                // Parse WMS capabilities\n                const wmsFormat =  new OpenLayers.Format.WMSCapabilities({version:'1.3.0'});\n                capabilities = wmsFormat.read(wmsCapaData);\n\n                if (!capabilities.capability) {\n                    throw 'WMS Capabilities error';\n                }\n\n                // Parse WMTS capabilities\n                const wmtsFormat = new OpenLayers.Format.WMTSCapabilities({});\n                wmtsCapabilities = wmtsFormat.read(wmtsCapaData);\n                if ('exceptionReport' in wmtsCapabilities) {\n                    var wmtsElem = $('#metadata-wmts-getcapabilities-url');\n                    if (wmtsElem.length != 0) {\n                        wmtsElem.before('<i title=\"' + wmtsCapabilities.exceptionReport.exceptions[0].texts[0] + '\" class=\"icon-warning-sign\"></i>&nbsp;');\n                    }\n                    wmtsCapabilities = null;\n                }\n                self.wmtsCapabilities = wmtsCapaData;\n\n                // Parse WFS capabilities\n                wfsCapabilities = domparser.parseFromString(wfsCapaData, \"application/xml\");\n                var featureTypes = getVectorLayerFeatureTypes();\n\n                for (const featureType of featureTypes) {\n                    var typeName = featureType.getElementsByTagName('Name')[0].textContent;\n                    var layerName = lizMap.getNameByTypeName(typeName);\n                    if (!layerName) {\n                        if (typeName in config.layers)\n                            layerName = typeName\n                        else if ((typeName in shortNameMap) && (shortNameMap[typeName] in config.layers))\n                            layerName = shortNameMap[typeName];\n                        else {\n                            for (var l in config.layers) {\n                                if (l.split(' ').join('_') == typeName) {\n                                    layerName = l;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n\n                    if (!(layerName in config.layers))\n                        continue;\n\n                    var configLayer = config.layers[layerName];\n                    configLayer.typename = typeName;\n                    typeNameMap[typeName] = layerName;\n                }\n\n                //set title and abstract coming from capabilities\n                $('#abstract').html(capabilities.abstract ? capabilities.abstract : '');\n\n                // get and analyse tree\n                var capability = capabilities.capability;\n\n                // Copy QGIS project's projection\n                config.options.qgisProjectProjection = Object.assign({}, config.options.projection);\n\n                // Add the config in self here to be able\n                // to let the JS external script modify some plugin cfg layers properties\n                // before Lizmap will create the layer tree\n                self.config = config;\n                /**\n                 * Event when the tree is going to be created\n                 * @event beforetreecreated\n                 */\n                self.events.triggerEvent(\"beforetreecreated\", self);\n                buildNativeScales();\n\n                var firstLayer = capability.nestedLayers[0];\n\n                // Re-save the config in self\n                self.config = config;\n                self.keyValueConfig = keyValueConfig;\n\n                // create the map\n                initProjections(firstLayer);\n                createMap(featuresExtent);\n                self.map = map;\n                self.layers = layers;\n                self.baselayers = baselayers;\n                self.controls = controls;\n                /**\n                 * Event when the map has been created\n                 * @event mapcreated\n                 */\n                self.events.triggerEvent(\"mapcreated\", self);\n\n                // Add empty baselayer as needed by OL2 map\n                if (baselayers.length === 0) {\n                    // hide elements for baselayers\n                    map.addLayer(new OpenLayers.Layer.Vector('baselayer',{\n                        maxExtent:map.maxExtent\n                        ,maxScale: map.maxScale\n                        ,minScale: map.minScale\n                        ,numZoomLevels: map.numZoomLevels\n                        ,scales: map.scales\n                        ,projection: map.projection\n                        ,units: map.projection.proj.units\n                    }));\n                }\n\n                if ('locateByLayer' in config) {\n                    addLocateByLayer();\n                }\n\n                /**\n                 * Event when layers have been added\n                 * @event layersadded\n                 */\n                self.events.triggerEvent(\"layersadded\", self);\n\n\n                // Verifying z-index\n                var lastLayerZIndex = map.layers[map.layers.length - 1].getZIndex();\n                if (lastLayerZIndex > map.Z_INDEX_BASE['Feature'] - 100) {\n                    map.Z_INDEX_BASE['Feature'] = lastLayerZIndex + 100;\n                    map.Z_INDEX_BASE['Popup'] = map.Z_INDEX_BASE['Feature'] + 25;\n                    if (map.Z_INDEX_BASE['Popup'] > map.Z_INDEX_BASE['Control'] - 25)\n                        map.Z_INDEX_BASE['Control'] = map.Z_INDEX_BASE['Popup'] + 25;\n                }\n\n                // initialize the map\n                // Set map extent depending on options\n                if (!map.getCenter()) {\n                    map.zoomToExtent(map.initialExtent, map.zoomToClosest);\n                }\n\n                updateContentSize();\n                map.events.triggerEvent(\"zoomend\", { \"zoomChanged\": true });\n\n                // create toolbar\n                createToolbar();\n                self.events.triggerEvent(\"toolbarcreated\", self);\n\n                // Toggle locate\n                $('#mapmenu ul').on('click', 'li.nav-minidock > a', function () {\n                    var self = $(this);\n                    var parent = self.parent();\n                    var id = self.attr('href').substr(1);\n                    var tab = $('#nav-tab-' + id);\n                    if (parent.hasClass('active')) {\n                        $('#' + id).removeClass('active');\n                        tab.removeClass('active');\n                        parent.removeClass('active');\n                        lizMap.events.triggerEvent(\"minidockclosed\", { 'id': id });\n                    } else {\n                        var oldActive = $('#mapmenu li.nav-minidock.active');\n                        if (oldActive.length != 0) {\n                            oldActive.removeClass('active');\n                            lizMap.events.triggerEvent(\"minidockclosed\", { 'id': oldActive.children('a').first().attr('href').substr(1) });\n                        }\n                        tab.children('a').first().click();\n                        parent.addClass('active');\n                        lizMap.events.triggerEvent(\"minidockopened\", { 'id': id });\n                    }\n                    self.blur();\n\n                    return false;\n                });\n\n                // Show locate by layer\n                if (!('locateByLayer' in config))\n                    $('#button-locate').parent().hide();\n                else\n                    $('#button-locate').click();\n\n                // hide mini-dock if no tool is active\n                if ($('#mapmenu ul li.nav-minidock.active').length == 0) {\n                    $('#mini-dock-content > .tab-pane.active').removeClass('active');\n                    $('#mini-dock-tabs li.active').removeClass('active');\n                }\n\n                $('#mapmenu ul').on('click', 'li.nav-dock > a', function () {\n                    var self = $(this);\n                    var parent = self.parent();\n                    var id = self.attr('href').substr(1);\n                    var tab = $('#nav-tab-' + id);\n                    var lizmapEvent = '';\n                    if (parent.hasClass('active')) {\n                        $('#' + id).removeClass('active');\n                        tab.removeClass('active');\n                        parent.removeClass('active');\n                        lizmapEvent = 'dockclosed';\n                    } else {\n                        var oldActive = $('#mapmenu li.nav-dock.active');\n                        if (oldActive.length != 0) {\n                            oldActive.removeClass('active');\n                            lizMap.events.triggerEvent(\"dockclosed\", { 'id': oldActive.children('a').first().attr('href').substr(1) });\n                        }\n                        tab.show();\n                        tab.children('a').first().click();\n                        parent.addClass('active');\n                        lizmapEvent = 'dockopened';\n                    }\n                    self.blur();\n\n                    var dock = $('#dock');\n                    if ($('#dock-tabs .active').length == 0)\n                        dock.hide();\n                    else if (!dock.is(':visible'))\n                        dock.show();\n\n                    // trigger event\n                    if (lizmapEvent != '')\n                        lizMap.events.triggerEvent(lizmapEvent, { 'id': id });\n\n                    return false;\n                });\n\n                $('#mapmenu ul').on('click', 'li.nav-right-dock > a', function () {\n                    var self = $(this);\n                    var parent = self.parent();\n                    var id = self.attr('href').substr(1);\n                    var tab = $('#nav-tab-' + id);\n                    var lizmapEvent = '';\n                    if (parent.hasClass('active')) {\n                        $('#' + id).removeClass('active');\n                        tab.removeClass('active');\n                        parent.removeClass('active');\n                        var lizmapEvent = 'rightdockclosed';\n                    } else {\n                        var oldActive = $('#mapmenu li.nav-right-dock.active');\n                        if (oldActive.length != 0) {\n                            oldActive.removeClass('active');\n                            lizMap.events.triggerEvent(\"rightdockclosed\", { 'id': oldActive.children('a').first().attr('href').substr(1) });\n                        }\n                        tab.show();\n                        tab.children('a').first().click();\n                        parent.addClass('active');\n                        var lizmapEvent = 'rightdockopened';\n                    }\n                    self.blur();\n\n                    var dock = $('#right-dock');\n                    if ($('#right-dock-tabs .active').length == 0) {\n                        dock.hide();\n                        $('#content').removeClass('right-dock-visible');\n                        updateContentSize();\n                    } else if (!dock.is(':visible')) {\n                        $('#content').addClass('right-dock-visible');\n                        dock.show();\n                        updateContentSize();\n                    }\n\n                    // trigger event\n                    if (lizmapEvent != '')\n                        lizMap.events.triggerEvent(lizmapEvent, { 'id': id });\n                    return false;\n                });\n\n                // Toggle menu visibility\n                $('#menuToggle').click(function(){\n                    $(this).toggleClass('opened');\n                });\n\n                // Hide mapmenu when menu item is clicked in mobile context\n                $('#menuToggle:visible ~ #mapmenu ul').on('click', 'li > a', function () {\n                    $('#menuToggle').removeClass('opened');\n                });\n\n                // Show layer switcher\n                $('#button-switcher').click();\n                updateContentSize();\n\n                $('#headermenu .navbar-inner .nav a[rel=\"tooltip\"]').tooltip();\n                $('#mapmenu .nav a[rel=\"tooltip\"]').tooltip();\n                self.events.triggerEvent(\"uicreated\", self);\n            })\n                .catch((error) => {\n                    console.error(error);\n                    // Generic error message\n                    let errorMsg = `\n          <p class=\"error-msg\">\n          ${lizDict['startup.error']}<br>\n          `;\n                if (document.body.dataset.lizmapAdminUser == 1) {\n                    // The user is an administrator, we add more infos and buttons.\n                    if (document.body.dataset.lizmapUserDefinedJsCount > 0) {\n                         errorMsg += `${lizDict['startup.user_defined_js']}<br>\n\n                            <a href=\"${globalThis['lizUrls'].repositoryAdmin}\"><button class=\"btn btn-primary\" type=\"button\">${lizDict['startup.goToRepositoryAdmin']}</button></a>\n                            <a href=\"`+ window.location+`&no_user_defined_js=1\"><button class=\"btn btn-primary\" type=\"button\">${lizDict['startup.projectWithoutJSLink']}</button></a>\n                    `;\n                    } else {\n                        // No additional JavaScript, but still failing, we propose the developer tools :/\n                        errorMsg += `${lizDict['startup.error.developer.tools']}<br>`;\n                    }\n                    // If the flag no_user_defined_js=1, we could give more info ?\n                } else {\n                    // The user is not an administrator, we invite the admin, and button to get back home\n                    errorMsg += `${lizDict['startup.error.administrator']}<br>`;\n                }\n                    errorMsg += `<a href=\"${globalThis['lizUrls'].basepath}\"><button class=\"btn btn-primary\" type=\"button\">${lizDict['startup.goToProject']}</button></a>`;\n                    errorMsg += `</p>`;\n                    document.getElementById('header').insertAdjacentHTML('afterend', errorMsg);\n                })\n                .finally(() => {\n                    $('body').css('cursor', 'auto');\n                    $('#loading').dialog('close');\n\n                    // Display getFeatureInfo if requested\n                    if(getFeatureInfo){\n                        displayGetFeatureInfo(getFeatureInfo,\n                            {\n                                x: map.size.w / 2,\n                                y: map.size.h / 2\n                            });\n                    }\n                });\n        }\n    };\n    // initializing the lizMap events\n    obj.events = new OpenLayers.Events(\n        obj, null,\n        ['treecreated','mapcreated','layersadded','uicreated',\n            'dockopened','dockclosed'],\n        true,\n        {includeXY: true}\n    );\n    return obj;\n}();\n/*\n * it's possible to add event listener\n * before the document is ready\n * but after this file\n */\nlizMap.events.on({\n    /**\n     * Event when the map has been created\n     * @event mapcreated\n     */\n    'mapcreated':function(evt){\n    }\n    ,\n    'uicreated': function(evt){\n\n        // Update legend if mobile\n        if( lizMap.checkMobile() ){\n            if( $('#button-switcher').parent().hasClass('active') )\n                $('#button-switcher').click();\n        }\n\n        // Connect dock close button\n        $('#dock-close').click(function(){ $('#mapmenu .nav-list > li.active.nav-dock > a').click(); });\n        $('#right-dock-close').click(function(){ $('#mapmenu .nav-list > li.active.nav-right-dock > a').click(); });\n    }\n});\n\n$(document).ready(function () {\n    // start waiting\n    $('body').css('cursor', 'wait');\n    $('#loading').dialog({\n        modal: true\n        , draggable: false\n        , resizable: false\n        , closeOnEscape: false\n        , dialogClass: 'liz-dialog-wait'\n        , minHeight: 128\n    })\n        .parent().removeClass('ui-corner-all')\n        .children('.ui-dialog-titlebar').removeClass('ui-corner-all');\n    // configurate OpenLayers\n    OpenLayers.DOTS_PER_INCH = 96;\n\n    // initialize LizMap\n    lizMap.init();\n    $( \"#loading\" ).css('min-height','128px');\n});\n","/**\n * @module ol/extent\n */\nimport Relationship from './extent/Relationship.js';\n\n/**\n * An array of numbers representing an extent: `[minx, miny, maxx, maxy]`.\n * @typedef {Array<number>} Extent\n * @api\n */\n\n/**\n * Extent corner.\n * @typedef {'bottom-left' | 'bottom-right' | 'top-left' | 'top-right'} Corner\n */\n\n/**\n * Build an extent that includes all given coordinates.\n *\n * @param {Array<import(\"./coordinate.js\").Coordinate>} coordinates Coordinates.\n * @return {Extent} Bounding extent.\n * @api\n */\nexport function boundingExtent(coordinates) {\n  const extent = createEmpty();\n  for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n    extendCoordinate(extent, coordinates[i]);\n  }\n  return extent;\n}\n\n/**\n * @param {Array<number>} xs Xs.\n * @param {Array<number>} ys Ys.\n * @param {Extent} [dest] Destination extent.\n * @private\n * @return {Extent} Extent.\n */\nfunction _boundingExtentXYs(xs, ys, dest) {\n  const minX = Math.min.apply(null, xs);\n  const minY = Math.min.apply(null, ys);\n  const maxX = Math.max.apply(null, xs);\n  const maxY = Math.max.apply(null, ys);\n  return createOrUpdate(minX, minY, maxX, maxY, dest);\n}\n\n/**\n * Return extent increased by the provided value.\n * @param {Extent} extent Extent.\n * @param {number} value The amount by which the extent should be buffered.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n * @api\n */\nexport function buffer(extent, value, dest) {\n  if (dest) {\n    dest[0] = extent[0] - value;\n    dest[1] = extent[1] - value;\n    dest[2] = extent[2] + value;\n    dest[3] = extent[3] + value;\n    return dest;\n  }\n  return [\n    extent[0] - value,\n    extent[1] - value,\n    extent[2] + value,\n    extent[3] + value,\n  ];\n}\n\n/**\n * Creates a clone of an extent.\n *\n * @param {Extent} extent Extent to clone.\n * @param {Extent} [dest] Extent.\n * @return {Extent} The clone.\n */\nexport function clone(extent, dest) {\n  if (dest) {\n    dest[0] = extent[0];\n    dest[1] = extent[1];\n    dest[2] = extent[2];\n    dest[3] = extent[3];\n    return dest;\n  }\n  return extent.slice();\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {number} x X.\n * @param {number} y Y.\n * @return {number} Closest squared distance.\n */\nexport function closestSquaredDistanceXY(extent, x, y) {\n  let dx, dy;\n  if (x < extent[0]) {\n    dx = extent[0] - x;\n  } else if (extent[2] < x) {\n    dx = x - extent[2];\n  } else {\n    dx = 0;\n  }\n  if (y < extent[1]) {\n    dy = extent[1] - y;\n  } else if (extent[3] < y) {\n    dy = y - extent[3];\n  } else {\n    dy = 0;\n  }\n  return dx * dx + dy * dy;\n}\n\n/**\n * Check if the passed coordinate is contained or on the edge of the extent.\n *\n * @param {Extent} extent Extent.\n * @param {import(\"./coordinate.js\").Coordinate} coordinate Coordinate.\n * @return {boolean} The coordinate is contained in the extent.\n * @api\n */\nexport function containsCoordinate(extent, coordinate) {\n  return containsXY(extent, coordinate[0], coordinate[1]);\n}\n\n/**\n * Check if one extent contains another.\n *\n * An extent is deemed contained if it lies completely within the other extent,\n * including if they share one or more edges.\n *\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent 2.\n * @return {boolean} The second extent is contained by or on the edge of the\n *     first.\n * @api\n */\nexport function containsExtent(extent1, extent2) {\n  return (\n    extent1[0] <= extent2[0] &&\n    extent2[2] <= extent1[2] &&\n    extent1[1] <= extent2[1] &&\n    extent2[3] <= extent1[3]\n  );\n}\n\n/**\n * Check if the passed coordinate is contained or on the edge of the extent.\n *\n * @param {Extent} extent Extent.\n * @param {number} x X coordinate.\n * @param {number} y Y coordinate.\n * @return {boolean} The x, y values are contained in the extent.\n * @api\n */\nexport function containsXY(extent, x, y) {\n  return extent[0] <= x && x <= extent[2] && extent[1] <= y && y <= extent[3];\n}\n\n/**\n * Get the relationship between a coordinate and extent.\n * @param {Extent} extent The extent.\n * @param {import(\"./coordinate.js\").Coordinate} coordinate The coordinate.\n * @return {import(\"./extent/Relationship.js\").default} The relationship (bitwise compare with\n *     import(\"./extent/Relationship.js\").Relationship).\n */\nexport function coordinateRelationship(extent, coordinate) {\n  const minX = extent[0];\n  const minY = extent[1];\n  const maxX = extent[2];\n  const maxY = extent[3];\n  const x = coordinate[0];\n  const y = coordinate[1];\n  let relationship = Relationship.UNKNOWN;\n  if (x < minX) {\n    relationship = relationship | Relationship.LEFT;\n  } else if (x > maxX) {\n    relationship = relationship | Relationship.RIGHT;\n  }\n  if (y < minY) {\n    relationship = relationship | Relationship.BELOW;\n  } else if (y > maxY) {\n    relationship = relationship | Relationship.ABOVE;\n  }\n  if (relationship === Relationship.UNKNOWN) {\n    relationship = Relationship.INTERSECTING;\n  }\n  return relationship;\n}\n\n/**\n * Create an empty extent.\n * @return {Extent} Empty extent.\n * @api\n */\nexport function createEmpty() {\n  return [Infinity, Infinity, -Infinity, -Infinity];\n}\n\n/**\n * Create a new extent or update the provided extent.\n * @param {number} minX Minimum X.\n * @param {number} minY Minimum Y.\n * @param {number} maxX Maximum X.\n * @param {number} maxY Maximum Y.\n * @param {Extent} [dest] Destination extent.\n * @return {Extent} Extent.\n */\nexport function createOrUpdate(minX, minY, maxX, maxY, dest) {\n  if (dest) {\n    dest[0] = minX;\n    dest[1] = minY;\n    dest[2] = maxX;\n    dest[3] = maxY;\n    return dest;\n  }\n  return [minX, minY, maxX, maxY];\n}\n\n/**\n * Create a new empty extent or make the provided one empty.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n */\nexport function createOrUpdateEmpty(dest) {\n  return createOrUpdate(Infinity, Infinity, -Infinity, -Infinity, dest);\n}\n\n/**\n * @param {import(\"./coordinate.js\").Coordinate} coordinate Coordinate.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n */\nexport function createOrUpdateFromCoordinate(coordinate, dest) {\n  const x = coordinate[0];\n  const y = coordinate[1];\n  return createOrUpdate(x, y, x, y, dest);\n}\n\n/**\n * @param {Array<import(\"./coordinate.js\").Coordinate>} coordinates Coordinates.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n */\nexport function createOrUpdateFromCoordinates(coordinates, dest) {\n  const extent = createOrUpdateEmpty(dest);\n  return extendCoordinates(extent, coordinates);\n}\n\n/**\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n */\nexport function createOrUpdateFromFlatCoordinates(\n  flatCoordinates,\n  offset,\n  end,\n  stride,\n  dest,\n) {\n  const extent = createOrUpdateEmpty(dest);\n  return extendFlatCoordinates(extent, flatCoordinates, offset, end, stride);\n}\n\n/**\n * @param {Array<Array<import(\"./coordinate.js\").Coordinate>>} rings Rings.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n */\nexport function createOrUpdateFromRings(rings, dest) {\n  const extent = createOrUpdateEmpty(dest);\n  return extendRings(extent, rings);\n}\n\n/**\n * Determine if two extents are equivalent.\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent 2.\n * @return {boolean} The two extents are equivalent.\n * @api\n */\nexport function equals(extent1, extent2) {\n  return (\n    extent1[0] == extent2[0] &&\n    extent1[2] == extent2[2] &&\n    extent1[1] == extent2[1] &&\n    extent1[3] == extent2[3]\n  );\n}\n\n/**\n * Determine if two extents are approximately equivalent.\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent 2.\n * @param {number} tolerance Tolerance in extent coordinate units.\n * @return {boolean} The two extents differ by less than the tolerance.\n */\nexport function approximatelyEquals(extent1, extent2, tolerance) {\n  return (\n    Math.abs(extent1[0] - extent2[0]) < tolerance &&\n    Math.abs(extent1[2] - extent2[2]) < tolerance &&\n    Math.abs(extent1[1] - extent2[1]) < tolerance &&\n    Math.abs(extent1[3] - extent2[3]) < tolerance\n  );\n}\n\n/**\n * Modify an extent to include another extent.\n * @param {Extent} extent1 The extent to be modified.\n * @param {Extent} extent2 The extent that will be included in the first.\n * @return {Extent} A reference to the first (extended) extent.\n * @api\n */\nexport function extend(extent1, extent2) {\n  if (extent2[0] < extent1[0]) {\n    extent1[0] = extent2[0];\n  }\n  if (extent2[2] > extent1[2]) {\n    extent1[2] = extent2[2];\n  }\n  if (extent2[1] < extent1[1]) {\n    extent1[1] = extent2[1];\n  }\n  if (extent2[3] > extent1[3]) {\n    extent1[3] = extent2[3];\n  }\n  return extent1;\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {import(\"./coordinate.js\").Coordinate} coordinate Coordinate.\n */\nexport function extendCoordinate(extent, coordinate) {\n  if (coordinate[0] < extent[0]) {\n    extent[0] = coordinate[0];\n  }\n  if (coordinate[0] > extent[2]) {\n    extent[2] = coordinate[0];\n  }\n  if (coordinate[1] < extent[1]) {\n    extent[1] = coordinate[1];\n  }\n  if (coordinate[1] > extent[3]) {\n    extent[3] = coordinate[1];\n  }\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {Array<import(\"./coordinate.js\").Coordinate>} coordinates Coordinates.\n * @return {Extent} Extent.\n */\nexport function extendCoordinates(extent, coordinates) {\n  for (let i = 0, ii = coordinates.length; i < ii; ++i) {\n    extendCoordinate(extent, coordinates[i]);\n  }\n  return extent;\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {Array<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {Extent} Extent.\n */\nexport function extendFlatCoordinates(\n  extent,\n  flatCoordinates,\n  offset,\n  end,\n  stride,\n) {\n  for (; offset < end; offset += stride) {\n    extendXY(extent, flatCoordinates[offset], flatCoordinates[offset + 1]);\n  }\n  return extent;\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {Array<Array<import(\"./coordinate.js\").Coordinate>>} rings Rings.\n * @return {Extent} Extent.\n */\nexport function extendRings(extent, rings) {\n  for (let i = 0, ii = rings.length; i < ii; ++i) {\n    extendCoordinates(extent, rings[i]);\n  }\n  return extent;\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {number} x X.\n * @param {number} y Y.\n */\nexport function extendXY(extent, x, y) {\n  extent[0] = Math.min(extent[0], x);\n  extent[1] = Math.min(extent[1], y);\n  extent[2] = Math.max(extent[2], x);\n  extent[3] = Math.max(extent[3], y);\n}\n\n/**\n * This function calls `callback` for each corner of the extent. If the\n * callback returns a truthy value the function returns that value\n * immediately. Otherwise the function returns `false`.\n * @param {Extent} extent Extent.\n * @param {function(import(\"./coordinate.js\").Coordinate): S} callback Callback.\n * @return {S|boolean} Value.\n * @template S\n */\nexport function forEachCorner(extent, callback) {\n  let val;\n  val = callback(getBottomLeft(extent));\n  if (val) {\n    return val;\n  }\n  val = callback(getBottomRight(extent));\n  if (val) {\n    return val;\n  }\n  val = callback(getTopRight(extent));\n  if (val) {\n    return val;\n  }\n  val = callback(getTopLeft(extent));\n  if (val) {\n    return val;\n  }\n  return false;\n}\n\n/**\n * Get the size of an extent.\n * @param {Extent} extent Extent.\n * @return {number} Area.\n * @api\n */\nexport function getArea(extent) {\n  let area = 0;\n  if (!isEmpty(extent)) {\n    area = getWidth(extent) * getHeight(extent);\n  }\n  return area;\n}\n\n/**\n * Get the bottom left coordinate of an extent.\n * @param {Extent} extent Extent.\n * @return {import(\"./coordinate.js\").Coordinate} Bottom left coordinate.\n * @api\n */\nexport function getBottomLeft(extent) {\n  return [extent[0], extent[1]];\n}\n\n/**\n * Get the bottom right coordinate of an extent.\n * @param {Extent} extent Extent.\n * @return {import(\"./coordinate.js\").Coordinate} Bottom right coordinate.\n * @api\n */\nexport function getBottomRight(extent) {\n  return [extent[2], extent[1]];\n}\n\n/**\n * Get the center coordinate of an extent.\n * @param {Extent} extent Extent.\n * @return {import(\"./coordinate.js\").Coordinate} Center.\n * @api\n */\nexport function getCenter(extent) {\n  return [(extent[0] + extent[2]) / 2, (extent[1] + extent[3]) / 2];\n}\n\n/**\n * Get a corner coordinate of an extent.\n * @param {Extent} extent Extent.\n * @param {Corner} corner Corner.\n * @return {import(\"./coordinate.js\").Coordinate} Corner coordinate.\n */\nexport function getCorner(extent, corner) {\n  let coordinate;\n  if (corner === 'bottom-left') {\n    coordinate = getBottomLeft(extent);\n  } else if (corner === 'bottom-right') {\n    coordinate = getBottomRight(extent);\n  } else if (corner === 'top-left') {\n    coordinate = getTopLeft(extent);\n  } else if (corner === 'top-right') {\n    coordinate = getTopRight(extent);\n  } else {\n    throw new Error('Invalid corner');\n  }\n  return coordinate;\n}\n\n/**\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent 2.\n * @return {number} Enlarged area.\n */\nexport function getEnlargedArea(extent1, extent2) {\n  const minX = Math.min(extent1[0], extent2[0]);\n  const minY = Math.min(extent1[1], extent2[1]);\n  const maxX = Math.max(extent1[2], extent2[2]);\n  const maxY = Math.max(extent1[3], extent2[3]);\n  return (maxX - minX) * (maxY - minY);\n}\n\n/**\n * @param {import(\"./coordinate.js\").Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {import(\"./size.js\").Size} size Size.\n * @param {Extent} [dest] Destination extent.\n * @return {Extent} Extent.\n */\nexport function getForViewAndSize(center, resolution, rotation, size, dest) {\n  const [x0, y0, x1, y1, x2, y2, x3, y3] = getRotatedViewport(\n    center,\n    resolution,\n    rotation,\n    size,\n  );\n  return createOrUpdate(\n    Math.min(x0, x1, x2, x3),\n    Math.min(y0, y1, y2, y3),\n    Math.max(x0, x1, x2, x3),\n    Math.max(y0, y1, y2, y3),\n    dest,\n  );\n}\n\n/**\n * @param {import(\"./coordinate.js\").Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {import(\"./size.js\").Size} size Size.\n * @return {Array<number>} Linear ring representing the viewport.\n */\nexport function getRotatedViewport(center, resolution, rotation, size) {\n  const dx = (resolution * size[0]) / 2;\n  const dy = (resolution * size[1]) / 2;\n  const cosRotation = Math.cos(rotation);\n  const sinRotation = Math.sin(rotation);\n  const xCos = dx * cosRotation;\n  const xSin = dx * sinRotation;\n  const yCos = dy * cosRotation;\n  const ySin = dy * sinRotation;\n  const x = center[0];\n  const y = center[1];\n  return [\n    x - xCos + ySin,\n    y - xSin - yCos,\n    x - xCos - ySin,\n    y - xSin + yCos,\n    x + xCos - ySin,\n    y + xSin + yCos,\n    x + xCos + ySin,\n    y + xSin - yCos,\n    x - xCos + ySin,\n    y - xSin - yCos,\n  ];\n}\n\n/**\n * Get the height of an extent.\n * @param {Extent} extent Extent.\n * @return {number} Height.\n * @api\n */\nexport function getHeight(extent) {\n  return extent[3] - extent[1];\n}\n\n/**\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent 2.\n * @return {number} Intersection area.\n */\nexport function getIntersectionArea(extent1, extent2) {\n  const intersection = getIntersection(extent1, extent2);\n  return getArea(intersection);\n}\n\n/**\n * Get the intersection of two extents.\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent 2.\n * @param {Extent} [dest] Optional extent to populate with intersection.\n * @return {Extent} Intersecting extent.\n * @api\n */\nexport function getIntersection(extent1, extent2, dest) {\n  const intersection = dest ? dest : createEmpty();\n  if (intersects(extent1, extent2)) {\n    if (extent1[0] > extent2[0]) {\n      intersection[0] = extent1[0];\n    } else {\n      intersection[0] = extent2[0];\n    }\n    if (extent1[1] > extent2[1]) {\n      intersection[1] = extent1[1];\n    } else {\n      intersection[1] = extent2[1];\n    }\n    if (extent1[2] < extent2[2]) {\n      intersection[2] = extent1[2];\n    } else {\n      intersection[2] = extent2[2];\n    }\n    if (extent1[3] < extent2[3]) {\n      intersection[3] = extent1[3];\n    } else {\n      intersection[3] = extent2[3];\n    }\n  } else {\n    createOrUpdateEmpty(intersection);\n  }\n  return intersection;\n}\n\n/**\n * @param {Extent} extent Extent.\n * @return {number} Margin.\n */\nexport function getMargin(extent) {\n  return getWidth(extent) + getHeight(extent);\n}\n\n/**\n * Get the size (width, height) of an extent.\n * @param {Extent} extent The extent.\n * @return {import(\"./size.js\").Size} The extent size.\n * @api\n */\nexport function getSize(extent) {\n  return [extent[2] - extent[0], extent[3] - extent[1]];\n}\n\n/**\n * Get the top left coordinate of an extent.\n * @param {Extent} extent Extent.\n * @return {import(\"./coordinate.js\").Coordinate} Top left coordinate.\n * @api\n */\nexport function getTopLeft(extent) {\n  return [extent[0], extent[3]];\n}\n\n/**\n * Get the top right coordinate of an extent.\n * @param {Extent} extent Extent.\n * @return {import(\"./coordinate.js\").Coordinate} Top right coordinate.\n * @api\n */\nexport function getTopRight(extent) {\n  return [extent[2], extent[3]];\n}\n\n/**\n * Get the width of an extent.\n * @param {Extent} extent Extent.\n * @return {number} Width.\n * @api\n */\nexport function getWidth(extent) {\n  return extent[2] - extent[0];\n}\n\n/**\n * Determine if one extent intersects another.\n * @param {Extent} extent1 Extent 1.\n * @param {Extent} extent2 Extent.\n * @return {boolean} The two extents intersect.\n * @api\n */\nexport function intersects(extent1, extent2) {\n  return (\n    extent1[0] <= extent2[2] &&\n    extent1[2] >= extent2[0] &&\n    extent1[1] <= extent2[3] &&\n    extent1[3] >= extent2[1]\n  );\n}\n\n/**\n * Determine if an extent is empty.\n * @param {Extent} extent Extent.\n * @return {boolean} Is empty.\n * @api\n */\nexport function isEmpty(extent) {\n  return extent[2] < extent[0] || extent[3] < extent[1];\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {Extent} [dest] Extent.\n * @return {Extent} Extent.\n */\nexport function returnOrUpdate(extent, dest) {\n  if (dest) {\n    dest[0] = extent[0];\n    dest[1] = extent[1];\n    dest[2] = extent[2];\n    dest[3] = extent[3];\n    return dest;\n  }\n  return extent;\n}\n\n/**\n * @param {Extent} extent Extent.\n * @param {number} value Value.\n */\nexport function scaleFromCenter(extent, value) {\n  const deltaX = ((extent[2] - extent[0]) / 2) * (value - 1);\n  const deltaY = ((extent[3] - extent[1]) / 2) * (value - 1);\n  extent[0] -= deltaX;\n  extent[2] += deltaX;\n  extent[1] -= deltaY;\n  extent[3] += deltaY;\n}\n\n/**\n * Determine if the segment between two coordinates intersects (crosses,\n * touches, or is contained by) the provided extent.\n * @param {Extent} extent The extent.\n * @param {import(\"./coordinate.js\").Coordinate} start Segment start coordinate.\n * @param {import(\"./coordinate.js\").Coordinate} end Segment end coordinate.\n * @return {boolean} The segment intersects the extent.\n */\nexport function intersectsSegment(extent, start, end) {\n  let intersects = false;\n  const startRel = coordinateRelationship(extent, start);\n  const endRel = coordinateRelationship(extent, end);\n  if (\n    startRel === Relationship.INTERSECTING ||\n    endRel === Relationship.INTERSECTING\n  ) {\n    intersects = true;\n  } else {\n    const minX = extent[0];\n    const minY = extent[1];\n    const maxX = extent[2];\n    const maxY = extent[3];\n    const startX = start[0];\n    const startY = start[1];\n    const endX = end[0];\n    const endY = end[1];\n    const slope = (endY - startY) / (endX - startX);\n    let x, y;\n    if (!!(endRel & Relationship.ABOVE) && !(startRel & Relationship.ABOVE)) {\n      // potentially intersects top\n      x = endX - (endY - maxY) / slope;\n      intersects = x >= minX && x <= maxX;\n    }\n    if (\n      !intersects &&\n      !!(endRel & Relationship.RIGHT) &&\n      !(startRel & Relationship.RIGHT)\n    ) {\n      // potentially intersects right\n      y = endY - (endX - maxX) * slope;\n      intersects = y >= minY && y <= maxY;\n    }\n    if (\n      !intersects &&\n      !!(endRel & Relationship.BELOW) &&\n      !(startRel & Relationship.BELOW)\n    ) {\n      // potentially intersects bottom\n      x = endX - (endY - minY) / slope;\n      intersects = x >= minX && x <= maxX;\n    }\n    if (\n      !intersects &&\n      !!(endRel & Relationship.LEFT) &&\n      !(startRel & Relationship.LEFT)\n    ) {\n      // potentially intersects left\n      y = endY - (endX - minX) * slope;\n      intersects = y >= minY && y <= maxY;\n    }\n  }\n  return intersects;\n}\n\n/**\n * Apply a transform function to the extent.\n * @param {Extent} extent Extent.\n * @param {import(\"./proj.js\").TransformFunction} transformFn Transform function.\n * Called with `[minX, minY, maxX, maxY]` extent coordinates.\n * @param {Extent} [dest] Destination extent.\n * @param {number} [stops] Number of stops per side used for the transform.\n * By default only the corners are used.\n * @return {Extent} Extent.\n * @api\n */\nexport function applyTransform(extent, transformFn, dest, stops) {\n  if (isEmpty(extent)) {\n    return createOrUpdateEmpty(dest);\n  }\n  let coordinates = [];\n  if (stops > 1) {\n    const width = extent[2] - extent[0];\n    const height = extent[3] - extent[1];\n    for (let i = 0; i < stops; ++i) {\n      coordinates.push(\n        extent[0] + (width * i) / stops,\n        extent[1],\n        extent[2],\n        extent[1] + (height * i) / stops,\n        extent[2] - (width * i) / stops,\n        extent[3],\n        extent[0],\n        extent[3] - (height * i) / stops,\n      );\n    }\n  } else {\n    coordinates = [\n      extent[0],\n      extent[1],\n      extent[2],\n      extent[1],\n      extent[2],\n      extent[3],\n      extent[0],\n      extent[3],\n    ];\n  }\n  transformFn(coordinates, coordinates, 2);\n  const xs = [];\n  const ys = [];\n  for (let i = 0, l = coordinates.length; i < l; i += 2) {\n    xs.push(coordinates[i]);\n    ys.push(coordinates[i + 1]);\n  }\n  return _boundingExtentXYs(xs, ys, dest);\n}\n\n/**\n * Modifies the provided extent in-place to be within the real world\n * extent.\n *\n * @param {Extent} extent Extent.\n * @param {import(\"./proj/Projection.js\").default} projection Projection\n * @return {Extent} The extent within the real world extent.\n */\nexport function wrapX(extent, projection) {\n  const projectionExtent = projection.getExtent();\n  const center = getCenter(extent);\n  if (\n    projection.canWrapX() &&\n    (center[0] < projectionExtent[0] || center[0] >= projectionExtent[2])\n  ) {\n    const worldWidth = getWidth(projectionExtent);\n    const worldsAway = Math.floor(\n      (center[0] - projectionExtent[0]) / worldWidth,\n    );\n    const offset = worldsAway * worldWidth;\n    extent[0] -= offset;\n    extent[2] -= offset;\n  }\n  return extent;\n}\n\n/**\n * Fits the extent to the real world\n *\n * If the extent does not cross the anti meridian, this will return the extent in an array\n * If the extent crosses the anti meridian, the extent will be sliced, so each part fits within the\n * real world\n *\n *\n * @param {Extent} extent Extent.\n * @param {import(\"./proj/Projection.js\").default} projection Projection\n * @param {boolean} [multiWorld] Return all worlds\n * @return {Array<Extent>} The extent within the real world extent.\n */\nexport function wrapAndSliceX(extent, projection, multiWorld) {\n  if (projection.canWrapX()) {\n    const projectionExtent = projection.getExtent();\n\n    if (!isFinite(extent[0]) || !isFinite(extent[2])) {\n      return [[projectionExtent[0], extent[1], projectionExtent[2], extent[3]]];\n    }\n\n    wrapX(extent, projection);\n    const worldWidth = getWidth(projectionExtent);\n\n    if (getWidth(extent) > worldWidth && !multiWorld) {\n      // the extent wraps around on itself\n      return [[projectionExtent[0], extent[1], projectionExtent[2], extent[3]]];\n    }\n    if (extent[0] < projectionExtent[0]) {\n      // the extent crosses the anti meridian, so it needs to be sliced\n      return [\n        [extent[0] + worldWidth, extent[1], projectionExtent[2], extent[3]],\n        [projectionExtent[0], extent[1], extent[2], extent[3]],\n      ];\n    }\n    if (extent[2] > projectionExtent[2]) {\n      // the extent crosses the anti meridian, so it needs to be sliced\n      return [\n        [extent[0], extent[1], projectionExtent[2], extent[3]],\n        [projectionExtent[0], extent[1], extent[2] - worldWidth, extent[3]],\n      ];\n    }\n  }\n\n  return [extent];\n}\n"],"names":["NetworkError","Error","constructor","message","resource","options","super","this","name","HttpError","statusCode","ResponseError","response","entries","setPrototypeOf","isFrozen","getPrototypeOf","getOwnPropertyDescriptor","Object","freeze","seal","create","apply","construct","Reflect","x","fun","thisValue","args","Func","arrayForEach","unapply","Array","prototype","forEach","arrayLastIndexOf","lastIndexOf","arrayPop","pop","arrayPush","push","arraySplice","splice","stringToLowerCase","String","toLowerCase","stringToString","toString","stringMatch","match","stringReplace","replace","stringIndexOf","indexOf","stringTrim","trim","objectHasOwnProperty","hasOwnProperty","regExpTest","RegExp","test","typeErrorCreate","func","TypeError","_len2","arguments","length","_key2","thisArg","_len","_key","addToSet","set","array","transformCaseFunc","undefined","l","element","lcElement","cleanArray","index","object","newObject","property","value","isArray","lookupGetter","prop","desc","get","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","html","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","EXPRESSIONS","__proto__","getGlobal","window","purify","createDOMPurify","DOMPurify","root","version","removed","document","nodeType","Element","isSupported","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","NodeFilter","NamedNodeMap","MozNamedAttrMap","HTMLFormElement","DOMParser","trustedTypes","ElementPrototype","cloneNode","remove","getNextSibling","getChildNodes","getParentNode","template","createElement","content","ownerDocument","trustedTypesPolicy","emptyHTML","implementation","createNodeIterator","createDocumentFragment","getElementsByTagName","importNode","hooks","afterSanitizeAttributes","afterSanitizeElements","afterSanitizeShadowDOM","beforeSanitizeAttributes","beforeSanitizeElements","beforeSanitizeShadowDOM","uponSanitizeAttribute","uponSanitizeElement","uponSanitizeShadowNode","createHTMLDocument","IS_ALLOWED_URI$1","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","CUSTOM_ELEMENT_HANDLING","tagNameCheck","writable","configurable","enumerable","attributeNameCheck","allowCustomizedBuiltInElements","FORBID_TAGS","FORBID_ATTR","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","SET_CONFIG","FORCE_BODY","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","SANITIZE_DOM","SANITIZE_NAMED_PROPS","KEEP_CONTENT","IN_PLACE","USE_PROFILES","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","MATHML_NAMESPACE","SVG_NAMESPACE","HTML_NAMESPACE","NAMESPACE","IS_EMPTY_INPUT","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","COMMON_SVG_AND_HTML_ELEMENTS","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","CONFIG","formElement","isRegexOrFunction","testValue","Function","_parseConfig","cfg","ADD_URI_SAFE_ATTR","ADD_DATA_URI_TAGS","ALLOWED_URI_REGEXP","ADD_TAGS","ADD_ATTR","table","tbody","TRUSTED_TYPES_POLICY","createHTML","createScriptURL","purifyHostElement","createPolicy","suffix","ATTR_NAME","hasAttribute","getAttribute","policyName","scriptUrl","_","console","warn","_createTrustedTypesPolicy","ALL_SVG_TAGS","ALL_MATHML_TAGS","_forceRemove","node","removeChild","_removeAttribute","attribute","getAttributeNode","from","removeAttribute","setAttribute","_initDocument","dirty","doc","leadingWhitespace","matches","dirtyPayload","parseFromString","documentElement","createDocument","innerHTML","body","insertBefore","createTextNode","childNodes","call","_createNodeIterator","SHOW_ELEMENT","SHOW_COMMENT","SHOW_TEXT","SHOW_PROCESSING_INSTRUCTION","SHOW_CDATA_SECTION","_isClobbered","nodeName","textContent","attributes","namespaceURI","hasChildNodes","_isNode","_executeHooks","currentNode","data","hook","_sanitizeElements","tagName","allowedTags","firstElementChild","_isBasicCustomElement","parentNode","i","childClone","__removalCount","parent","parentTagName","Boolean","_checkValidNamespace","expr","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","hookEvent","attrName","attrValue","keepAttr","allowedAttributes","forceKeepAttr","attr","getAttributeType","setAttributeNS","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","nextNode","sanitize","importedNode","returnNode","appendChild","firstChild","nodeIterator","shadowroot","shadowrootmode","serializedHTML","outerHTML","doctype","setConfig","clearConfig","isValidAttribute","tag","addHook","entryPoint","hookFunction","removeHook","removeHooks","removeAllHooks","Utils","downloadFileFromString","text","fileType","fileName","blob","Blob","type","a","download","href","URL","createObjectURL","dataset","downloadurl","join","style","display","click","setTimeout","revokeObjectURL","downloadFile","url","parameters","callback","errorCallback","xhr","XMLHttpRequest","open","responseType","onload","status","filename","disposition","getResponseHeader","exec","navigator","userAgent","File","downloadUrl","dispatchEvent","MouseEvent","method","$","param","addEventListener","setRequestHeader","send","fetch","then","ok","Promise","reject","catch","error","fetchJSON","contentType","headers","includes","json","fetchHTML","getResolutionFromScale","scale","metersPerUnit","getScaleFromResolution","resolution","sanitizeGFIContent","startsWith","location","origin","WFS","_defaultGetFeatureParameters","repository","globalThis","params","project","SERVICE","REQUEST","VERSION","OUTPUTFORMAT","_defaultDescribeFeatureTypeParameters","getFeature","wms","URLSearchParams","describeFeatureType","WMS","_defaultGetFeatureInfoParameters","CRS","INFO_FORMAT","_defaultGetLegendGraphicParameters","FORMAT","getFeatureInfo","getLegendGraphic","lizMap","config","keyValueConfig","capabilities","wmtsCapabilities","wfsCapabilities","map","baselayers","layers","controls","externalBaselayersReplacement","cleanNameMap","layerIdMap","shortNameMap","typeNameMap","layerCleanNames","lastLonLatInfo","cleanName","aName","log","theCleanName","accentMap","term","ret","charAt","normalize","reg","performCleanName","nCleanName","getLayerNameByCleanName","layerName","updateContentSize","querySelector","classList","contains","isMobile","mCheckMobile","hasClass","addClass","is","hide","append","show","removeClass","h","innerHeight","height","css","outerHeight","w","offsetWidth","parseInt","width","updateLocateFeatureList","locate","locateByLayer","features","fid","filterValue","filterFieldName","val","feat","properties","vectorjoins","len","vectorjoin","jName","joinLayer","jLocate","jVal","jFeat","targetFieldName","joinFieldName","title","id","fieldName","zoomToLocateFeature","mainLizmap","clearHighlightFeatures","proj","OpenLayers","Projection","crs","events","triggerEvent","format","Format","GeoJSON","ignoreExtraDims","read","geometry","transform","getProjection","displayGeom","getFeatureUrlData","getVectorLayerWfsUrl","post","JSON","parse","setHighlightFeatures","fail","zoomToExtent","getBounds","split","getLocateFeature","fields","filterjoins","filterjoin","lConfig","loadProjDefinition","sort","b","aProperty","bProperty","isNaN","localeCompare","parseFloat","filterPlaceHolder","filterFieldAlias","fOptions","fValue","before","change","children","combobox","position","my","at","evt","ui","item","self","uiItem","autocomplete","placeHolder","fieldAlias","oldVal","blur","minLength","displayGetFeatureInfo","xy","coordinate","eventLonLatInfo","getLonLatFromPixel","popup","popupContainerId","popupLocation","popupReg","pcontent","hasPopupContent","lizDict","lon","lat","mapPopup","setVisible","getElementById","setPosition","on","e","preventDefault","tab","addChildrenFeatureInfo","addGeometryFeatureInfo","addChildrenDatavizFilteredByPopupFeature","containerId","selector","geometriesWKT","querySelectorAll","geometryCollectionWKT","each","mydiv","find","getLayerId","popupId","layerId","getLayerConfig","getLayerConfigById","featureType","relations","getLayerFeature","plotLayers","datavizLayers","lrelations","nbPlotByLayer","rel","getChildrenId","referencingLayer","filter","referencingField","referencedField","layer_id","plot_config","popup_display_child_plot","plot_id","Date","valueOf","btoa","Math","random","substring","phtml","lizDataviz","buildPlotContainerHtml","title_popup","abstract","haspc","after","getPlot","layerConfig","popupDisplayChildren","popupMaxFeatures","parentDiv","popupChidrenRequests","preProcessedRequests","preProcessUtilities","rConfigLayerAll","relation","rLayerId","preProcessRequest","rUtilities","relationId","pivotAttributeLayerConf","attributeLayers","pivot","pivotConfig","mLayer","keys","k","mLayerConfig","clRefname","shortname","cleanname","wfsParams","TYPENAME","typename","GEOMETRYNAME","limitDataToBbox","getView","calculateExtent","getCode","wfs","ut","pivotTableId","rGetLayerConfig","oneToN","layer","allSettled","preProcessResponses","rr","resp","utilities","respValue","confLayer","wmsFilter","referencedFieldForFilter","fil","filArray","feats","rConfigLayer","clname","wmsName","wmsOptions","request_params","service","textResp","popupChildData","popupChildrenData","childPopupElements","popupResponse","configLayer","popupFeatureToolbarReg","resizeTablesButtons","childPopup","popupSource","popupDiv","prepend","next","first","contents","unwrap","tChildPopup","appendTo","oldPopupChild","childPopupElement","DataTable","order","language","tooltip","off","siblings","toggle","ind","elementToMove","c","parentPopupElement","parents","aLayerId","aConfObjet","aIdAttribute","lx","aCRS","aCallback","Proj4js","defs","aText","mAddMessage","aMessage","aType","aClose","aTimeout","mType","mClose","elt","aFilter","aFeatureId","geometryName","restrictToMapExtent","startIndex","maxFeatures","qgisName","getNameByCleanName","getNameByShortName","getNameByTypeName","typeName","wfsOptions","filterParam","mapExtent","transformedExtent","transformExtent","inArray","featureDataPool","callFeatureDataCallBacks","poolId","callbacksData","callbacks","alias","types","getFeatureData","aFeatureID","aGeometryName","aCallBack","aConfig","stringify","describe","aliases","columns","aCallbackNotfound","forceToLoad","featureId","cFeatures","cAliases","getVectorLayerFeatureTypes","addDock","dname","dlabel","dtype","dcontent","dicon","dockli","docktab","docktabli","obj","dictionary","tree","lizmapLayerFilterActive","getLizmapDesktopPluginMetadata","plugin_metadata","lizmap_plugin_version_str","lizmap_plugin_version","lizmap_web_client_target_version","qgis_desktop_version","checkMobile","shortName","addMessage","clearDrawLayer","layer_name","getLayersByName","destroyFeatures","translateWfsFieldValues","fieldValue","translation_dict","zoomToFeature","zoomAction","featureCrs","feature","lonlat","getCenterLonLat","setCenter","zoomToOlFeature","getExternalBaselayersReplacement","launchEdition","deleteEditionFeature","deactivateToolControls","ctrl","Control","TYPE_TOOL","deactivate","exportVectorLayer","eformat","exportLayers","selectionLayer","config_layer","is_spatial","has_selection_token","has_parenthesis","selection_token","featureid","featureidParameter","fids","getVectorLayerSelectionFeatureIdsString","el","disabled","getVectorLayerResultFormat","formats","getFeaturePopupContent","popups","removePopup","pkey","atlas","primaryKey","pkVal","getFeaturePopupContentByFeatureIntersection","units","getUnits","minMapScale","mapScales","max","minScale","maxMapScale","maxScale","res","Util","geomType","CLASS_NAME","vert","getVertices","middlePoint","floor","LonLat","y","bbox","Bounds","gfiCrs","getProjectionObject","toBBOX","getHashParamFromUrl","hash_key","hash_items","hash","key","triggerLayerFilter","layername","layerWmsName","state","layersAndGroupsCollection","getLayerByName","lfilter","request","result","filtertoken","token","filterToken","expressionFilter","deactivateMaplayerFilter","init","lizmapVariablesJSON","innerText","lizmapVariables","variable","configRequest","statusText","keyValueConfigRequest","WMSRequest","WMTSRequest","WFSRequest","featureExtentRequest","getFeatureInfoRequest","urlParameters","searchParams","EXP_FILTER","wmsParams","QUERY_LAYERS","LAYERS","FEATURE_COUNT","FILTER","async","responses","requiredRequests","reason","wmsCapaData","wmtsCapaData","wfsCapaData","featuresExtent","startupFeatures","extent1","extent2","sleep","ms","r","sleepStep","waitingFor","waitingTime","initialConfig","wmsCapabilities","waitFor","domparser","hasOverview","useLayerIDs","wmsFormat","WMSCapabilities","capability","wmtsFormat","WMTSCapabilities","wmtsElem","exceptionReport","exceptions","texts","featureTypes","qgisProjectProjection","assign","projection","ref","proj4","initialBbox","initialExtent","extent","Number","toArray","scales","useNativeZoomLevels","projOSM","resolutions","zoomLevelNumber","maxRes","minRes","n","nativeScales","pow","concat","buildNativeScales","firstLayer","nestedLayers","proj4jsLibPath","libPath","defaults","wmsBbox","wmsBounds","fromArray","intersectsBounds","yx","initProjections","proj4326","initialExtentProj","zoomToClosest","restrictedExtent","has","initialExtentParam","initialExtentPermalink","clone","initBbox","mapHeight","clientHeight","nScales","IMAGE_RELOAD_ATTEMPTS","DEFAULT_PRECISION","Map","Navigation","mouseWheelOptions","interval","tileManager","maxExtent","numZoomLevels","allOverlays","autoUpdateSize","createMap","addLayer","Layer","Vector","locateByLayerList","lname","locateContent","lbl","lName","joinLayerId","addLocateByLayer","configOptions","lastLayerZIndex","getZIndex","Z_INDEX_BASE","getCenter","popupsAvailable","editionLayer","editionLayers","modifyGeometry","modifyAttribute","deleteFeature","refreshGetFeatureInfo","updateDrawing","getPixelFromLonLat","refreshInfo","nbPopupDisplayed","sdata","addFeatureInfo","Style","addRules","Rule","symbolizer","pointRadius","graphicName","fillColor","fillOpacity","strokeWidth","strokeOpacity","strokeColor","strokeDashstyle","styleMap","StyleMap","measureControls","Measure","Handler","Path","persist","geodesic","immediate","handlerOptions","layerOptions","area","Polygon","perimeter","angle","maxVertices","handleMeasurements","measure","out","components","invert","firstComponent","secondComponent","move","A","B","C","AB","sqrt","BC","AC","angleInDegrees","acos","PI","toFixed","activate","eventType","stat","getBestLength","control","addControl","active","minidockopened","newOlMap","minidockclosed","activeCtrl","addMeasureControls","substr","oldActive","lizmapEvent","dock","toggleClass","errorMsg","lizmapAdminUser","lizmapUserDefinedJsCount","repositoryAdmin","basepath","insertAdjacentHTML","finally","dialog","size","Events","includeXY","ready","modal","draggable","resizable","closeOnEscape","dialogClass","minHeight","DOTS_PER_INCH"],"sourceRoot":""}